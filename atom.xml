<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Lincoln&#39;s SafeHouse</title>
  
  <subtitle>Home of a Swifter on Apple platforms</subtitle>
  <link href="https://crystdragon.github.io/atom.xml" rel="self"/>
  
  <link href="https://crystdragon.github.io/"/>
  <updated>2020-12-13T12:38:36.426Z</updated>
  <id>https://crystdragon.github.io/</id>
  
  <author>
    <name>Lincoln Wu</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>TRA-3</title>
    <link href="https://crystdragon.github.io/2020/tra-3/"/>
    <id>https://crystdragon.github.io/2020/tra-3/</id>
    <published>2020-12-13T10:41:54.000Z</published>
    <updated>2020-12-13T12:38:36.426Z</updated>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#tip-%E5%9C%A8-swift-%E4%B8%AD%E5%AE%9E%E7%8E%B0-protected-%E5%AF%B9%E5%BA%94%E7%9A%84%E5%8A%9F%E8%83%BD">Tip: åœ¨ Swift ä¸­å®ç° protected å¯¹åº”çš„åŠŸèƒ½</a></li><li><a href="#receive-%E4%BA%86%E8%A7%A3-swift-runtime-%E5%AE%9E%E7%8E%B0">Receive: äº†è§£ Swift Runtime å®ç°</a></li><li><a href="#algorithm-longest-valid-parentheses">Algorithm: Longest Valid Parentheses</a><ul><li><a href="#%E9%A2%98%E7%9B%AE">é¢˜ç›®</a></li><li><a href="#%E5%AE%9E%E7%8E%B0">å®ç°</a></li><li><a href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90">æ€§èƒ½åˆ†æ</a></li></ul></li></ul></p><hr><a id="more"></a><h2 id="tip-åœ¨-swift-ä¸­å®ç°-protected-å¯¹åº”çš„åŠŸèƒ½"><a class="markdownIt-Anchor" href="#tip-åœ¨-swift-ä¸­å®ç°-protected-å¯¹åº”çš„åŠŸèƒ½"></a> Tip: åœ¨ Swift ä¸­å®ç° protected å¯¹åº”çš„åŠŸèƒ½</h2><p>æ— è®ºæ˜¯ ObjC è¿˜æ˜¯ Swift, éƒ½æ²¡æœ‰æä¾›åŸç”Ÿçš„ protected æ¦‚å¿µ.</p><p>åœ¨ ObjC ä¸­, ç»å¸¸æŠŠé‚£äº›å¯¹åº” protected çš„æ–¹æ³•å®šä¹‰åœ¨ä¸€ä¸ªç‰¹æ®Šçš„ .h æ–‡ä»¶ä¸­, è¦æ±‚å­ç±»çš„å®ç°è€…åœ¨éœ€è¦è°ƒç”¨è¿™äº›æ–¹æ³•æ—¶, å¼•ç”¨è¿™ä¸ªå¤´æ–‡ä»¶. è¿™å½“ç„¶åªæ˜¯ä¸€ä¸ª trick, å› ä¸ºäº‹å®ä¸Šæ²¡æœ‰åŠæ³•é¿å…éå­ç±»å®ç°è€…ä¹Ÿå¼•ç”¨è¿™ä¸ªå¤´æ–‡ä»¶, å†åŠ ä¸Š ObjC çš„ runtime çš„å­˜åœ¨, æœ¬è´¨ä¸Šå¹¶æ²¡æœ‰åŠæ³•é˜»æ­¢è¿™äº›æ–¹æ³•æš´éœ²å‡ºå». è€Œåœ¨ Swift ä¸­, ç”±äº<a href="https://developer.apple.com/swift/blog/?id=11" target="_blank" rel="noopener">ä¸€äº›è®¾è®¡æ–¹é¢çš„ç†ç”±</a>, protected è¢«è®¤ä¸ºæ˜¯ä¸å¿…è¦çš„. è€Œå› ä¸º Swift æ²¡æœ‰å¤´æ–‡ä»¶çš„æ¦‚å¿µ, ä¹‹å‰ ObjC ä¸­çš„ trick æ ¹æœ¬æ— æ³•å®æ–½, ä»è€Œåªèƒ½é  comment æˆ–è€… documentation çº¦å®šæ¥æŒ‡æ˜å“ªäº›æ–¹æ³•åº”è¢«è§†ä½œ protected.</p><p>è·³å‡ºåŸæœ‰çš„æ€ç»´, æ¥çœ‹ä¸€çœ‹ protected èƒ½å®Œæˆçš„ä»»åŠ¡, é€šå¸¸æˆ‘ä»¬éœ€è¦åšåˆ°è¿™æ ·çš„æ•ˆæœ.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">routine</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> value = step1()</span><br><span class="line">    value = step2(value)</span><br><span class="line">    step3(value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">step1</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="number">100</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">step2</span><span class="params">(<span class="number">_</span> input: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    input</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">step3</span><span class="params">(<span class="number">_</span> value: Int)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MARK: protected methods</span></span><br><span class="line">  <span class="keyword">final</span> <span class="function"><span class="keyword">func</span> <span class="title">util1</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="type">Int</span>(<span class="type">Date</span>.timeIntervalSinceReferenceDate)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="function"><span class="keyword">func</span> <span class="title">util2</span><span class="params">(<span class="number">_</span> value: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    (value * <span class="number">3</span> + <span class="number">50</span>) / <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span>: <span class="title">Base</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">step2</span><span class="params">(<span class="number">_</span> input: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    util1() + util2(input)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> object: <span class="type">Base</span> = <span class="type">Derived</span>()</span><br><span class="line">object.routine()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ— æ³•é˜»æ­¢</span></span><br><span class="line">object.util1()</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª <code>Base</code> ç±»æä¾›äº†ä¸€ä¸ª <code>routine</code> æ–¹æ³•ä½œä¸ºå…¶ API, å…¶å†…éƒ¨å®ç°æŠŠæ­¥éª¤åˆ†ä¸º 3 æ­¥, å…¶ä¸­å¼€å§‹å’Œç»“æŸæ­¥éª¤æ˜¯å›ºå®šçš„, å…è®¸å­ç±»é€šè¿‡é‡å†™ç¬¬äºŒä¸ªæ­¥éª¤æ¥æ‰©å±•åŸºç±»çš„åŠŸèƒ½. åŒæ—¶åŸºç±»æä¾›äº†ä¸€ç³»åˆ— protected æ–¹æ³•, ä¾›å­ç±»åœ¨æ‰©å±•è¿‡ç¨‹ä¸­è°ƒç”¨. åœ¨ä¸Šé¢çš„å®ç°ä¸­, æˆ‘ä»¬é€šè¿‡ comment, å°†åŸºç±»ä¸­çš„ä¸€äº›æ–¹æ³•æ ‡æ³¨ä¸º protected, ä½†è¿™æ ·æ˜¾ç„¶æ— æ³•é˜»æ­¢å®ƒä»¬è¢«åŸºç±»å®ç°è€…ä»¥å¤–çš„ code è®¿é—®.</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, æˆ‘ä»¬å¯ä»¥æŠŠé‚£äº›åªå…è®¸å­ç±»è°ƒç”¨çš„ protected æ–¹æ³•æ ‡è®°æˆ private, åŒæ—¶æ”¹å†™å…è®¸å­ç±»æ‰©å±•åŠŸèƒ½çš„é‚£éƒ¨åˆ†æ–¹æ³•çš„æ¥å£, æŠŠ protected æ–¹æ³•ä½œä¸º closure å‚æ•°æ³¨å…¥åˆ°è¿™ä¸ªå¾…æ‰©å±•çš„æ–¹æ³•ä¸­.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">routine</span><span class="params">()</span></span> &#123; </span><br><span class="line">    <span class="keyword">var</span> value = step1()</span><br><span class="line">    <span class="comment">// note: è¿™é‡Œç”¨åˆ°äº† partial application è¯­æ³•. å½“ç„¶ä¹Ÿå¯ä»¥æ„é€ ä¸€ä¸ªä¸´æ—¶çš„ closure, åŒ…ä¸€å±‚è°ƒç”¨.</span></span><br><span class="line">    value = step2(value, <span class="keyword">self</span>.util1, <span class="keyword">self</span>.util2)</span><br><span class="line">    step3(value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">step1</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123; <span class="comment">/* same as before */</span> &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">step3</span><span class="params">(<span class="number">_</span> value: Int)</span></span> &#123; <span class="comment">/* same as before */</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">step2</span><span class="params">(<span class="number">_</span> input: Int, </span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="number">_</span> util1: <span class="params">()</span></span></span> -&gt; <span class="type">Int</span>, </span><br><span class="line">    <span class="number">_</span> util2: (<span class="type">Int</span>) -&gt; <span class="type">Int</span></span><br><span class="line">  ) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    input</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">util1</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123; <span class="comment">/* same as before */</span> &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">util2</span><span class="params">(<span class="number">_</span> value: Int)</span></span> -&gt; <span class="type">Int</span> &#123; <span class="comment">/* same as before */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span>: <span class="title">Base</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">step2</span><span class="params">(<span class="number">_</span> input: Int, </span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="number">_</span> util1: <span class="params">()</span></span></span> -&gt; <span class="type">Int</span>,</span><br><span class="line">    <span class="number">_</span> util2: (<span class="type">Int</span>) -&gt; <span class="type">Int</span></span><br><span class="line">  ) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    util1() + util2(input)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> object: <span class="type">Base</span> = <span class="type">Derived</span>()</span><br><span class="line">object.routine()</span><br><span class="line"></span><br><span class="line"><span class="comment">// compiler error</span></span><br><span class="line">object.util1()</span><br></pre></td></tr></table></figure><p>å½“ protected æ–¹æ³•æ¯”è¾ƒå¤šæ—¶, ä¸Šé¢çš„æ–¹å¼å¯èƒ½é€ æˆå…è®¸å­ç±»æ‰©å±•åŠŸèƒ½çš„é‚£äº›æ–¹æ³•æ‹¥æœ‰å¤ªé•¿çš„ç­¾å, æ­¤æ—¶å¯ä»¥é€šè¿‡è¿›ä¸€æ­¥æŠŠ protected æ–¹æ³•ç”¨ struct æˆ– protocol åŒ…è£…ä¸€ä¸‹, ä½œä¸º 1 ä¸ªå‚æ•°ä¼ é€’ç»™å­ç±». åªè¦æ³¨æ„æŠŠå°è£…äº† protected æ–¹æ³•çš„ç±»å‹å®šä¹‰ä¸º private, å°±å¯ä»¥ä¿è¯è¿™äº›æ–¹æ³•ä¸å¯èƒ½åœ¨å…è®¸å­ç±»æ‰©å±•çš„é‚£ä¸ªæ–¹æ³•ä»¥å¤–çš„åœ°æ–¹è¢«è°ƒç”¨.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ProtectedMethods</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">util1</span><span class="params">()</span></span>  -&gt; <span class="type">Int</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">util2</span><span class="params">(<span class="number">_</span> value: Int)</span></span> -&gt; <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Protected</span>: <span class="title">ProtectedMethods</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">unowned</span> <span class="keyword">let</span> base: <span class="type">Base</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> base: <span class="type">Base</span>) &#123;</span><br><span class="line">      <span class="keyword">self</span>.base = base</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">util1</span><span class="params">()</span></span>  -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">      base.util1()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">util2</span><span class="params">(<span class="number">_</span> value: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">      base.util2(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">routine</span><span class="params">()</span></span> &#123; </span><br><span class="line">    <span class="keyword">var</span> value = step1()</span><br><span class="line">    value = step2(value, <span class="type">Protected</span>(<span class="keyword">self</span>))</span><br><span class="line">    step3(value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">step1</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123; <span class="comment">/* same as before */</span>&#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">step3</span><span class="params">(<span class="number">_</span> value: Int)</span></span> &#123; <span class="comment">/* same as before */</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">step2</span><span class="params">(<span class="number">_</span> input: Int, <span class="number">_</span> protected: ProtectedMethods)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    input</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">util1</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123; <span class="comment">/* same as before */</span> &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">util2</span><span class="params">(<span class="number">_</span> value: Int)</span></span> -&gt; <span class="type">Int</span> &#123; <span class="comment">/* same as before */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span>: <span class="title">Base</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">step2</span><span class="params">(<span class="number">_</span> input: Int, <span class="number">_</span> protected: ProtectedMethods)</span></span> &#123;</span><br><span class="line">    protected.util1() + protected.util2(input)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°, åªè¦è·³å‡ºå…¶ä»–è¯­è¨€ä¸­ protected ä½¿ç”¨å§¿åŠ¿çš„æ€ç»´é™åˆ¶, é€šè¿‡è°ƒæ•´ API çš„è®¾è®¡, æˆ‘ä»¬ä¹Ÿèƒ½åœ¨ Swift ä¸­è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœ.</p><h2 id="receive-äº†è§£-swift-runtime-å®ç°"><a class="markdownIt-Anchor" href="#receive-äº†è§£-swift-runtime-å®ç°"></a> Receive: äº†è§£ Swift Runtime å®ç°</h2><p>æœ€è¿‘æˆ‘åœ¨é˜…è¯»ä¸€ä½å‰ Apple é›‡å‘˜, å‰ Swift Core Team æˆå‘˜ Jordan Rose ä»Šå¹´åœ¨å…¶ blog ä¸Šå†™çš„ Swift ç³»åˆ—æ–‡ç« . ä¸šç•Œç³»ç»Ÿæ€§ä»‹ç» Swift ç¼–è¯‘å™¨çš„æ–‡ç« <a href="https://medium.com/@slavapestov/the-secret-life-of-types-in-swift-ff83c3c000a5" target="_blank" rel="noopener">å°‘ä¹‹åˆå°‘</a>, è€Œæœ‰çš„ä¸€äº›, ä»æ—¶é—´ä¸Šè¯´ä¹Ÿä¸èƒ½ä»£è¡¨ â€œstate of the artâ€ çš„ Swift å®ç°. å› æ­¤ä»–çš„è¿™ä¸€ç³»åˆ—æ–‡ç« å¿…å®šè®© Swift çˆ±å¥½è€…å—ç›ŠåŒªæµ….</p><p>Jordan æœ€åˆæ˜¯æƒ³åœ¨ä¸€å°è€å¼çš„è¿è¡Œ Mac OS 9 ç³»ç»Ÿçš„ç”µè„‘ä¸Šè¿è¡Œ Swift, ä¸ºäº†è¾¾åˆ°è¿™ä¸ªçº¯ç²¹æ˜¯æŠ€æœ¯æ€§è¿½æ±‚çš„ç›®çš„, ä»–éœ€è¦å¯¹ Swift ç¼–è¯‘å™¨åšä¸€äº›è°ƒæ•´, ä½¿ä¹‹èƒ½æŠŠè¾“å…¥çš„ Swift æºæ–‡ä»¶è½¬æ¢æˆèƒ½åœ¨ Mac OS 9 ä¸Šè¿è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶. ä½œè€…è¯´, è¿™ä¸ªè¿‡ç¨‹å¯¹ä»–è€Œè¨€ä¹Ÿæ˜¯ä¸€ä¸ªä¸æ–­å­¦ä¹ çš„è¿‡ç¨‹, åŠ æ·±äº†ä»–å¯¹ Swift runtime å’Œç¼–è¯‘å™¨å„ä¸ªéƒ¨åˆ†çš„ç†è§£, äºæ˜¯å†³å®šæŠŠè¿™éƒ¨åˆ†åˆ†äº«ç»™ Swift ç¤¾åŒº.</p><p>æˆªæ­¢åˆ°ç›®å‰ä¸€å…±æœ‰ 7 ç¯‡ä»‹ç» Swift åŸç†çš„ blog:</p><ul><li><a href="https://belkadan.com/blog/2020/08/Swift-Runtime-Heap-Objects/" target="_blank" rel="noopener">The Swift Runtime: Heap Objects</a></li><li><a href="https://belkadan.com/blog/2020/09/Swift-Runtime-Type-Layout/" target="_blank" rel="noopener">The Swift Runtime: Type Layout</a></li><li><a href="https://belkadan.com/blog/2020/09/Swift-Runtime-Type-Metadata/" target="_blank" rel="noopener">The Swift Runtime: Type Metadata</a></li><li><a href="https://belkadan.com/blog/2020/09/Swift-Runtime-Uniquing-Caches/" target="_blank" rel="noopener">The Swift Runtime: Uniquing Caches</a></li><li><a href="https://belkadan.com/blog/2020/09/Swift-Runtime-Class-Metadata/" target="_blank" rel="noopener">The Swift Runtime: Class Metadata</a></li><li><a href="https://belkadan.com/blog/2020/10/Swift-Runtime-Class-Metadata-Initialization/" target="_blank" rel="noopener">The Swift Runtime: Class Metadata Initialization</a></li><li><a href="https://belkadan.com/blog/2020/10/Swift-Runtime-Enums/" target="_blank" rel="noopener">The Swift Runtime: Enums</a></li></ul><p>ç”±äºä¸€äº›æ—¶é—´åŸå› , è¿™ä¸€äº›åˆ—æš‚æ—¶æ˜¯åœæ›´çš„çŠ¶æ€, ä½†å¤§ä½¬è¯´ä¹‹åä¼šç»§ç»­.</p><h2 id="algorithm-longest-valid-parentheses"><a class="markdownIt-Anchor" href="#algorithm-longest-valid-parentheses"></a> Algorithm: Longest Valid Parentheses</h2><h3 id="é¢˜ç›®"><a class="markdownIt-Anchor" href="#é¢˜ç›®"></a> é¢˜ç›®</h3><p>æ¥è‡ª <a href="https://leetcode.com/problems/longest-valid-parentheses/" target="_blank" rel="noopener">LeetCode</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Given a string containing just the characters '(' and ')', find the length of the longest valid (well-formed) parentheses substring.</span><br><span class="line"></span><br><span class="line">Example 1:</span><br><span class="line"></span><br><span class="line">  Input: s = "(()"</span><br><span class="line">  Output: 2</span><br><span class="line">  Explanation: The longest valid parentheses substring is "()".</span><br><span class="line"></span><br><span class="line">Example 2:</span><br><span class="line"></span><br><span class="line">  Input: s = ")()())"</span><br><span class="line">  Output: 4</span><br><span class="line">  Explanation: The longest valid parentheses substring is "()()".</span><br></pre></td></tr></table></figure><h3 id="å®ç°"><a class="markdownIt-Anchor" href="#å®ç°"></a> å®ç°</h3><p>ä½¿ç”¨åŠ¨æ€è§„åˆ’æ€æƒ³, åœ¨éå†æ¯ä¸ªå­—ç¬¦çš„è¿‡ç¨‹ä¸­, è®°å½•ä»¥å½“å‰å­—ç¬¦ä¸ºç»“æŸå­—ç¬¦çš„æœ€å¤§åŒ¹é…çš„æ‹¬å·é•¿åº¦. è¿™æ ·ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯å¦äº§ç”ŸåŒ¹é…, ä»¥åŠåŒ¹é…çš„é•¿åº¦å¯ä»¥å®Œå…¨ç”±å½“å‰å­—ç¬¦å†³å®š.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestValidParentheses</span><span class="params">(<span class="number">_</span> s: String)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> s.isEmpty &#123; <span class="keyword">return</span> <span class="number">0</span> &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> c1 = <span class="type">Character</span>(<span class="string">"("</span>).asciiValue!</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¿å­˜æœ€å¤§çš„é•¿åº¦</span></span><br><span class="line">  <span class="keyword">var</span> runningLength = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> length = s.utf8.<span class="built_in">count</span></span><br><span class="line">  <span class="keyword">return</span> s.withCString &#123; pointer <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// ä¿å­˜å„ä¸ªå­—ç¬¦å¯¹åº”çš„æœ€å¤§é•¿åº¦</span></span><br><span class="line">    <span class="keyword">var</span> bookkeeping = [<span class="number">0</span>]</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span>..&lt;length &#123;</span><br><span class="line">      <span class="keyword">let</span> current = pointer[i]</span><br><span class="line">      <span class="keyword">if</span> current == c1 &#123;</span><br><span class="line">        <span class="comment">// å½“å‰å­—ç¬¦ä¸º "(", ä¸å¯èƒ½åŒ¹é…</span></span><br><span class="line">        bookkeeping.append(<span class="number">0</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å½“å‰å­—ç¬¦ä¸º ")"</span></span><br><span class="line">        <span class="comment">// æ‰¾åˆ°ä¹‹å‰ä½ç½® (i - 1) çš„å­—ç¬¦å¯¹åº”åŒ¹é…çš„å¼€å§‹çš„å‰ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">        <span class="keyword">let</span> evenSide = i - <span class="number">1</span> - bookkeeping[i - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">guard</span> evenSide &gt;= <span class="number">0</span> &amp;&amp; pointer[evenSide] == c1 <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// è‹¥è¯¥å­—ç¬¦æ˜¯ ")", è¯´æ˜ä¸å¯èƒ½åŒ¹é…</span></span><br><span class="line">          bookkeeping.append(<span class="number">0</span>)</span><br><span class="line">          <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¯¥å­—ç¬¦æ˜¯ "(", è¯´æ˜å¯ä»¥åŒ¹é…. åŒ¹é…çš„é•¿åº¦æ˜¯: åœ¨å‰ä¸€ä¸ªå­—ç¬¦çš„åŒ¹é…é•¿åº¦åŸºç¡€ä¸Š, å¢åŠ å‰ä¸€ä¸ªå­—ç¬¦åŒ¹é…å¼€å§‹å¤„å†å‰ä¸€ä¸ªå­—ç¬¦å¯¹åº”çš„åŒ¹é…é•¿åº¦</span></span><br><span class="line">        <span class="keyword">let</span> maxLength = i - evenSide + <span class="number">1</span> +</span><br><span class="line">          (evenSide &gt; <span class="number">0</span> ? bookkeeping[evenSide - <span class="number">1</span>] : <span class="number">0</span>)</span><br><span class="line">        bookkeeping.append(maxLength)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ›´æ–°å…¨å±€ max</span></span><br><span class="line">        <span class="keyword">if</span> maxLength &gt; runningLength &#123;</span><br><span class="line">          runningLength = maxLength</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> runningLength</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ä¸­ä½¿ç”¨äº†<code>withCString</code>, åœ¨ä¸äº§ç”Ÿ copy çš„æƒ…å†µä¸‹å…è®¸äº† random access çš„ indexing æ“ä½œ, å¢å¼ºäº†æ€§èƒ½.</p><h3 id="æ€§èƒ½åˆ†æ"><a class="markdownIt-Anchor" href="#æ€§èƒ½åˆ†æ"></a> æ€§èƒ½åˆ†æ</h3><p>ç”±äºä½¿ç”¨åŠ¨æ€è§„åˆ’æ€æƒ³, ä¸Šé¢çš„å®ç°åªä½¿ç”¨ä¸€æ¬¡éå†, æ—¶é—´å¤æ‚åº¦ä»…ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>. äº‹å®ä¸Šåœ¨ leetcode ä¸Šçš„è¿è¡Œç»“æœä¹Ÿæ˜¯ â€œsuper fastâ€ çš„ğŸ˜.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;ul class=&quot;markdownIt-TOC&quot;&gt;
&lt;li&gt;&lt;a href=&quot;#tip-%E5%9C%A8-swift-%E4%B8%AD%E5%AE%9E%E7%8E%B0-protected-%E5%AF%B9%E5%BA%94%E7%9A%84%E5%8A%9F%E8%83%BD&quot;&gt;Tip: åœ¨ Swift ä¸­å®ç° protected å¯¹åº”çš„åŠŸèƒ½&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#receive-%E4%BA%86%E8%A7%A3-swift-runtime-%E5%AE%9E%E7%8E%B0&quot;&gt;Receive: äº†è§£ Swift Runtime å®ç°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#algorithm-longest-valid-parentheses&quot;&gt;Algorithm: Longest Valid Parentheses&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E9%A2%98%E7%9B%AE&quot;&gt;é¢˜ç›®&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%AE%9E%E7%8E%B0&quot;&gt;å®ç°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90&quot;&gt;æ€§èƒ½åˆ†æ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;
&lt;hr&gt;</summary>
    
    
    
    <category term="TRA" scheme="https://crystdragon.github.io/categories/tra/"/>
    
    
  </entry>
  
  <entry>
    <title>TRA-2</title>
    <link href="https://crystdragon.github.io/2020/tra-2/"/>
    <id>https://crystdragon.github.io/2020/tra-2/</id>
    <published>2020-11-29T12:57:49.000Z</published>
    <updated>2020-11-29T14:24:26.127Z</updated>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#tip-%E7%BB%9F%E4%B8%80%E9%9A%90%E8%97%8F-type-%E7%9A%84-property-setter">Tip: ç»Ÿä¸€éšè— Type çš„ property setter</a></li><li><a href="#receive-%E5%9C%A8-app-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%94%B6%E9%9B%86-code-coverage-%E4%BF%A1%E6%81%AF">Receive: åœ¨ App è¿è¡Œæ—¶æ”¶é›† code coverage ä¿¡æ¯</a></li><li><a href="#algorithm-divide-two-integers">Algorithm: Divide Two Integers</a><ul><li><a href="#%E9%A2%98%E7%9B%AE">é¢˜ç›®</a></li><li><a href="#%E5%AE%9E%E7%8E%B0">å®ç°</a></li></ul></li></ul></p><hr><a id="more"></a><h2 id="tip-ç»Ÿä¸€éšè—-type-çš„-property-setter"><a class="markdownIt-Anchor" href="#tip-ç»Ÿä¸€éšè—-type-çš„-property-setter"></a> Tip: ç»Ÿä¸€éšè— Type çš„ property setter</h2><p>åœ¨ç¼–å†™ç¨‹åºæ—¶, ç»å¸¸éœ€è¦ä»”ç»†è®¾è®¡ä¸€ä¸ª model çš„å„ä¸ª property çš„è¯»å†™æ€§è´¨. é€šå¸¸, ä¸ºäº†æ–¹ä¾¿, æˆ‘ä»¬ä¼šæŠŠ model çš„æ‰€æœ‰ property è®¾ä¸º var, æ¥å…è®¸æˆ‘ä»¬çš„ä¸€éƒ¨åˆ†ä»£ç å¯¹ property è¿›è¡Œå»¶è¿Ÿèµ‹å€¼æˆ–è€…å…¶ä»–ä¿®æ”¹.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// implementation</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getModel</span><span class="params">()</span></span> -&gt; <span class="type">Model</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="type">Model</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// client</span></span><br><span class="line"><span class="keyword">var</span> model = getModel()</span><br><span class="line"><span class="built_in">print</span>(model.value)</span><br><span class="line"><span class="built_in">print</span>(model.name)</span><br><span class="line">model.value = <span class="number">3</span></span><br><span class="line">model.name = <span class="string">"default"</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œ, åœ¨å¤§å‹ç¨‹åºä¸­, æˆ‘ä»¬å¹¶ä¸å¸Œæœ›æ‰€æœ‰è¯¥ model çš„è®¿é—®è€…éƒ½å¯ä»¥éšæ„ä¿®æ”¹ property, å®ƒä»¬åªéœ€è¦ä½¿ç”¨ getter, è€Œä¸åº”è¯¥è°ƒç”¨ setter. äºæ˜¯, æœ‰äº›æƒ…å†µä¸‹ä¼šé€‰æ‹©ç»™ä½¿ç”¨è€…æä¾›å¦ä¸€ä¸ªåªè¯»çš„ model.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ClientModel</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> value: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">init</span>(<span class="number">_</span> model: <span class="type">Model</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.value = model.value</span><br><span class="line">    <span class="keyword">self</span>.name = model.name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// implementation</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getModel2</span><span class="params">()</span></span> -&gt; <span class="type">ClientModel</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="type">ClientModel</span>(<span class="type">Model</span>())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// client</span></span><br><span class="line"><span class="keyword">var</span> model2 = getModel2()</span><br><span class="line"><span class="built_in">print</span>(model2.value)</span><br><span class="line"><span class="built_in">print</span>(model2.name)</span><br><span class="line">model2.value = <span class="number">3</span>        <span class="comment">// compiler error</span></span><br><span class="line">model2.name = <span class="string">"default"</span> <span class="comment">// compiler error</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œ, å¦‚æœå¾ˆå¤š model éƒ½æœ‰è¿™ä¸ªéœ€æ±‚, å°†ä¼šå¯¼è‡´ code ä¸­å‡ºç°å¾ˆå¤šé‡å¤çš„å®ç°ä»£ç .</p><p>ä½¿ç”¨ Swift ä¸­çš„ <a href="https://github.com/apple/swift-evolution/blob/main/proposals/0252-keypath-dynamic-member-lookup.md" target="_blank" rel="noopener">dynamicMenmberLookup çš„ keyPath é™æ€ç‰ˆæœ¬</a>, å¯ä»¥å¤§é‡ç®€åŒ–è¿™ä¸€å·¥ä½œ: æˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ª generic çš„ readonly wrapper, å°±å¯ä»¥å¥—ç”¨åˆ°ä»»æ„çš„ model ç±»å‹ä¸Š.<br>è¿™é‡Œä½¿ç”¨çš„ Swift ç‰¹æ€§ dynamicMenmberLookup å¯ä»¥èµ·åˆ°ç±»ä¼¼ c++ ä¸­é‡è½½ â€œ.â€ å’Œ â€œ-&gt;â€ è¿ç®—ç¬¦çš„æ•ˆæœ, å°†å¯¹æŸä¸ªå¯¹è±¡çš„ property access è½¬å‘åˆ°å¦ä¸€ä¸ªå†…éƒ¨å¯¹è±¡ä¸Š.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dynamicMemberLookup</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ReadOnly</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> _base: <span class="type">T</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(<span class="number">_</span> base: <span class="type">T</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>._base = base</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">subscript</span>&lt;<span class="type">Value</span>&gt;(dynamicMember keyPath: <span class="type">KeyPath</span>&lt;<span class="type">T</span>, <span class="type">Value</span>&gt;) -&gt; <span class="type">Value</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> _base[keyPath: keyPath]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// implementation</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getModel3</span><span class="params">()</span></span> -&gt; <span class="type">ReadOnly</span>&lt;<span class="type">Model</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="type">ReadOnly</span>(<span class="type">Model</span>())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// client</span></span><br><span class="line"><span class="keyword">var</span> model3 = getModel3()</span><br><span class="line"><span class="built_in">print</span>(model3.value)</span><br><span class="line"><span class="built_in">print</span>(model3.name)</span><br><span class="line">model3.value = <span class="number">3</span>        <span class="comment">// compiler error</span></span><br><span class="line">model3.name = <span class="string">"default"</span> <span class="comment">// compiler error</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„å®ç°ä¸­, æˆ‘ä»¬åªæä¾›äº†æ¥å— <code>KeyPath</code> å‚æ•°çš„ subscript, è€Œæ²¡æœ‰æä¾› <code>WritableKeyPath</code> å‚æ•°çš„ç‰ˆæœ¬, ä»è€Œåœ¨æ¥å£ä¸Šæ¶ˆé™¤äº†æ‰€æœ‰ property setter.</p><h2 id="receive-åœ¨-app-è¿è¡Œæ—¶æ”¶é›†-code-coverage-ä¿¡æ¯"><a class="markdownIt-Anchor" href="#receive-åœ¨-app-è¿è¡Œæ—¶æ”¶é›†-code-coverage-ä¿¡æ¯"></a> Receive: åœ¨ App è¿è¡Œæ—¶æ”¶é›† code coverage ä¿¡æ¯</h2><p>æœ€è¿‘å‚åŠ å…¬å¸å†…éƒ¨çš„ä¸€æ¬¡æŠ€æœ¯åˆ†äº«, è¯¥åˆ†äº«ä»‹ç»äº†ä¸€ä¸ªå·¥å…·, å¯ä»¥åœ¨ App æµ‹è¯•è¿‡ç¨‹ä¸­æ”¶é›†å¼€å‘ç¼–å†™çš„ä»£ç çš„è¿è¡Œæƒ…å†µ, åšåˆ°åŠ¨æ€ code coverage æ”¶é›†.</p><p>ä¹‹å‰æˆ‘åªäº†è§£, ä½¿ç”¨ Xcode è·‘ Unit Test æ—¶, Apple ä¼šæ’å…¥ä¸€äº›æ–°çš„ç¼–è¯‘/é“¾æ¥é€‰é¡¹, ç»™è¿è¡Œçš„ code è¿›è¡Œæ’æ¡©, å¹¶åœ¨ code è¿è¡Œå®Œåæ ¹æ®è¿è¡Œæ—¶çš„è®°å½•ä¿¡æ¯ç”ŸæˆæŠ¥å‘Š; ä½†æ˜¯æˆ‘å¹¶ä¸çŸ¥é“è¿è¡Œä¸­çš„ App æœ¬èº«æ˜¯å¦èƒ½è·å–åˆ°è‡ªèº«è¿è¡Œçš„æƒ…å†µ. ç»è¿‡ä¸€äº› searching, åŸæ¥ LLVM æ˜¯æ”¯æŒè¿™ä¸€æ“ä½œçš„, ä¹Ÿæœ‰å®˜æ–¹æ–‡æ¡£è¯¦ç»†æè¿°äº†ä½¿ç”¨å§¿åŠ¿. æ ¸å¿ƒè¦ç‚¹æ‘˜å½•å¦‚ä¸‹:</p><ul><li><a href="https://clang.llvm.org/docs/SourceBasedCodeCoverage.html" target="_blank" rel="noopener">Source-based Code Coverage</a> æè¿°äº†ä¸»è¦çš„ code coverage æµç¨‹<ul><li><a href="https://clang.llvm.org/docs/SourceBasedCodeCoverage.html#using-the-profiling-runtime-without-static-initializers" target="_blank" rel="noopener">Using the profiling runtime without static initializers</a>è¿™ä¸€èŠ‚ä¸»è¦æè¿°äº†å¦‚ä½•åœ¨è¿è¡Œæ—¶è·å–åˆ° profile ä¿¡æ¯<ul><li><code>__llvm_profile_set_filename</code> å¯ä»¥è®¾ç½® profile file çš„è·¯å¾„</li><li><code>__llvm_profile_write_file</code> è°ƒç”¨ä¸€æ¬¡å¯ä»¥æŠŠå½“å‰çš„ profile å†™åˆ°æŒ‡å®šçš„è·¯å¾„</li></ul></li><li>llvm æä¾›äº† llvm-profdata å’Œ llvm-cov ç­‰å·¥å…·æ¥å¤„ç†ç”Ÿæˆçš„ profile æ–‡ä»¶, å¹¶è§£ææˆå¯è¯»çš„ JSON æ ¼å¼</li></ul></li><li><a href="https://clang.llvm.org/docs/UsersManual.html#profiling-with-instrumentation" target="_blank" rel="noopener">Clang æ–‡æ¡£</a>ä¹Ÿæœ‰å…³äº profile çš„ä¸€äº›ä¾‹å­, å¹¶ä¸”è¯¦ç»†é˜è¿°äº†ä¸€äº› compiler flag çš„ç”¨æ³•.</li></ul><h2 id="algorithm-divide-two-integers"><a class="markdownIt-Anchor" href="#algorithm-divide-two-integers"></a> Algorithm: Divide Two Integers</h2><h3 id="é¢˜ç›®"><a class="markdownIt-Anchor" href="#é¢˜ç›®"></a> é¢˜ç›®</h3><p>æ¥è‡ª <a href="https://leetcode.com/problems/divide-two-integers/submissions/" target="_blank" rel="noopener">leetcode</a>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Given two integers dividend and divisor, </span><br><span class="line">divide two integers without using multiplication, </span><br><span class="line">division, and mod operator.</span><br><span class="line"></span><br><span class="line">Return the quotient after dividing dividend by divisor.</span><br><span class="line"></span><br><span class="line">Example:</span><br><span class="line">Input: dividend = 10, divisor = 3</span><br><span class="line">Output: 3</span><br><span class="line">Explanation: 10/3 = truncate(3.33333..) = 3.</span><br></pre></td></tr></table></figure><h3 id="å®ç°"><a class="markdownIt-Anchor" href="#å®ç°"></a> å®ç°</h3><p>ç¦æ­¢ä¹˜æ³•å’Œé™¤æ³•çš„æƒ…å†µä¸‹, ç†è®ºä¸Šè®¡ç®— <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mi mathvariant="normal">/</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">a / b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mord">/</span><span class="mord mathdefault">b</span></span></span></span> åªéœ€è¦åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> ä¸Šä¸æ–­å‡å» <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span>, ç›´åˆ°æ— æ•°å¯å‡. ä½†è¿™æ ·æ€§èƒ½ä¸é«˜, å®é™…ä¸Šéšç€å•†çš„ä½æ•°å¢åŠ , æ¯æ¬¡å¯ä»¥å‡çš„å¯ä»¥æ¯” <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> æ›´å¤š. å¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mi mathvariant="normal">/</mi><mi>b</mi><mo>=</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">a / b = c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mord">/</span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span></span></span></span>, æŠŠ c æŒ‰äºŒè¿›åˆ¶æ–¹å¼å†™æˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mi>k</mi></msub><msub><mi>c</mi><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>c</mi><mn>1</mn></msub><msub><mi>c</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">c_k c_{k-1} ... c_1 c_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, æ¯ä¸€ä½çš„è´¡çŒ®æ˜¯åä¸€é¡¹çš„ä¸¤å€.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">divide</span><span class="params">(<span class="number">_</span> dividend: Int, <span class="number">_</span> divisor: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> dividend &lt;= <span class="type">Int32</span>.<span class="built_in">min</span> &amp;&amp; divisor == -<span class="number">1</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Int</span>(<span class="type">Int32</span>.<span class="built_in">max</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> isPositive = (dividend &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>) ^ (divisor &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> dividend = dividend &gt; <span class="number">0</span> ? dividend : -dividend</span><br><span class="line">  <span class="keyword">let</span> divisor = divisor &gt; <span class="number">0</span> ? divisor : -divisor</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> divisor &gt; dividend &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/// æ„é€ ä½™æ•°å„ä½çš„è´¡çŒ®, å¯¹åº”ä½™æ•°æ¯ä¸€ä½ä¹˜ä»¥é™¤æ•°åçš„å€¼</span></span><br><span class="line">  <span class="keyword">var</span> factors: [(<span class="type">Int</span>, <span class="type">Int</span>)] = []</span><br><span class="line">  <span class="keyword">var</span> factor = divisor</span><br><span class="line">  <span class="keyword">var</span> scale = <span class="number">1</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">repeat</span> &#123;</span><br><span class="line">    factors.append((factor, scale))</span><br><span class="line">    factor *= <span class="number">2</span></span><br><span class="line">    scale *= <span class="number">2</span></span><br><span class="line">  &#125; <span class="keyword">while</span> (factor &lt;= dividend)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> result = <span class="number">0</span></span><br><span class="line">  <span class="keyword">var</span> remaining = dividend</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/// ä»è´¡çŒ®é«˜çš„ä½å¼€å§‹ä¸æ–­å°è¯•, å¤Ÿå‡å°±è¡¨ç¤ºè¯¥ä½ä¸º 1</span></span><br><span class="line">  <span class="keyword">for</span> (factor, scale) <span class="keyword">in</span> factors.reversed() &#123;</span><br><span class="line">    <span class="keyword">if</span> remaining &gt;= factor &#123;</span><br><span class="line">      result += scale</span><br><span class="line">      remaining -= factor</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> isPositive ? result : -result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;ul class=&quot;markdownIt-TOC&quot;&gt;
&lt;li&gt;&lt;a href=&quot;#tip-%E7%BB%9F%E4%B8%80%E9%9A%90%E8%97%8F-type-%E7%9A%84-property-setter&quot;&gt;Tip: ç»Ÿä¸€éšè— Type çš„ property setter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#receive-%E5%9C%A8-app-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%94%B6%E9%9B%86-code-coverage-%E4%BF%A1%E6%81%AF&quot;&gt;Receive: åœ¨ App è¿è¡Œæ—¶æ”¶é›† code coverage ä¿¡æ¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#algorithm-divide-two-integers&quot;&gt;Algorithm: Divide Two Integers&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E9%A2%98%E7%9B%AE&quot;&gt;é¢˜ç›®&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%AE%9E%E7%8E%B0&quot;&gt;å®ç°&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;
&lt;hr&gt;</summary>
    
    
    
    <category term="TRA" scheme="https://crystdragon.github.io/categories/tra/"/>
    
    
  </entry>
  
  <entry>
    <title>TRA-1</title>
    <link href="https://crystdragon.github.io/2020/tra-1/"/>
    <id>https://crystdragon.github.io/2020/tra-1/</id>
    <published>2020-11-10T04:05:40.000Z</published>
    <updated>2020-11-11T11:47:12.564Z</updated>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#tip-%E5%90%8C%E6%AD%A5-uiview-animation-%E5%92%8C-calayer-animation">Tip: åŒæ­¥ UIView animation å’Œ CALayer animation</a><ul><li><a href="#%E9%97%AE%E9%A2%98%E6%9D%A5%E6%BA%90">é—®é¢˜æ¥æº</a></li><li><a href="#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95">è§£å†³åŠæ³•</a></li></ul></li><li><a href="#receive-swift-concurrency">Receive: Swift Concurrency</a></li><li><a href="#algorithm-substring-with-concatenation-of-all-words">Algorithm: Substring with Concatenation of All Words</a><ul><li><a href="#%E9%A2%98%E7%9B%AE">é¢˜ç›®</a></li><li><a href="#%E5%88%86%E6%9E%90">åˆ†æ</a></li><li><a href="#%E5%AE%9E%E7%8E%B0">å®ç°</a></li><li><a href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90">æ€§èƒ½åˆ†æ</a></li></ul></li></ul></p><hr><p>TRA æ˜¯ç®€åŒ–ç‰ˆçš„ <a href="https://mp.weixin.qq.com/s/WMlApIA-v8zpB9l-VlMlyw" target="_blank" rel="noopener">ARTS</a>, å‘¨æœŸæ˜¯ä¸¤å‘¨ä¸€æ¬¡ã€‚å…¶ä¸­</p><ul><li>T æ˜¯ Tip, æ€»ç»“å’Œå½’çº³æ—¥å¸¸ä¸­é‡åˆ°çš„çŸ¥è¯†ç‚¹.</li><li>R æ˜¯ Receive, æ–°çŸ¥è¯†çš„è¾“å…¥(æŠ€æœ¯ã€ç†è´¢ã€å“²å­¦ã€æ–‡åŒ–ç­‰)éƒ½ç®—åœ¨å†….</li><li>A æ˜¯ Algorithm, ç®—æ³•å°ç»ƒä¹ .</li></ul><hr><a id="more"></a><h2 id="tip-åŒæ­¥-uiview-animation-å’Œ-calayer-animation"><a class="markdownIt-Anchor" href="#tip-åŒæ­¥-uiview-animation-å’Œ-calayer-animation"></a> Tip: åŒæ­¥ UIView animation å’Œ CALayer animation</h2><h3 id="é—®é¢˜æ¥æº"><a class="markdownIt-Anchor" href="#é—®é¢˜æ¥æº"></a> é—®é¢˜æ¥æº</h3><p>è‡ªå·±åœ¨å¼€å‘ä¸€ä¸ªéœ€æ±‚çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†è¿™æ ·çš„é—®é¢˜:</p><p>ä¹‹å‰æœ‰å®ç°å¥½æœ‰ä¸€ä¸ªå†…éƒ¨é€šè¿‡ <code>CAShaperLayer</code> ç»˜åˆ¶ path çš„å°è£…å¥½çš„ <code>UIView</code>. ç°åœ¨è¦åœ¨è¿™ä¸ª view ä¸Šå®ç°ä¸€ä¸ªåŠ¨ç”»æ•ˆæœ:  åŒæ—¶åŠ¨ç”»æ–¹å¼æ”¹å˜è¿™ä¸ª view çš„ <code>frame</code>/<code>transform</code> å’Œå†…éƒ¨çš„ path.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> pathLayer = <span class="type">CAShapeLayer</span>()</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">setPath</span><span class="params">(<span class="number">_</span> path: CGPath?)</span></span> &#123;</span><br><span class="line">    pathLayer.path = path</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€å¼€å§‹çš„å°è¯•æ–¹å¼:</p><ul><li>é’ˆå¯¹ view çš„ ä½ç½®åŠ¨ç”», ä½¿ç”¨ <code>UIView.animate(withDuration:animations:)</code>.</li><li>é’ˆå¯¹ layer çš„ path åŠ¨ç”», æ‰‹åŠ¨åˆ›å»º <code>CABasicAnimation</code>, å¹¶ add åˆ° layer ä¸Š. ä¹‹æ‰€ä»¥ç”¨ explicit animation, æ˜¯å› ä¸º:<br>è™½ç„¶ <code>CAShaperLayer</code> çš„ <code>path</code> æ˜¯æ ‡è®°æˆ animatable çš„, ä½†æ˜¯å’Œ layer çš„å…¶ä»–å±æ€§(ä¾‹å¦‚ <code>bounds</code> ç­‰)ä¸åŒ, ç›´æ¥è®¾ç½® <code>path</code> æ˜¯ä¸ä¼šäº§ç”Ÿ implicit animation çš„. <a href="https://developer.apple.com/documentation/quartzcore/cashapelayer/1521904-path" target="_blank" rel="noopener">è¿™ä¸¤ç‚¹éƒ½åœ¨æ–‡æ¡£ä¸­æœ‰æ˜ç¡®æ ‡æ˜</a>.</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> pathLayer = <span class="type">CAShapeLayer</span>()</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">setPath</span><span class="params">(<span class="number">_</span> path: CGPath?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> animation = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"path"</span>)</span><br><span class="line">    animation.fromValue = pathLayer.presentationLayer!.path</span><br><span class="line">    animation.toValue = path</span><br><span class="line">    animation.duration = <span class="number">0.2</span></span><br><span class="line">    pathLayer.add(animation, forKey: <span class="string">"animatedPath"</span>)</span><br><span class="line">    pathLayer.path = path</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">/// åŠ¨ç”»è°ƒç”¨</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MyView</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">performAnimation</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">UIView</span>.animate(withDuration: <span class="number">0.2</span>) &#123;</span><br><span class="line">      <span class="keyword">self</span>.frame = <span class="comment">// new frame</span></span><br><span class="line">      <span class="keyword">self</span>.transform = <span class="comment">// new transform</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// option 1: setPath å†™åœ¨ animation block é‡Œ</span></span><br><span class="line">      <span class="keyword">self</span>.setPath(<span class="comment">/* new path */</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// option 2: setPath å†™åœ¨ animation block å¤–</span></span><br><span class="line">    <span class="keyword">self</span>.setPath(<span class="comment">/* new path */</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶è€Œä»…ä»…è¿™ä¹ˆåšä¼šå¯¼è‡´ view å’Œ layer çš„ animation æ— æ³•åŒæ—¶ä½œç”¨</p><ul><li>æœ‰æ—¶å€™æ˜¯å‡ºç°äº†å¯åŠ¨çš„æ—¶é—´å·®</li><li>æœ‰æ—¶å€™æ˜¯ä¸€ä¸ª animation åƒæ‰äº†å¦ä¸€ä¸ª animation, UI ä¸Šå‡ºç°çªå˜è€Œä¸æ˜¯ 2 ä¸ªåŠ¨ç”»åŒæ—¶è¿›è¡Œ</li></ul><h3 id="è§£å†³åŠæ³•"><a class="markdownIt-Anchor" href="#è§£å†³åŠæ³•"></a> è§£å†³åŠæ³•</h3><p>è€ƒè™‘åˆ° <code>UIView.animate()</code> æœ¬è´¨ä¸Šå°±æ˜¯ä¾é </p><ul><li><code>UIView</code> è®¾ç½®è‡ªå·±æˆä¸º <code>self.layer</code> çš„ <code>delegate</code>, å¹¶ä¸”</li><li>åœ¨ animation block è°ƒç”¨æœŸé—´, é’ˆå¯¹ä¸åŒçš„ property å˜åŒ–é€šè¿‡ <code>CALayerDelegate</code> ä¸­çš„ <code>action(for:forKey:)</code> æä¾› implicit animation</li></ul><p>æ¥å®ç°çš„. è€Œæ—¢ç„¶ <code>UIView.animate()</code> å¯ä»¥æŠŠä¸€ç³»åˆ— animation åŒæ—¶å¯åŠ¨, æˆ‘ä»¬åªéœ€è¦ä¹Ÿç”¨ç±»ä¼¼çš„æ–¹å¼, åœ¨åŒæ ·çš„æ—¶åˆ»æä¾› path åŠ¨ç”»å³å¯. è€Œæƒ³è¦å‚ä¸ layer çš„ implicit animation çš„è‡ªå®šä¹‰è¿‡ç¨‹, æœ‰å¤šç§é€”å¾„, ä¾‹å¦‚:</p><ul><li>å®ç°è‡ªå®šä¹‰çš„ layer subclass, é‡å†™ <code>defaultAction(forKey:)</code></li><li>ç»™å•ç‹¬çš„ layer å¢åŠ  delegate, é‡å†™ <code>action(for:forKey:)</code></li><li>å®ç°è‡ªå®šä¹‰çš„ view subclass, æŒ‡å®š <code>layerClass</code>, å¹¶é‡å†™ <code>action(for:forKey:)</code></li></ul><p>ç­‰. ä»¥ä¸‹ä»¥å•ç‹¬å¢åŠ  delegate ä¸ºä¾‹å­.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> pathLayer = <span class="type">CAShapeLayer</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomLayerDelegate</span>: <span class="title">NSObject</span>, <span class="title">CALayerDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">action</span><span class="params">(<span class="keyword">for</span> layer: CALayer, forKey event: String)</span></span> -&gt; <span class="type">CAAction?</span> &#123;</span><br><span class="line">      <span class="keyword">guard</span> event == <span class="string">"path"</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">let</span> animation = <span class="type">CABasicAnimation</span>(keyPath: event)</span><br><span class="line">      animation.fromValue = layer.presentationLayer!.path</span><br><span class="line">      animation.toValue = path</span><br><span class="line">      animation.duration = <span class="number">0.2</span></span><br><span class="line">      <span class="keyword">return</span> animation</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> pathLayerDelegate = <span class="type">CustomLayerDelegate</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>(frame: <span class="type">CGRect</span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frame)</span><br><span class="line">    pathLayer.delegate = pathLayerDelegate</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">setPath</span><span class="params">(<span class="number">_</span> path: CGPath?)</span></span> &#123;</span><br><span class="line">    pathLayer.path = path</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// åŠ¨ç”»è°ƒç”¨</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MyView</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">performAnimation</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">UIView</span>.animate(withDuration: <span class="number">0.2</span>) &#123;</span><br><span class="line">      <span class="keyword">self</span>.frame = <span class="comment">// new frame</span></span><br><span class="line">      <span class="keyword">self</span>.transform = <span class="comment">// new transform</span></span><br><span class="line">      <span class="keyword">self</span>.setPath(<span class="comment">/* new path */</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ¯æ¬¡åœ¨ <code>UIView.animate()</code> çš„ animation block ä¸­å¦‚æœæ›´æ”¹äº† layer çš„ <code>path</code>, å°±ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ª implicit animation, å¹¶ä¸”èƒ½å’Œå…¶ä»– view animation å¹¶è¡Œäº§ç”Ÿä½œç”¨.</p><h2 id="receive-swift-concurrency"><a class="markdownIt-Anchor" href="#receive-swift-concurrency"></a> Receive: Swift Concurrency</h2><p>å…³äº Swift ä¸­æ–°çš„å¹¶å‘ç¼–ç¨‹ç‰¹æ€§çš„è®¨è®ºå·²ç»åœ¨å®˜æ–¹ forums <a href="https://forums.swift.org/t/concurrency-async-await-actors/6516" target="_blank" rel="noopener">æŒç»­å¥½å¤šå¹´</a>äº†, æˆ‘ä¸ªäººä¹Ÿä¸€ç›´æŠ±æœ‰æµ“åšçš„å…´è¶£. ä¸Šå‘¨, Swift core team ç»ˆäºæ­£å¼ä»¥ <a href="https://forums.swift.org/t/swift-concurrency-roadmap/41611" target="_blank" rel="noopener">1 ç¯‡ road map</a> å’Œ 4 ç¯‡ proposal åˆç¨¿éš†é‡ä¸ºå„ä½ Swift çˆ±å¥½è€…é“ºå±•å¼€å°†ä¼šæŒç»­æœªæ¥å¤šä¸ªç‰ˆæœ¬çš„é“è·¯. è™½ç„¶è¿™äº›æ–‡æ¡£ä»åœ¨ç§¯æè®¨è®ºä¸­, å’Œç»ˆç¨¿ç›¸æ¯”æƒ³å¿…ä¼šæœ‰å¾ˆå¤§çš„ä¸åŒ, ä½†æˆ‘åšä¿¡, ç›¸å…³çš„æ€æƒ³å’Œè§‚å¿µå°†æ˜¯ä¸€åä¼˜ç§€ Swifter ä»¥åç»•ä¸å¼€çš„å®åº“.</p><p>å¯¹äº iOS å¼€å‘è€…è€Œè¨€, å¼‚æ­¥ç¼–ç¨‹æ˜¯å†ç†Ÿæ‚‰ä¸è¿‡äº†, å¹³æ—¶æ—¥å¸¸å¼€å‘ä¸­å³ä½¿ä¸æ¶‰åŠåˆ°å¤šçº¿ç¨‹é€šä¿¡çš„é—®é¢˜, ä¹Ÿè‡³å°‘æ‡‚å¾—&quot;ç¹çæ“ä½œä¸åº”è¯¥ block ä¸»çº¿ç¨‹&quot;çš„é“ç†. è€Œè¿™æ¬¡ Swift team å¸¦æ¥çš„ proposal ä¸ä½†èƒ½å…å»æˆ‘ä»¬å¼€å‘è€…å¹³æ—¶é‡åˆ°çš„ä¸€äº›çƒ¦æ¼, ä¹Ÿèƒ½åœ¨æ›´é«˜çš„ level ä¸Šç³»ç»ŸåŒ–åœ°è§£å†³å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸€äº›åŸºæœ¬é—®é¢˜.</p><p>è¿™é‡Œæ— æ³•è¯¦è¿°æ‰€æœ‰ç»†èŠ‚, ä»…å°†ç›¸å…³ proposal çš„ä¸»æ—¨æ‘˜å½•äºä¸‹:</p><ul><li><a href="https://github.com/DougGregor/swift-evolution/blob/async-await/proposals/nnnn-async-await.md" target="_blank" rel="noopener">Async/await</a> ä¸ºè¯­è¨€å¼•å…¥äº†ä¸€ç§æ–°çš„ function: async function (åŒ…æ‹¬ method).<ul><li>Async function ä¸æ™®é€š function æ˜¯ä¸¤ä¸ªä¸–ç•Œ, æ— æ³•äº’ç›¸è°ƒç”¨, åªèƒ½åœ¨å„è‡ªçš„ context ä¸­è°ƒç”¨.<ul><li>å£°æ˜æ–¹å¼ <code>func asyncFunction(_ input: Int) async -&gt; Int</code> .</li><li>è°ƒç”¨æ–¹å¼ <code>let result = await asyncFunction(10)</code>.</li></ul></li><li>Async function è°ƒç”¨å, åªèƒ½å¼‚æ­¥åœ°è¿”å›.<ul><li>ä»è¯­æ³•è§’åº¦, å¯ä»¥è®¤ä¸º async function æ˜¯å¸¦ callback block çš„æ™®é€š function çš„è¯­æ³•ç³–.</li><li>ä»è¯­ä¹‰è§’åº¦, async æ˜¯åç¨‹ (coroutine) çš„åº”ç”¨: åœ¨ async context ä¸‹æ¯æ¬¡ await, éƒ½äº§ç”Ÿäº†æ–­ç‚¹, å½“å‰åç¨‹ä¸­æ–­, ç›´åˆ°è¢«è°ƒç”¨çš„ async function å¼‚æ­¥å®Œæˆæ—¶, æ‰ä¼šæŠŠè¿”å›å€¼æä¾›ç»™ caller, caller åç¨‹æ¥ç€ä¸Šæ¬¡æ–­ç‚¹ç»§ç»­æ‰§è¡Œ.</li></ul></li><li>Async function å¯ä»¥æå¤§ç®€åŒ–æ™®é€š function ä¸­å› ä¸ºå¤§é‡ä½¿ç”¨ callback block é€ æˆçš„ä¹¦å†™é—®é¢˜, ä¾‹å¦‚:<ul><li>å›è°ƒåœ°ç‹±â€”â€”æ·±å±‚çš„ callback åµŒå¥—.</li><li>æ•°æ®æµå®¹æ˜“ä¸¢å¤±â€”â€”ä½¿ç”¨ callback æ—¶ç¼–è¯‘å™¨æ— æ³•ä¿è¯, è¢«è°ƒæ–¹æ³•èƒ½ä¸€è‡´åœ°è¿”å›.</li><li>try catch æœºåˆ¶æ— æ³•ç”¨äº callback æ–¹æ³•.</li></ul></li></ul></li><li>Async/await åªæ˜¯å¼•å…¥äº†æœ€åŸºæœ¬çš„å¼‚æ­¥è¯­æ³•, ä½†æ—¥å¸¸åº”ç”¨éœ€è¦æœ‰æ›´é«˜çº§çš„æŠ½è±¡. <a href="https://github.com/DougGregor/swift-evolution/blob/structured-concurrency/proposals/nnnn-structured-concurrency.md" target="_blank" rel="noopener">Structured concurrency</a> åœ¨è¯­è¨€å±‚é¢å¢åŠ äº†è®¸å¤šæœºåˆ¶.<ul><li>è™½ç„¶ async function å¼‚æ­¥æ‰§è¡Œ, ä½†å’Œæ™®é€š function ä¸€æ ·, åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­, å®ƒä¸å®ƒå†…éƒ¨æ‰€æœ‰ await çš„æ“ä½œä¹Ÿå½¢æˆè‡ªç„¶çš„æ ‘çŠ¶&quot;çˆ¶å­&quot;ç»“æ„, ç³»ç»Ÿå¯ä»¥ä¿è¯æ‰€æœ‰å­ä»»åŠ¡ä¸ä¼šæ— æ•…è¶…è¶Šçˆ¶ä»»åŠ¡çš„ç”Ÿå‘½æœŸ.<ul><li>æ”¯æŒåä½œå¼çš„ cancellation: ä»»ä½•å­ä»»åŠ¡è¢« cancel, çˆ¶ä»»åŠ¡ä¼šåŒæ­¥è‡ªåŠ¨è¿›å…¥ cancel çŠ¶æ€, å…¶ä»–æ‰§è¡Œä¸­çš„å­ä»»åŠ¡ä¹Ÿå¯ä»¥ä¸»åŠ¨è·å–åˆ° cancel ä¿¡æ¯.</li><li>åœ¨ä¸€ä¸ªä»»åŠ¡ä¸­éœ€è¦å¤šä¸ªå­ä»»åŠ¡å¹¶å‘å¤„ç†çš„æƒ…å†µä¸‹:<ul><li>å¯ä»¥é€šè¿‡ <code>async let</code> binding å¯ä»¥å¹¶å‘æ‰§è¡Œå¤šä¸ª async function, å¹¶åœ¨åŒä¸€çš„åœ°æ–¹ await å¤šä¸ªä»»åŠ¡çš„å®Œæˆ.</li><li>ä¹Ÿå¯ä»¥é€šè¿‡ <code>Task.Nursery</code> åŠ¨æ€æ–¹å¼å¼€å§‹å’Œç»“æŸä»»æ„æ•°é‡çš„å­ä»»åŠ¡.</li></ul></li></ul></li><li>åœ¨æ¯ä¸€ä¸ª async function,ä¸­ éƒ½å¯ä»¥é€šè¿‡ç³»ç»Ÿæä¾›çš„ <code>Task</code> ç±»å‹, å®ç°è®¸å¤šå¹¶å‘æœºåˆ¶.<ul><li>å¦‚ä¸Šæ‰€è¯´, <code>Task.Nursery</code> å¯ä»¥åŠ¨æ€å¹¶è¡Œå¼€å¯å­ä»»åŠ¡.</li><li>ä½¿ç”¨ <code>Task.isCancelled()</code> ç­‰æ–¹æ³•, å¾—çŸ¥å½“å‰ task æ˜¯å¦è¢«æ ‡è®° cancelled.</li><li>ä½¿ç”¨ <code>Task.withDeadline()</code> å’Œ <code>Task.currentDeadline().remaining</code> å¯ä»¥å¼€å¯æœ‰æ—¶é™çš„ä»»åŠ¡å’Œæ£€æµ‹æ—¶é™æ˜¯å¦å·²è¾¾.</li></ul></li><li><code>Task</code> è¿˜å¯ä»¥è”ç³» async å’Œ non-async ä¸–ç•Œ:<ul><li><code>Task.runDetached()</code> å…è®¸æˆ‘ä»¬ä»æ™®é€šçš„é async ä»£ç è¿›å…¥ä¸€ä¸ª async context, ä»è€Œå¯ä»¥è°ƒç”¨ async function.</li><li><code>Task.withUnsafeContinuation()</code> å…è®¸ä»ä¸€ä¸ª async context ä¸­ä¸´æ—¶è½¬ç§»åˆ° non-async context, æ‰§è¡Œæˆ‘ä»¬çš„åŸºäºæ™®é€š callback block çš„ä»£ç , å¹¶ç­‰å¾…å›è°ƒ.</li></ul></li></ul></li><li>ä¸Šé¢ 2 ä¸ª protocol è§£å†³äº†å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸€äº›æ•ˆç‡é—®é¢˜, è€Œ <a href="https://github.com/DougGregor/swift-evolution/blob/actors/proposals/nnnn-actors.md" target="_blank" rel="noopener">Actors</a> å¯ä»¥å¸®å¿™è§£å†³æ›´å›°éš¾å’Œå±é™©çš„é—®é¢˜â€”â€”å¦‚ä½•ä¿è¯å¹¶å‘ä¸‹çš„è¿è¡Œå®‰å…¨. ä¾‹å¦‚ data race, deadlock.<ul><li>å¼•å…¥äº†ä¸€ç§æ–°çš„ type ç±»åˆ«: <code>actor class</code>.<ul><li>æ¯ä¸€ä¸ª actor class çš„å®ä¾‹å¯¹è±¡, èƒŒåéƒ½æœ‰ä¸€ä¸ª â€œqueueâ€ , è¯­è¨€åˆ¶å®šäº†ä¸€äº›åˆ—è§„åˆ™æ¥ä¿è¯æ‰€æœ‰è¯¥å¯¹è±¡çš„æ–¹æ³•é»˜è®¤éƒ½åªèƒ½åœ¨è¯¥ queue ä¸Šæ‰§è¡Œ, å¹¶ä¸”å½“å‰ actor çš„ value semantics æˆå‘˜éƒ½ä¸ä¼šè¢«å…¶ä»– actor ä¸å®‰å…¨åœ°è®¿é—®. ä»è€Œéƒ¨åˆ†è§£å†³äº† data race é—®é¢˜.<ul><li>è¦è®¿é—®çš„æ˜¯ stored property æ—¶, åªæœ‰å½“ç¼–è¯‘å™¨èƒ½ç¡®ä¿ä»¥ä¸‹æ¡ä»¶æ—¶,  æ‰å…è®¸è®¿é—®: æˆ–è€…èƒ½ä¿è¯è¯¥ property æ˜¯ immutable, æˆ–è€…èƒ½ä¿è¯è®¿é—®åªå‘ç”Ÿåœ¨ <code>self</code> ä¸Š.</li><li>è¦è®¿é—®çš„æ˜¯ non-async æ–¹æ³•æ—¶, åªå…è®¸åœ¨è¯¥ method åœ¨ <code>self</code> ä¸Šè°ƒç”¨, ä¸å…è®¸åœ¨åˆ«çš„å¯¹è±¡ä¸Šè°ƒç”¨.</li><li>è¦è®¿é—®çš„æ˜¯ async æ–¹æ³•æ—¶, æ²¡æœ‰é™åˆ¶. è€Œç”±äºè°ƒç”¨è€…åªèƒ½å¼‚æ­¥ç­‰å¾…è¿”å›, å› æ­¤è§£å†³äº†æ­»é”é—®é¢˜.</li><li>å½“ç„¶é’ˆå¯¹ä¸åŒæƒ…å†µ, proposal ä¹Ÿæä¾›äº†ä¸€äº›æ‰‹æ®µè®©å¼€å‘è€…å¸®ç¼–è¯‘å™¨ä½œå¼ºåˆ¶æŒ‡å®š.</li></ul></li><li>å¯¹äºå…¨å±€æ–¹æ³•, è™½ç„¶ä¸åœ¨ actor class å†…, ä½†å¯ä»¥ç»™å…¶æ ‡è®°å±äºæŸä¸ª global actor, æ‰€æœ‰çš„è®¿é—®éƒ½ç­‰ä»·äºåœ¨è¿™ä¸ª actor singleton ä¸Šæ‰§è¡Œ.</li></ul></li><li>å®˜æ–¹ forums çš„ proposal åªé’ˆå¯¹ value semantics çš„ç±»å‹æä¾›äº†æ£€æŸ¥, è€Œå¯¹å…¶ä»–ç±»å‹çš„æ”¯æŒå°†ä¼šåœ¨ä»¥ååŠ å…¥. è¿™ç­‰äºåœ¨ä»¥åç‰ˆæœ¬åŠ å¼ºäº†è¯­è¨€é™åˆ¶, ä¼šå¯¼è‡´ç°åœ¨ valid çš„ code ä»¥åæŸä¸ªç‰ˆæœ¬ä¸ valid.<ul><li>ç¤¾åŒºä¸­é’ˆå¯¹è¿™ä¸€é—®é¢˜, è®¸å¤šå¤§ä½¬ (æ¯”å¦‚ Christ Lattner, Dave Abrahams) æå‡ºäº†å¦ä¸€ç§ç­–ç•¥: <a href="https://docs.google.com/document/d/1OMHZKWq2dego5mXQtWt1fm-yMca2qeOdCl8YlBG1uwg" target="_blank" rel="noopener">Protocol-based Actor Isolation</a>.</li><li>è¿™ä¸ª proposal é‡Œå»ºè®®ä¸€å¼€å§‹å°±é™åˆ¶å…è®¸åœ¨ä¸åŒ actor æ¥å£é—´ä¼ é€’çš„æ•°æ®çš„ç±»å‹, å¹¶å…è®¸æ ‡å‡†åº“å’Œå¼€å‘è€…æœ‰åŠæ³•è®©è‡ªå·±çš„ç±»å‹æ»¡è¶³è¦æ±‚.</li></ul></li></ul></li><li>æœ€å, Swift å½“å‰çš„é¦–è¦ç”¨æˆ·å¿…ç„¶æ˜¯ ObjC å¼€å‘è€…, è€Œä¸º Swift ç‰¹æ€§å’Œ ObjC äº¤äº’ä¹Ÿå§‹ç»ˆæ˜¯é¦–è¦ä»»åŠ¡ä¹‹ä¸€. å› æ­¤å°† async/await ç”šè‡³ actor å’Œ ObjC æ‰“é€šä¹Ÿå¿…ç„¶ææœ‰æ„ä¹‰. <a href="https://github.com/DougGregor/swift-evolution/blob/concurrency-objc/proposals/NNNN-concurrency-objc.md" target="_blank" rel="noopener">Concurrency Interoperability with Objective-C</a> å°±ç»™è¿™ä¸€å—è¡¥ä¸Šäº†è®¸å¤šæ”¯æŒ.<ul><li>ObjC ä¸­ç¼–å†™çš„åŸºäº callback block çš„æ–¹æ³•, åœ¨ bridge åˆ° Swift æ—¶, é™¤äº†åŸæœ‰çš„ API, ç¬¦åˆæ¡ä»¶æ—¶è¿˜ä¼šé¢å¤–ç”Ÿæˆä¸€ä¸ª async API.</li><li>Swift ä¸­ç¼–å†™çš„ async API, ç”¨ <code>@objc</code> æš´éœ²ç»™ ObjC æ—¶, ä¼šè‡ªåŠ¨è½¬æ¢æˆ callback block å½¢å¼.</li><li>Swift ä¸­ç¼–å†™çš„ actor class, å…¶ <code>@objc</code> æ–¹æ³•æš´éœ²ç»™ ObjC è°ƒç”¨æ—¶, ä¼šè‡ªåŠ¨æ‰§è¡Œåœ¨å¯¹åº” actor çš„ â€œqueueâ€ ä¸Š.</li></ul></li></ul><h2 id="algorithm-substring-with-concatenation-of-all-words"><a class="markdownIt-Anchor" href="#algorithm-substring-with-concatenation-of-all-words"></a> Algorithm: Substring with Concatenation of All Words</h2><h3 id="é¢˜ç›®"><a class="markdownIt-Anchor" href="#é¢˜ç›®"></a> é¢˜ç›®</h3><p>æ¥è‡ª <a href="https://leetcode.com/problems/substring-with-concatenation-of-all-words/" target="_blank" rel="noopener">leetcode</a>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€äº›é•¿åº¦ç›¸åŒçš„å•è¯ wordsã€‚æ‰¾å‡º s ä¸­æ°å¥½å¯ä»¥ç”± words ä¸­æ‰€æœ‰å•è¯ä¸²è”å½¢æˆçš„å­ä¸²çš„èµ·å§‹ä½ç½®ã€‚</span><br><span class="line"> </span><br><span class="line">è¾“å…¥ï¼š</span><br><span class="line">  s = "barfoothefoobarman",</span><br><span class="line">  words = ["foo","bar"]</span><br><span class="line">è¾“å‡ºï¼š[0,9]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">ä»ç´¢å¼• 0 å’Œ 9 å¼€å§‹çš„å­ä¸²åˆ†åˆ«æ˜¯ "barfoo" å’Œ "foobar" ã€‚</span><br><span class="line">è¾“å‡ºçš„é¡ºåºä¸é‡è¦, [9,0] ä¹Ÿæ˜¯æœ‰æ•ˆç­”æ¡ˆã€‚</span><br></pre></td></tr></table></figure><h3 id="åˆ†æ"><a class="markdownIt-Anchor" href="#åˆ†æ"></a> åˆ†æ</h3><p>å‡è®¾å¾…åŒ¹é…çš„æ¯ä¸ª word çš„å®½åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span>.<br>ç¬¬ä¸€å°è±¡ä½¿ç”¨æ»‘åŠ¨çª—å£. æˆ‘ä»¬åªæ£€æŸ¥å­—ç¬¦ä¸²åœ¨æ»‘åŠ¨çª—å£ä¸­çš„éƒ¨åˆ†, æ˜¯å¦æ˜¯è¾“å…¥ words çš„ä¸€ä¸ªè¿æ¥. å› ä¸º words éƒ½æ˜¯ç­‰å®½åº¦çš„, æ‰€ä»¥å¦‚æœæ»‘åŠ¨çª—å£å†…çš„éƒ¨åˆ†ç¡®å®æ˜¯è¿æ¥, é‚£ä¹ˆæŒ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ä¸ºå®½åº¦è¿›è¡Œåˆ’åˆ†åå½¢æˆçš„ substring é›†åˆ, å¿…ç„¶ç­‰ä»·äºè¾“å…¥çš„ words é›†åˆ. ä½¿ç”¨æ»‘åŠ¨çª—å£, æˆ‘ä»¬å°±å¯ä»¥ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦åœ°è€ƒå¯Ÿ, æ¯å¢åŠ ä¸€ä¸ªå­—ç¬¦, å¯èƒ½äº§ç”Ÿæ–°çš„ match.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// [  ] å¯¹åº” word çš„å®½åº¦</span><br><span class="line"></span><br><span class="line">              |-æ–°æ¢æµ‹çš„å­—ç¬¦</span><br><span class="line">              v</span><br><span class="line"> xxxxx.....xxxAxxx...</span><br><span class="line">  [  ][  ][  ] </span><br><span class="line">  ^          ^</span><br><span class="line">  |--window--|</span><br></pre></td></tr></table></figure><p>ç„¶è€Œ, æ¯æ¬¡æ–°å¢å­—ç¬¦è¦æ£€æŸ¥æ»‘åŠ¨çª—å£éƒ¨åˆ†æ˜¯å¦ match äº†æ‰€æœ‰çš„ word æ˜¯æ— éœ€ä»çª—å£å¤´éƒ¨å¼€å§‹é‡æ–°æ£€æŸ¥, æœ‰å¾ˆå¤šæ•°æ®æ˜¯å¯ä»¥å¤ç”¨çš„. åªæ˜¯è¿™ä¸ªå¤ç”¨å¹¶ä¸æ˜¯ç´§é‚»çš„, ä¹Ÿå°±æ˜¯è€ƒå¯Ÿä¸Šä¸€ä¸ªå­—ç¬¦æ—¶å’Œå’Œè€ƒå¯Ÿæ¥ä¸‹æ¥çš„å­—ç¬¦æ—¶, å¹¶ä¸èƒ½å…±äº«ä¿¡æ¯. è€Œæ˜¯å½“å‰çš„æ»‘åŠ¨çª—å£çŠ¶æ€å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ä¸ªå­—ç¬¦å‰çš„çŠ¶æ€æœ‰å¾ˆå¤§çš„ç›¸ä¼¼æ€§.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// [  ] å¯¹åº” word çš„å®½åº¦</span><br><span class="line"></span><br><span class="line">  |--old window--|</span><br><span class="line">  [  ][  ][  ][  ]        &lt;- ä¹‹å‰å¯èƒ½çš„åŒ¹é…</span><br><span class="line">  xxxxxxxxxxxxxxxxxxxx</span><br><span class="line">      [  ][  ][  ][  ]    &lt;- ç§»åŠ¨ w ä¸ªå­—ç¬¦åçš„åŒ¹é…</span><br><span class="line">      |--new window--|</span><br></pre></td></tr></table></figure><p>å› æ­¤, å¯ä»¥æ‹†åˆ†å‡º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ä¸ªä¸åŒçš„ â€œèµ›é“â€, ä¸åŒçš„èµ›é“ä¹‹é—´ offset ä¸º 1, æ¯ä¸ªèµ›é“ä»…åœ¨æ–°å¢ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ä¸ªå­—ç¬¦åæ‰è€ƒå¯ŸçŠ¶æ€å˜åŒ–: æ˜¯å¦äº§ç”Ÿäº†æ–°çš„åŒ¹é….</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// [  ] å¯¹åº” word çš„å®½åº¦</span><br><span class="line"></span><br><span class="line">   xxxxxxxxxxxxxxxxxxxx</span><br><span class="line">   [  ][  ][  ][  ]       &lt;- èµ›é“ 0</span><br><span class="line">    [  ][  ][  ][  ]      &lt;- èµ›é“ 1</span><br><span class="line">     [  ][  ][  ][  ]     &lt;- èµ›é“ 2</span><br><span class="line">      [  ][  ][  ][  ]    &lt;- èµ›é“ 3</span><br><span class="line">       [  ][  ][  ][  ]   &lt;- èµ›é“ 0 (æ–°å¢ w å­—ç¬¦å)</span><br></pre></td></tr></table></figure><p>å¦‚å‰æ‰€è¿°, æ¯ä¸ªèµ›é“ä¸­ä¸Šä¸€æ¬¡åŒ¹é…çš„çŠ¶æ€å’Œä¸‹ä¸€æ¬¡åŒ¹é…çš„çŠ¶æ€æœ‰å¾ˆå¤§çš„å¯å¤ç”¨æ€§. ç†è®ºä¸Š, åªéœ€è¦è®°å½•è¿™ä¸ªèµ›é“ä¸­æ‰€æœ‰ substring å‡ºç°çš„æ¬¡æ•°, æ¯æ¬¡æ–°å¢/åˆ é™¤ substring å, æ£€æŸ¥å„ä¸ª substring çš„ count æ˜¯å¦å’Œç›®æ ‡ä¸€è‡´å³å¯. ç„¶è€Œåœ¨å…·ä½“çš„å®ç°æ—¶, code å±‚é¢æœ‰åŠæ³•åšå¾ˆå¤§çš„ä¼˜åŒ–, é¿å…çœŸçš„éå†æ‰€æœ‰çš„ substring çš„ count.</p><h3 id="å®ç°"><a class="markdownIt-Anchor" href="#å®ç°"></a> å®ç°</h3><p>é¦–å…ˆå®ç°ä¸€ä¸ª word åŒ¹é…å™¨, è¯¥åŒ¹é…å™¨åšäº†ä¼˜åŒ–, ä½¿å¾—æ£€æŸ¥è¾“å…¥çš„ words æ˜¯å¦æ­£å¥½å’Œç›®æ ‡åŒ¹é…, èƒ½åœ¨çŸ­æ—¶é—´å†…å®Œæˆ. ä¸ºæ­¤, åœ¨æ¯æ¬¡æ–°å¢/åˆ é™¤ word æ—¶, å¤šåšäº†ä¸€äº›çŠ¶æ€ç»´æŠ¤.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// å­˜å‚¨å¾…åŒ¹é…çš„ word åŠæ¯ä¸ª word ç›®å‰çš„åŒ¹é…æƒ…å†µ</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleMultiSet</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/// word: count</span></span><br><span class="line">  <span class="comment">/// &lt; 0 çš„ count è¡¨ç¤ºä»éœ€ä¸€å®šæ•°é‡çš„åŒ¹é…</span></span><br><span class="line">  <span class="comment">/// &gt; 0 çš„ count è¡¨ç¤ºè¶…å‡ºäº†åŒ¹é…</span></span><br><span class="line">  <span class="comment">/// ä¸å­˜åœ¨çš„ word è¡¨ç¤ºæ­£å¥½åŒ¹é…</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> dict: [<span class="type">Substring</span>: <span class="type">Int</span>] = [:]</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// ç”¨å¾…åŒ¹é…çš„ words åˆå§‹åŒ–</span></span><br><span class="line">  <span class="keyword">init</span>(words: [<span class="type">String</span>]) &#123;</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> words &#123;</span><br><span class="line">      dict[word[...], <span class="keyword">default</span>: <span class="number">0</span>] -= <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// æ–°å¢åŠ ä¸€ä¸ª candidate</span></span><br><span class="line">  <span class="comment">/// ç†è®ºä¸Š, å¯¹åº” word çš„ count + 1</span></span><br><span class="line">  <span class="comment">/// ä½†å½“è°ƒæ•´ä¼šå¯¼è‡´ count == 0 æ—¶, åŒæ—¶å°† word ä» dict é‡Œç§»é™¤</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(<span class="number">_</span> word: Substring)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="built_in">count</span> = dict[word] &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">count</span> == -<span class="number">1</span> &#123;</span><br><span class="line">        dict[word] = <span class="literal">nil</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dict[word] = <span class="built_in">count</span> + <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      dict[word] = <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// å»æ‰ä¸€ä¸ª candidate</span></span><br><span class="line">  <span class="comment">/// ç†è®ºä¸Š, å¯¹åº” word çš„ count - 1</span></span><br><span class="line">  <span class="comment">/// ä½†å½“è°ƒæ•´ä¼šå¯¼è‡´ count == 0 æ—¶, åŒæ—¶å°† word ä» dict é‡Œç§»é™¤</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">(<span class="number">_</span> word: Substring)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="built_in">count</span> = dict[word] &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">count</span> == <span class="number">1</span> &#123;</span><br><span class="line">        dict[word] = <span class="literal">nil</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dict[word] = <span class="built_in">count</span> - <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      dict[word] = -<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// æ£€æŸ¥æ˜¯å¦æ‰€æœ‰åˆå§‹çš„ word éƒ½æ­£å¥½åŒ¹é…å®Œ</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">verify</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> dict.isEmpty</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤åŸºç¡€ä¸Šæ ¹æ®ä¸Šé¢çš„å¤šèµ›é“æ»‘åŠ¨çª—å£åˆ†æ, å®ç°ä¸»ç®—æ³•.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Main entry point</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findSubstring</span><span class="params">(<span class="number">_</span> s: String, <span class="number">_</span> words: [String])</span></span> -&gt; [<span class="type">Int</span>] &#123;</span><br><span class="line">  <span class="comment">/// early exit</span></span><br><span class="line">  <span class="keyword">if</span> words.isEmpty || words[<span class="number">0</span>].isEmpty &#123;</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> wordSize = words[<span class="number">0</span>].<span class="built_in">count</span></span><br><span class="line">  <span class="keyword">let</span> <span class="built_in">count</span> = words.<span class="built_in">count</span> * wordSize</span><br><span class="line">  <span class="keyword">if</span> s.<span class="built_in">count</span> &lt; <span class="built_in">count</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// æ ¹æ® word å®½åº¦å†³å®šå½“å‰çš„èµ›é“ä¸ªæ•°</span></span><br><span class="line">  <span class="keyword">let</span> sets = (<span class="number">0</span>..&lt;wordSize).<span class="built_in">map</span> &#123; <span class="number">_</span> <span class="keyword">in</span> <span class="type">SimpleMultiSet</span>(words: words) &#125;</span><br><span class="line">  <span class="comment">/// å½“å‰èµ›é“</span></span><br><span class="line">  <span class="keyword">var</span> setIndex = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/// å„ä¸ªå­—ç¬¦çš„ index</span></span><br><span class="line">  <span class="comment">// å½“å‰ word start</span></span><br><span class="line">  <span class="keyword">var</span> i = s.startIndex</span><br><span class="line">  <span class="comment">// å½“å‰ word end</span></span><br><span class="line">  <span class="keyword">var</span> j = s.index(i, offsetBy: wordSize)</span><br><span class="line">  <span class="comment">// æœ€æ—§çš„ word start</span></span><br><span class="line">  <span class="keyword">var</span> k = i</span><br><span class="line">  <span class="comment">// æœ€æ—§çš„ word end</span></span><br><span class="line">  <span class="keyword">var</span> l = j</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> stepper = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> setLoopCount = wordSize</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> results: [<span class="type">Int</span>] = []</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// å¢åŠ åˆå§‹çš„ word</span></span><br><span class="line">  sets[setIndex].push(s[i..&lt;j])</span><br><span class="line">  <span class="keyword">if</span> sets[setIndex].verify() &#123;</span><br><span class="line">    results.append(<span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> j != s.endIndex &#123;</span><br><span class="line">    <span class="comment">/// æ¯æ–°å¢ä¸€ä¸ªå­—ç¬¦, å†³å®šå½“å‰èµ›é“</span></span><br><span class="line">    stepper += <span class="number">1</span></span><br><span class="line">    setIndex = (setIndex + <span class="number">1</span>) % setLoopCount</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å»æ‰è¶…å‡ºçª—å£çš„ word</span></span><br><span class="line">    <span class="keyword">if</span> stepper &gt;= <span class="built_in">count</span> &#123;</span><br><span class="line">      sets[setIndex].remove(s[k..&lt;l])</span><br><span class="line">      s.formIndex(after: &amp;k)</span><br><span class="line">      s.formIndex(after: &amp;l)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/// å¢åŠ æ–°çš„ word</span></span><br><span class="line">    s.formIndex(after: &amp;i)</span><br><span class="line">    s.formIndex(after: &amp;j)</span><br><span class="line">    sets[setIndex].push(s[i..&lt;j])</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// æ£€æŸ¥å½“å‰èµ›é“æ˜¯å¦æ­£å¥½åŒ¹é…</span></span><br><span class="line">    <span class="keyword">if</span> sets[setIndex].verify() &#123;</span><br><span class="line">      results.append(stepper - <span class="built_in">count</span> + wordSize)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> results</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ä½“ä¸Šä½¿ç”¨äº† Swift <code>String</code> çš„ index å’Œ <code>Substring</code> æ“ä½œé¿å…äº§ç”Ÿä¸éœ€è¦çš„ copy.</p><h3 id="æ€§èƒ½åˆ†æ"><a class="markdownIt-Anchor" href="#æ€§èƒ½åˆ†æ"></a> æ€§èƒ½åˆ†æ</h3><p>å‡è®¾æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ª word å¾…åŒ¹é…, æ¯ä¸ª word å®½åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span>, è¾“å…¥å­—ç¬¦ä¸²çš„é•¿åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span></span></span></span>.</p><ul><li>æ—¶é—´ä¸Š<ul><li>åˆå§‹åŒ–é˜¶æ®µ: å¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ä¸ªèµ›é“æ¯ä¸ªéƒ½åˆ›å»º <code>SimpleMultiSet</code>. æ¯æ¬¡åˆ›å»ºæ—¶ <code>SimpleMultiSet</code> éœ€è¦å°† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ª word åŠ å…¥ dict, è€ƒè™‘åˆ° word åŠ å…¥ dict æ—¶çš„ hash æ“ä½œ, ç†è®ºä¸Šä¼šéå† word ä¸­çš„æ¯ä¸ªå­—ç¬¦, å› æ­¤æ¯æ¬¡åˆå§‹åŒ–è€—æ—¶ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>k</mi><mo>â‹…</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(k \cdot w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span>. å› æ­¤åˆå§‹åŒ–é˜¶æ®µæ€»è€—æ—¶ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>k</mi><mo>â‹…</mo><msup><mi>w</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(k \cdot w^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>.</li><li>è¿è¡Œé˜¶æ®µ: æ˜¯ä¸€ä¸ª main loop, é’ˆå¯¹è¾“å…¥å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦å¾ªç¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mo>âˆ’</mo><mi>w</mi></mrow><annotation encoding="application/x-tex">l - w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> æ¬¡. æ¯æ¬¡å¾ªç¯å¼•å…¥ä¸€ä¸ªæ–°çš„å­—ç¬¦, æœ€å¤šåªéœ€è¦ä»å¯¹åº”èµ›é“çš„ <code>SimpleMultiSet</code> ä¸­å¢åŠ ä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> é•¿åº¦çš„ substring, å¹¶å»æ‰ä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> é•¿åº¦çš„ substring. è€ƒè™‘åˆ° word åŠ å…¥å’Œç¦»å¼€ dict æ—¶çš„ hash æ“ä½œ, æœ€å¤šåªéœ€è¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span>. å…¶ä»–æ“ä½œéƒ½å¯ä»¥åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span> å†…å®Œæˆ, æ‰€ä»¥æ€»è€—æ—¶ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>w</mi><mo>â‹…</mo><mo stretchy="false">(</mo><mi>l</mi><mo>âˆ’</mo><mi>w</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(w \cdot (l - w))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>. ä¸€èˆ¬è€Œè¨€ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo>â‰ª</mo><mi>l</mi></mrow><annotation encoding="application/x-tex">w \ll l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰ª</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span></span></span></span>, å› æ­¤å¯è¿‘ä¼¼ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>w</mi><mo>â‹…</mo><mi>l</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(w \cdot l)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span>.</li><li>æ€»è€—æ—¶ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mo>â‹…</mo><mi>w</mi><mo>+</mo><mi>k</mi><mo>â‹…</mo><msup><mi>w</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(l \cdot w + k \cdot w^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>. ä¸€èˆ¬æƒ…å†µä¸‹, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>â‰ª</mo><mi>l</mi></mrow><annotation encoding="application/x-tex">k \ll l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰ª</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span></span></span></span>, æˆ–å¯æŠŠ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> è§†ä¸ºå¸¸æ•°, æ­¤æ—¶æ€»è€—æ—¶ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mo>â‹…</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(l \cdot w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span>. å¦‚æœè¿›ä¸€æ­¥æŠŠ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ä¹Ÿè§†ä¸ºå¸¸æ•°, åˆ™æœ€ç»ˆæ—¶é—´å¤æ‚åº¦ä»…ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(l)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span>.</li></ul></li><li>ç©ºé—´ä¸Š<ul><li>ä¸»è¦å­˜å‚¨æ¶ˆè€—ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ä¸ªèµ›é“å¯¹åº”çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ä¸ª <code>SimpleMultiSet</code> .</li><li>æ¯ä¸ª <code>SimpleMultiSet</code> æœ€å¤šæ—¶éœ€è¦å­˜å‚¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ªå®½åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> çš„substring. ç®€åŒ–æ¥çœ‹, å¦‚æœæŠŠå­˜å‚¨ substring ç”¨çš„ dict çš„è£…è½½å› å­è§†ä¸ºå¸¸æ•°, åˆ™å•ä¸ª dict å ç”¨ç©ºé—´ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>w</mi><mo>â‹…</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(w \cdot k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">)</span></span></span></span>.</li><li>æ€»å ç”¨ç©ºé—´ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>k</mi><mo>â‹…</mo><msup><mi>w</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(k \cdot w^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, å¦‚æœæŠŠ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> å‡è§†ä¸ºå¸¸æ•°, é‚£ä¹ˆæ•´ä½“ç©ºé—´å¤æ‚åº¦ä»…ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>.</li></ul></li></ul><p><img src="/2020/tra-1/leetcode_record.png" alt="leetcode record"><br>(leetcode ä¸Šçš„è€—æ—¶åˆ†æå’Œ server ä¸Šçš„ Swift ç‰ˆæœ¬æœ‰å¾ˆå¤§å…³ç³», å®é™…å‚è€ƒä»·å€¼æœ‰é™)</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;ul class=&quot;markdownIt-TOC&quot;&gt;
&lt;li&gt;&lt;a href=&quot;#tip-%E5%90%8C%E6%AD%A5-uiview-animation-%E5%92%8C-calayer-animation&quot;&gt;Tip: åŒæ­¥ UIView animation å’Œ CALayer animation&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E9%97%AE%E9%A2%98%E6%9D%A5%E6%BA%90&quot;&gt;é—®é¢˜æ¥æº&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95&quot;&gt;è§£å†³åŠæ³•&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#receive-swift-concurrency&quot;&gt;Receive: Swift Concurrency&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#algorithm-substring-with-concatenation-of-all-words&quot;&gt;Algorithm: Substring with Concatenation of All Words&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E9%A2%98%E7%9B%AE&quot;&gt;é¢˜ç›®&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%88%86%E6%9E%90&quot;&gt;åˆ†æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%AE%9E%E7%8E%B0&quot;&gt;å®ç°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90&quot;&gt;æ€§èƒ½åˆ†æ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;TRA æ˜¯ç®€åŒ–ç‰ˆçš„ &lt;a href=&quot;https://mp.weixin.qq.com/s/WMlApIA-v8zpB9l-VlMlyw&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ARTS&lt;/a&gt;, å‘¨æœŸæ˜¯ä¸¤å‘¨ä¸€æ¬¡ã€‚å…¶ä¸­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;T æ˜¯ Tip, æ€»ç»“å’Œå½’çº³æ—¥å¸¸ä¸­é‡åˆ°çš„çŸ¥è¯†ç‚¹.&lt;/li&gt;
&lt;li&gt;R æ˜¯ Receive, æ–°çŸ¥è¯†çš„è¾“å…¥(æŠ€æœ¯ã€ç†è´¢ã€å“²å­¦ã€æ–‡åŒ–ç­‰)éƒ½ç®—åœ¨å†….&lt;/li&gt;
&lt;li&gt;A æ˜¯ Algorithm, ç®—æ³•å°ç»ƒä¹ .&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;</summary>
    
    
    
    <category term="TRA" scheme="https://crystdragon.github.io/categories/tra/"/>
    
    
    <category term="Apple Platforms" scheme="https://crystdragon.github.io/tags/apple-platforms/"/>
    
    <category term="Swift Concurrency" scheme="https://crystdragon.github.io/tags/swift-concurrency/"/>
    
  </entry>
  
  <entry>
    <title>SwiftUI Notes</title>
    <link href="https://crystdragon.github.io/2020/swiftui-notes/"/>
    <id>https://crystdragon.github.io/2020/swiftui-notes/</id>
    <published>2020-08-02T16:00:00.000Z</published>
    <updated>2020-08-03T17:56:43.928Z</updated>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#data-flow">Data Flow</a><ul><li><a href="#state">State</a><ul><li><a href="#state%E6%89%80%E6%8C%87%E7%A4%BA%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%94%9F%E5%91%BD%E6%9C%9F"><code>State</code>æ‰€æŒ‡ç¤ºå¯¹è±¡çš„ç”Ÿå‘½æœŸ</a></li><li><a href="#state-wrapper-%E7%9A%84%E8%AF%AD%E6%B3%95%E7%89%B9%E5%BE%81"><code>State</code> wrapper çš„è¯­æ³•ç‰¹å¾</a></li></ul></li><li><a href="#observableobject">ObservableObject</a></li><li><a href="#observedobject">ObservedObject</a></li><li><a href="#stateobject-ios-14">StateObject (iOS 14+)</a><ul><li><a href="#%E8%AF%AD%E6%B3%95%E7%89%B9%E7%82%B9">è¯­æ³•ç‰¹ç‚¹</a></li></ul></li><li><a href="#binding">Binding</a></li></ul></li><li><a href="#framework-integration">Framework integration</a></li><li><a href="#ui-tips">UI Tips</a><ul><li><a href="#%E5%BE%85%E7%A1%AE%E8%AE%A4%E7%9A%84%E7%82%B9">å¾…ç¡®è®¤çš„ç‚¹</a></li></ul></li></ul></p><hr><h2 id="data-flow"><a class="markdownIt-Anchor" href="#data-flow"></a> Data Flow</h2><h3 id="state"><a class="markdownIt-Anchor" href="#state"></a> State</h3><p>Property wrapper <code>State</code>åªæ˜¯ä¸€ä¸ªæ˜ å°„, å¹¶ä¸çœŸæ­£å¼€æ”¾ç©ºé—´å­˜å‚¨å˜é‡, çœŸæ­£çš„ç©ºé—´å¼€è¾Ÿæ˜¯è¿™æ ·çš„è¿‡ç¨‹:</p><ul><li><code>State</code>å¿…é¡»å®šä¹‰åœ¨æŸä¸ª<code>ViewA: View</code>ä¸­ä½œä¸ºæˆå‘˜å±æ€§, ä¸èƒ½å®šä¹‰åœ¨åˆ«çš„åœ°æ–¹, ä¹Ÿä¸èƒ½å®šä¹‰æˆoptional, ä¹Ÿä¸èƒ½å®šä¹‰æˆstaticå˜é‡.</li><li>SwiftUI åœ¨<code>ViewA</code>å¯¹è±¡ç”Ÿæˆæ—¶, é€šè¿‡æŸç§å’Œ<code>DynamicProperty</code>ç›¸å…³çš„æœºåˆ¶(<a href="https://medium.com/@kateinoigakukun/inside-swiftui-how-state-implemented-92a51c0cb5f6" target="_blank" rel="noopener">å¯èƒ½æ˜¯æŸç§ reflection æœºåˆ¶</a>, ä¹Ÿå¯èƒ½æ˜¯ compiler synthesize), æ ¹æ®<code>State</code>ä¸­æŒ‡ç¤ºçš„ initial value, åœ¨çœŸæ­£çš„ <em>view</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> å¯¹è±¡ä¸­å»ºç«‹äº†ä¸€ä»½æ•°æ®, å¹¶æŠŠ<code>ViewA</code>å’Œå…¶æ‰€æœ‰<code>State</code>çš„æˆå‘˜å˜é‡ä½œå‡ºäº† Model -&gt; View çš„å…³è”.</li><li>ä¹‹å<code>ViewA.body</code>æ¯æ¬¡è¢«é‡æ–°è°ƒç”¨ (ä¾‹å¦‚ data change å¯¼è‡´çš„ update æˆ–è€… view é‡æ–°å‡ºç°åœ¨å±å¹•ä¸Šç­‰) å‰, éƒ½ä¼šä¿è¯ <code>ViewA</code> ä¸­å¯ä»¥è®¿é—®åˆ°çš„å€¼è¢«æ›´æ–°åˆ°ä¸å†…å­˜ä¸­çš„è¿è¡Œæ—¶çŠ¶æ€ä¸€è‡´, è¿™æ ·ä¹‹åè®¿é—®/æ“çºµè¯¥å€¼æ—¶, æœ¬è´¨ä¸Šéƒ½æ˜¯è®¿é—®äº†å¯¹åº”çš„çœŸæ­£çš„ä¸ view å…³è”çš„æ•°æ®å¯¹è±¡.</li><li>åœ¨ SwiftUI å¯ä»¥ç›‘æ§åˆ°çš„ç¯å¢ƒä¸‹è°ƒç”¨åˆ°æŸä¸ª<code>State</code>çš„ getter çš„å‰æä¸‹, æˆ‘ä»¬åªè¦åœ¨ä»»ä½•åœ°æ–¹è§¦å‘è¿™ä¸ª<code>State</code>çš„ setter, å°±æœ‰å¯èƒ½è§¦å‘è·å–äº† getter çš„<code>body</code>çš„é‡æ–°è°ƒç”¨.<ul><li>å½“<code>State</code> wrap çš„ç±»å‹æ˜¯é<code>Equatable</code>æ—¶, åªè¦è§¦å‘ setter, å³è§¦å‘<code>body</code>è¢«è°ƒç”¨.</li><li>å½“<code>State</code> wrap çš„ç±»å‹éµå¾ª<code>Equatable</code>æ—¶, åªæœ‰è§¦å‘ setter æ—¶çš„<code>newValue</code>å’Œæ—§å€¼ä¸åŒæ—¶, æ‰ä¼šè§¦å‘<code>body</code>.</li></ul></li></ul><p>æ³¨æ„åœ¨é SwiftUI ä½“ç³»ä¸‹, <code>State</code>æ¯«æ— ä½œç”¨, ç”šè‡³åŸºæœ¬çš„ get/set é€»è¾‘éƒ½ä¸æ»¡è¶³.</p><h4 id="stateæ‰€æŒ‡ç¤ºå¯¹è±¡çš„ç”Ÿå‘½æœŸ"><a class="markdownIt-Anchor" href="#stateæ‰€æŒ‡ç¤ºå¯¹è±¡çš„ç”Ÿå‘½æœŸ"></a> <code>State</code>æ‰€æŒ‡ç¤ºå¯¹è±¡çš„ç”Ÿå‘½æœŸ</h4><p>æ— è®ºæ˜¯<code>State</code>, è¿˜æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„<code>struct ViewA</code>, æœ¬è´¨ä¸Šéƒ½åªæ˜¯ recipe, ä¸æ˜¯çœŸæ­£çš„è¿è¡Œæ—¶å¯¹è±¡. çœŸæ­£çš„è¿è¡Œæ—¶å¯¹è±¡, è¦ä¹ˆè¢« SwiftUI å¾ˆå¥½åœ°éšè—åœ¨çœŸæ­£çš„ runtime view å¯¹è±¡ä¸­, è¦ä¹ˆåœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„åˆ«çš„ reference type ä¸­(ç±»ä¼¼ä¸‹æ–‡çš„ObservableObject).</p><a id="more"></a> <ul><li><code>State</code>æŒ‡ç¤ºçš„çœŸæ­£çš„å¯¹è±¡çš„ç”Ÿå‘½æœŸå’Œå¯¹åº”çš„ view ä¸€è‡´, æ— è®ºè¯¥ view é‡ç»˜å‡ æ¬¡, åªè¦æ²¡æœ‰ä»å†…å­˜ä¸­æ¸…é™¤, éƒ½åªåˆå§‹åŒ–ä¸€æ¬¡.</li><li>å¦‚æœ parent view åˆ·æ–°å¯¼è‡´é‡æ–°åˆå§‹åŒ–äº†ä¸€ä¸ª child view å¯¹åº”çš„ struct, åªè¦è¯¥ child view åœ¨æ•´ä¸ª view hierarchy ä¸­çš„ä½ç½®æ²¡æœ‰å˜åŒ–, SwiftUI ä¼šå¾ˆèªæ˜åœ°å¤ç”¨ä¹‹å‰çš„ runtime ä¿¡æ¯, ä¸ä¼šé‡æ–°åˆå§‹åŒ–<code>State</code>å¯¹åº”çš„æ•°æ®å¯¹è±¡.</li><li>å¦‚æœè¿™ä¸ª view é”€æ¯å†é‡æ–°åˆ›å»º, é‚£ä¹ˆ SwiftUI ä¼šç”¨åˆå§‹åŒ–å€¼é‡æ–°ç»™æ–°çš„ view å¼€è¾Ÿä¸€ä»½.</li></ul><h4 id="state-wrapper-çš„è¯­æ³•ç‰¹å¾"><a class="markdownIt-Anchor" href="#state-wrapper-çš„è¯­æ³•ç‰¹å¾"></a> <code>State</code> wrapper çš„è¯­æ³•ç‰¹å¾</h4><ul><li>å› ä¸º<code>State</code>çš„ setter æ˜¯<code>nonmutating</code>çš„, å› æ­¤:<ul><li>å³ä½¿æˆ‘ä»¬åœ¨<code>body</code>ä¸­ call äº† setter, ä¹Ÿæ— éœ€æŠŠè¿™ä¸ª struct çš„<code>body</code>æˆå‘˜æ ‡è®°æˆ<code>mutating</code>, æˆ–è€…æ— éœ€æ˜¾ç¤º capture ä¸€ä¸ª<code>var self</code>.</li><li>å¦‚æœä¸ç”¨ property wrapper çš„å†™æ³•, å¯ä»¥ç›´æ¥å£°æ˜æˆ<code>let xxx: State // (æ— éœ€ var)</code>, éœ€è¦å¼•ç”¨æ—¶, ä½¿ç”¨ä½¿ç”¨<code>wrappedValue</code>çš„ setter/getter.</li></ul></li><li>å› ä¸º<code>State</code>å…¶å®åªæ˜¯ä¸€ä¸ª wrapper, ä¸å­˜å‚¨å®é™…çš„ runtime value, æ‰€ä»¥æˆ‘ä»¬åœ¨ callback ä¸­ä¿®æ”¹ struct ä¸­çš„<code>State</code>å¯¹è±¡æ—¶, è™½ç„¶ä»è¯­æ³•è§’åº¦ block å¿…ç„¶ä¼š capture ä¸€ä»½<code>self</code>, å¯¼è‡´ä¿®æ”¹çš„åªæ˜¯<code>State</code>å‰¯æœ¬, ä½†åœ¨ SwiftUI ç³»ç»Ÿä¸­æ˜¯ work çš„.</li></ul><h3 id="observableobject"><a class="markdownIt-Anchor" href="#observableobject"></a> ObservableObject</h3><ul><li>ä¸€ä¸ª protocol, ä¾›æˆ‘ä»¬å®ç°. é»˜è®¤æƒ…å†µä¸‹, å¦‚æœå˜é‡æœ‰<code>@Published</code>, é‚£ä¹ˆ compiler ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®ç°éœ€æ±‚çš„æ–¹æ³•.</li><li>å¦‚æœæ‰‹åŠ¨å®ç°æ–¹æ³•:<ul><li>åˆ™å¿…é¡»å®ç°ä¸€ä¸ª<code>Publisher</code>ç±»å‹çš„æˆå‘˜<code>objectWillChange</code>, å…¶<code>Failure == Never</code>. ä¸€èˆ¬å¯ä»¥ç›´æ¥ç”¨<code>ObservableObjectPublisher</code>è¿™ä¸ª concrete type.</li><li>SwiftUI ä¼šåœ¨åˆé€‚çš„æ—¶å€™ç»™è¿™ä¸ª publisher å¢åŠ  subscriber.</li><li>è¦æ±‚æˆ‘ä»¬çš„ code åœ¨åˆé€‚çš„æ—¶æœº(å¿…é¡»ç¬¦åˆ â€œwillâ€ çš„è¯­ä¹‰)é€šè¿‡<code>objectWillChange</code>å‘å‡ºä¿¡æ¯.</li></ul></li><li>SwiftUIä¸­çš„<code>@ObservedObject</code>å¯ä»¥å°†<code>ObservableObject</code>ç”¨ property wrapper åŒ…è£…. .</li><li>SwiftUIä¸­çš„<code>@EnvironmentObject</code>åŒæ ·å¯ä»¥åŒ…è£…<code>ObservableObject</code>.</li></ul><h3 id="observedobject"><a class="markdownIt-Anchor" href="#observedobject"></a> ObservedObject</h3><p>ä¸€ä¸ª property wrapper, åŒ…è£…éµå¾ª<code>ObservableObject</code>çš„å¯¹è±¡. ç±»ä¼¼<code>State</code>ä½¿ç”¨, ä½†å’Œ<code>State</code>æœ‰åŒºåˆ«.</p><ul><li>è®¾å®šæˆ<code>View</code>çš„æˆå‘˜å˜é‡å, å’Œ<code>State</code>ç±»ä¼¼, SwiftUI ä¼šå»ºç«‹ model å’Œ view ä¹‹é—´çš„è”ç³». ä½†æ˜¯, åªè¦è¿™ä¸ª<code>ObservableObject</code>çš„<code>objectWillChange</code>å‘å‡ºä¿¡æ¯, åˆ™<code>body</code>å°±ä¼šè¢«é‡æ–°è°ƒç”¨, <em>ä¸éœ€è¦åœ¨ SwiftUI å¯ä»¥ç›‘æ§åˆ°çš„ç¯å¢ƒä¸‹é¦–å…ˆè¢«è°ƒç”¨è¿‡ getter</em>.</li><li>è¿™ä¸ª<code>ObservedObject</code>æˆå‘˜å¯¹è±¡çš„å†…å­˜ç”Ÿå‘½æœŸä¸å’Œ runtime view ä¸€ä¸€ç»‘å®š, è€Œæ˜¯ç”±æˆ‘ä»¬çš„ code æ§åˆ¶<ul><li>å¦‚æœè¿™ä¸ª property ä½¿ç”¨ dependency injection ç”±å¤–éƒ¨ä¼ å…¥, é‚£ä¹ˆåªè¦å¤–éƒ¨çš„å¼•ç”¨ä¸æ¶ˆäº¡, åˆ™å§‹ç»ˆæ˜¯åŒä¸€ä»½å¯¹è±¡.</li><li>å¦‚æœè¿™ä¸ª property æ˜¯åœ¨å½“å‰ struct ä¸­åˆå§‹åŒ–, é‚£ä¹ˆè¯¥å¯¹è±¡çš„ç”Ÿå‘½æœŸå’Œå½“å‰ struct è¢«åˆå§‹åŒ–å’Œ pass-by-value çš„èŒƒå›´æœ‰å…³.<ul><li>å¦‚æœåªæ˜¯å½“å‰ view è¢«é‡ç»˜, è§¦å‘<code>body</code>é‡æ–°è°ƒç”¨, é‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ä»ç„¶å­˜æ´».</li><li>å¦‚æœæ˜¯ parent view è¢«é‡ç»˜, è§¦å‘åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ child view struct, é‚£ä¹ˆæ—§çš„<code>View</code>å¯¹è±¡æ‰€æœ‰å¼•ç”¨è®¡æ•°ç»ˆä¼šæ¸…ç©º, è€Œæ–°çš„ view ç”¨åˆ°çš„<code>ObservedObject</code>å’Œæ—§çš„å®Œå…¨æ— å…³.</li></ul></li></ul></li></ul><h3 id="stateobject-ios-14"><a class="markdownIt-Anchor" href="#stateobject-ios-14"></a> StateObject (iOS 14+)</h3><p>ä¸€ä¸ª property wrapper, ç»¼åˆäº†<code>State</code>å’Œ<code>ObservedObject</code>çš„ç‰¹ç‚¹:</p><ul><li>åŒ…å«çš„å¯¹è±¡æ˜¯è‡ªå®šä¹‰çš„éµå¾ªäº†<code>ObservableObject</code>çš„ç±»å‹.</li><li>å¯¹è±¡çš„ç”Ÿå‘½æœŸå’Œ runtime view ä¿æŒä¸€è‡´.</li></ul><p>å¾…ç¡®è®¤çš„ç‚¹:</p><ul><li>æ˜¯å¦éœ€è¦ getter åœ¨<code>body</code>ä¸­è¢«è°ƒç”¨çš„å‰æ, æ‰èƒ½åœ¨<code>objectWillChange</code>äº§ç”Ÿä¿¡æ¯æ—¶è§¦å‘<code>body</code>. å³æ˜¯ç±»ä¼¼<code>ObservedObject</code>, è¿˜æ˜¯ç±»ä¼¼<code>State</code>?</li></ul><h4 id="è¯­æ³•ç‰¹ç‚¹"><a class="markdownIt-Anchor" href="#è¯­æ³•ç‰¹ç‚¹"></a> è¯­æ³•ç‰¹ç‚¹</h4><ul><li><code>StateObject</code> wrapper çš„åˆå§‹åŒ–æ–¹æ³•æ˜¯ä¸€ä¸ª<code>@autoclosure</code>, è¿™æ„å‘³ç€å’Œ<code>State</code>ã€<code>ObservedObject</code>å‡ä¸åŒ: åªæœ‰å½“å¯¹åº” view è¦è¢«æ¸²æŸ“æ—¶ åˆå§‹å€¼è¡¨è¾¾å¼æ‰ä¼šè¢«æ±‚å€¼, è€Œé view struct è¢«åˆå§‹åŒ–æ—¶.</li></ul><h3 id="binding"><a class="markdownIt-Anchor" href="#binding"></a> Binding</h3><ul><li>ä¸€ä¸ª property wrapper, åŒ…è£…ä¸€ä¸ª setter/getter å¯¹.</li><li>å¯ä»¥ä»<code>State</code>, <code>ObservedObject</code>ç­‰å¯¹è±¡é€šè¿‡<code>$</code>å‰ç¼€ + keypath å¯¼å‡º.</li><li>ä¸€èˆ¬<code>State</code>åŒ…è£¹çš„æ³›å‹ç±»å‹æ˜¯ä¸€ä¸ª struct, æ‰€ä»¥åªè¦å±€éƒ¨æœ‰å˜åŒ–, æ•´ä½“å³äº§ç”Ÿå˜åŒ–. å› æ­¤, å³ä½¿ç”¨<code>$</code>è¿ç®—ç”Ÿæˆéƒ¨åˆ† key path çš„<code>Binding</code>, åªè¦éƒ¨åˆ†å€¼å˜åŒ–, å°±ä¼šè§¦å‘<em>æ‰€æœ‰</em>å¼•ç”¨åˆ°<code>State</code> getter æˆ–å…³è”çš„<code>Binding</code> çš„ view è¿›è¡Œé‡æ–°è·å–<code>body</code>.</li></ul><h2 id="framework-integration"><a class="markdownIt-Anchor" href="#framework-integration"></a> Framework integration</h2><ul><li>æŠŠ SwiftUI æ”¾å…¥ UIKit: <code>UIHostingController</code>, ä¸€ä¸ª<code>UIViewController</code>çš„ concrete å­ç±».</li><li>æŠŠ UIKit æ”¾å…¥ SwiftUI: <code>UIViewControllerRepresentable</code>å’Œ<code>UIViewRepresentable</code>.<ul><li>ä¸¤è€…éƒ½éµå¾ª<code>View</code>, å¹¶å¯¹æ‰€æœ‰<code>View</code>è¦æ±‚çš„æ–¹æ³•è¿›è¡Œäº†é»˜è®¤å®ç°</li><li>åŸºæœ¬è¦æ±‚éµå¾ªè€…<ul><li>æä¾›åˆå§‹çš„<code>UIViewController</code>/<code>UIView</code>.</li><li>åŸºäºå½“å‰ model è¿›è¡Œ view update.</li></ul></li><li>è¯¥ view åˆæ¬¡å±•ç°æ—¶, ç³»ç»Ÿä¼šæ ¹æ®<code>Coordinator</code> associated type å®ç°åˆ›å»ºå¹¶ç»´æŒä¸€ä¸ª coordinator, åœ¨åˆå§‹åŒ–å’Œ update æ—¶ä½œä¸ºå‚æ•°æä¾›ç»™æ ¸å¿ƒ protocol çš„å®ç°è€…. ä½¿å®ç°è€…å¯ä»¥å®Œæˆä¸€äº› binding.</li><li>æœ€å¸¸è§çš„ model é©±åŠ¨é¡ºåºä¸º:<ul><li>åˆ›å»º protocol éµå¾ªè€…çš„å®ä¾‹æ—¶, å°† model dependency (ä¾‹å¦‚<code>Binding</code>) ä¼ å…¥.</li><li>ç¬¬ä¸€æ¬¡æ¸²æŸ“å‰, ç³»ç»Ÿåˆ›å»º coordinator, å¯ä»¥æŠŠ protocol éµå¾ªè€…æœ¬ä½“ inject åˆ°è¿™ä¸ª coordinator ä¸­. åŒæ—¶ä½¿ coordinator å®ç° UIKit ä¸­çš„ä¸€äº› event pattern.</li><li>åœ¨åˆ›å»ºå®é™…çš„ vc/view æ—¶, ç³»ç»Ÿä¼šæŠŠæ—©å‰å®ä¾‹çš„ coordinator ä¼ é€’ç»™ protocol çš„éµå¾ªè€…, å¹¶åœ¨è¿™é‡Œå®Œæˆ event çš„ç»‘å®š.</li><li>å½“å‘ç”Ÿ UIKit ä½“ç³»å†…çš„ event æ—¶, è§¦å‘ coordinator ä¸­çš„å›è°ƒ, è¿›è€Œåœ¨ coordinator ä¸­æ“çºµ injected model dependency.</li><li>SwiftUI è§¦å‘æ‰€æœ‰å¼•ç”¨åˆ° <code>@State</code> çš„ view çš„å˜åŒ–, åŒ…æ‹¬æ ¸å¿ƒ protocol éµå¾ªè€…çš„ update æ–¹æ³•.</li></ul></li></ul></li></ul><h2 id="ui-tips"><a class="markdownIt-Anchor" href="#ui-tips"></a> UI Tips</h2><p>SwiftUI æ¯•ç«Ÿå’Œä¹‹å‰ç†Ÿæ‚‰çš„ UIKit æ˜¯2å¥— API. è¿™é‡Œè®°å½•ä¸€äº›çç¢çš„ UI ç›¸å…³å®ç° tips.</p><ul><li>å®ç° navigation: æŠŠ<code>NavigationLink</code>æ”¾åˆ°<code>NavigationView</code>.</li><li>å®ç° presentation: <code>.sheet()</code>.</li><li>ä¸é€šè¿‡ click/tap gesture å®ç°<code>navigation</code>çš„ callback, å¯ä»¥é€šè¿‡<code>isActive</code>å‚æ•°, ä¼ å…¥ä¸€ä¸ªè‡ªå®šä¹‰çš„<code>ObservableObject</code>å¯¹è±¡, å°±å¯ä»¥å®ç°å¯¹å­é¡µé¢æ˜¯å¦æ˜¾ç¤ºçš„ç›‘å¬.</li></ul><h3 id="å¾…ç¡®è®¤çš„ç‚¹"><a class="markdownIt-Anchor" href="#å¾…ç¡®è®¤çš„ç‚¹"></a> å¾…ç¡®è®¤çš„ç‚¹</h3><ul><li><code>Scene</code>å’Œ<code>View</code>çš„<code>onChange</code>æ–¹æ³•, ä¼ å…¥ value æ˜¯æ€ä¹ˆ work çš„.</li></ul><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>æœ¬æ–‡æ‰€æœ‰å•ç‹¬å‡ºç°çš„ view, éƒ½æŒ‡çœŸæ­£çš„ runtime å¯¹è±¡, å’Œ<code>View</code>æˆ– <em>view struct</em> å«ä¹‰æœ‰åŒºåˆ«, åè€…ä»…ä»…æ˜¯ recipe/description. <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p></li></ol></section>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;ul class=&quot;markdownIt-TOC&quot;&gt;
&lt;li&gt;&lt;a href=&quot;#data-flow&quot;&gt;Data Flow&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#state&quot;&gt;State&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#state%E6%89%80%E6%8C%87%E7%A4%BA%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%94%9F%E5%91%BD%E6%9C%9F&quot;&gt;&lt;code&gt;State&lt;/code&gt;æ‰€æŒ‡ç¤ºå¯¹è±¡çš„ç”Ÿå‘½æœŸ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#state-wrapper-%E7%9A%84%E8%AF%AD%E6%B3%95%E7%89%B9%E5%BE%81&quot;&gt;&lt;code&gt;State&lt;/code&gt; wrapper çš„è¯­æ³•ç‰¹å¾&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#observableobject&quot;&gt;ObservableObject&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#observedobject&quot;&gt;ObservedObject&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#stateobject-ios-14&quot;&gt;StateObject (iOS 14+)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E8%AF%AD%E6%B3%95%E7%89%B9%E7%82%B9&quot;&gt;è¯­æ³•ç‰¹ç‚¹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#binding&quot;&gt;Binding&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#framework-integration&quot;&gt;Framework integration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#ui-tips&quot;&gt;UI Tips&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%BE%85%E7%A1%AE%E8%AE%A4%E7%9A%84%E7%82%B9&quot;&gt;å¾…ç¡®è®¤çš„ç‚¹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;data-flow&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#data-flow&quot;&gt;&lt;/a&gt; Data Flow&lt;/h2&gt;
&lt;h3 id=&quot;state&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#state&quot;&gt;&lt;/a&gt; State&lt;/h3&gt;
&lt;p&gt;Property wrapper &lt;code&gt;State&lt;/code&gt;åªæ˜¯ä¸€ä¸ªæ˜ å°„, å¹¶ä¸çœŸæ­£å¼€æ”¾ç©ºé—´å­˜å‚¨å˜é‡, çœŸæ­£çš„ç©ºé—´å¼€è¾Ÿæ˜¯è¿™æ ·çš„è¿‡ç¨‹:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;State&lt;/code&gt;å¿…é¡»å®šä¹‰åœ¨æŸä¸ª&lt;code&gt;ViewA: View&lt;/code&gt;ä¸­ä½œä¸ºæˆå‘˜å±æ€§, ä¸èƒ½å®šä¹‰åœ¨åˆ«çš„åœ°æ–¹, ä¹Ÿä¸èƒ½å®šä¹‰æˆoptional, ä¹Ÿä¸èƒ½å®šä¹‰æˆstaticå˜é‡.&lt;/li&gt;
&lt;li&gt;SwiftUI åœ¨&lt;code&gt;ViewA&lt;/code&gt;å¯¹è±¡ç”Ÿæˆæ—¶, é€šè¿‡æŸç§å’Œ&lt;code&gt;DynamicProperty&lt;/code&gt;ç›¸å…³çš„æœºåˆ¶(&lt;a href=&quot;https://medium.com/@kateinoigakukun/inside-swiftui-how-state-implemented-92a51c0cb5f6&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å¯èƒ½æ˜¯æŸç§ reflection æœºåˆ¶&lt;/a&gt;, ä¹Ÿå¯èƒ½æ˜¯ compiler synthesize), æ ¹æ®&lt;code&gt;State&lt;/code&gt;ä¸­æŒ‡ç¤ºçš„ initial value, åœ¨çœŸæ­£çš„ &lt;em&gt;view&lt;/em&gt;&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;#fn1&quot; id=&quot;fnref1&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt; å¯¹è±¡ä¸­å»ºç«‹äº†ä¸€ä»½æ•°æ®, å¹¶æŠŠ&lt;code&gt;ViewA&lt;/code&gt;å’Œå…¶æ‰€æœ‰&lt;code&gt;State&lt;/code&gt;çš„æˆå‘˜å˜é‡ä½œå‡ºäº† Model -&amp;gt; View çš„å…³è”.&lt;/li&gt;
&lt;li&gt;ä¹‹å&lt;code&gt;ViewA.body&lt;/code&gt;æ¯æ¬¡è¢«é‡æ–°è°ƒç”¨ (ä¾‹å¦‚ data change å¯¼è‡´çš„ update æˆ–è€… view é‡æ–°å‡ºç°åœ¨å±å¹•ä¸Šç­‰) å‰, éƒ½ä¼šä¿è¯ &lt;code&gt;ViewA&lt;/code&gt; ä¸­å¯ä»¥è®¿é—®åˆ°çš„å€¼è¢«æ›´æ–°åˆ°ä¸å†…å­˜ä¸­çš„è¿è¡Œæ—¶çŠ¶æ€ä¸€è‡´, è¿™æ ·ä¹‹åè®¿é—®/æ“çºµè¯¥å€¼æ—¶, æœ¬è´¨ä¸Šéƒ½æ˜¯è®¿é—®äº†å¯¹åº”çš„çœŸæ­£çš„ä¸ view å…³è”çš„æ•°æ®å¯¹è±¡.&lt;/li&gt;
&lt;li&gt;åœ¨ SwiftUI å¯ä»¥ç›‘æ§åˆ°çš„ç¯å¢ƒä¸‹è°ƒç”¨åˆ°æŸä¸ª&lt;code&gt;State&lt;/code&gt;çš„ getter çš„å‰æä¸‹, æˆ‘ä»¬åªè¦åœ¨ä»»ä½•åœ°æ–¹è§¦å‘è¿™ä¸ª&lt;code&gt;State&lt;/code&gt;çš„ setter, å°±æœ‰å¯èƒ½è§¦å‘è·å–äº† getter çš„&lt;code&gt;body&lt;/code&gt;çš„é‡æ–°è°ƒç”¨.
&lt;ul&gt;
&lt;li&gt;å½“&lt;code&gt;State&lt;/code&gt; wrap çš„ç±»å‹æ˜¯é&lt;code&gt;Equatable&lt;/code&gt;æ—¶, åªè¦è§¦å‘ setter, å³è§¦å‘&lt;code&gt;body&lt;/code&gt;è¢«è°ƒç”¨.&lt;/li&gt;
&lt;li&gt;å½“&lt;code&gt;State&lt;/code&gt; wrap çš„ç±»å‹éµå¾ª&lt;code&gt;Equatable&lt;/code&gt;æ—¶, åªæœ‰è§¦å‘ setter æ—¶çš„&lt;code&gt;newValue&lt;/code&gt;å’Œæ—§å€¼ä¸åŒæ—¶, æ‰ä¼šè§¦å‘&lt;code&gt;body&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨æ„åœ¨é SwiftUI ä½“ç³»ä¸‹, &lt;code&gt;State&lt;/code&gt;æ¯«æ— ä½œç”¨, ç”šè‡³åŸºæœ¬çš„ get/set é€»è¾‘éƒ½ä¸æ»¡è¶³.&lt;/p&gt;
&lt;h4 id=&quot;stateæ‰€æŒ‡ç¤ºå¯¹è±¡çš„ç”Ÿå‘½æœŸ&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#stateæ‰€æŒ‡ç¤ºå¯¹è±¡çš„ç”Ÿå‘½æœŸ&quot;&gt;&lt;/a&gt; &lt;code&gt;State&lt;/code&gt;æ‰€æŒ‡ç¤ºå¯¹è±¡çš„ç”Ÿå‘½æœŸ&lt;/h4&gt;
&lt;p&gt;æ— è®ºæ˜¯&lt;code&gt;State&lt;/code&gt;, è¿˜æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„&lt;code&gt;struct ViewA&lt;/code&gt;, æœ¬è´¨ä¸Šéƒ½åªæ˜¯ recipe, ä¸æ˜¯çœŸæ­£çš„è¿è¡Œæ—¶å¯¹è±¡. çœŸæ­£çš„è¿è¡Œæ—¶å¯¹è±¡, è¦ä¹ˆè¢« SwiftUI å¾ˆå¥½åœ°éšè—åœ¨çœŸæ­£çš„ runtime view å¯¹è±¡ä¸­, è¦ä¹ˆåœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„åˆ«çš„ reference type ä¸­(ç±»ä¼¼ä¸‹æ–‡çš„ObservableObject).&lt;/p&gt;</summary>
    
    
    
    <category term="Notes" scheme="https://crystdragon.github.io/categories/notes/"/>
    
    <category term="Apple Platforms" scheme="https://crystdragon.github.io/categories/apple-platforms/"/>
    
    
    <category term="SwiftUI" scheme="https://crystdragon.github.io/tags/swiftui/"/>
    
  </entry>
  
  <entry>
    <title>Testing in Xcode</title>
    <link href="https://crystdragon.github.io/2020/testing-in-xcode/"/>
    <id>https://crystdragon.github.io/2020/testing-in-xcode/</id>
    <published>2020-08-01T16:00:00.000Z</published>
    <updated>2020-08-02T11:08:33.444Z</updated>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#async-testing">Async Testing</a></li><li><a href="#attachments">Attachments</a></li><li><a href="#code-coverage">Code Coverage</a></li><li><a href="#%E7%BC%96%E5%86%99-unit-test-%E7%9A%84-best-practices">ç¼–å†™ Unit Test çš„ Best Practices</a><ul><li><a href="#codeapi-%E7%BB%86%E8%8A%82">code/API ç»†èŠ‚</a></li><li><a href="#%E9%9A%94%E7%A6%BB-dependency">éš”ç¦» Dependency</a></li><li><a href="#%E5%9C%A8-xcode-%E6%89%A7%E8%A1%8C-test-%E7%9A%84%E6%93%8D%E4%BD%9C%E6%8A%80%E5%B7%A7">åœ¨ Xcode æ‰§è¡Œ test çš„æ“ä½œæŠ€å·§</a></li></ul></li><li><a href="#test-plans">Test Plans</a></li><li><a href="#ci-%E7%9B%B8%E5%85%B3">CI ç›¸å…³</a></li></ul></p><hr><p>References:</p><ul><li><a href="https://developer.apple.com/videos/play/wwdc2017/409/" target="_blank" rel="noopener">Whatâ€™s New in Testing</a>, WWDC 2017, Session 409<ul><li>å¼‚æ­¥ testing API çš„å˜åŒ–</li><li>UI Test æ”¯æŒå¤š App test</li><li>UI Test çš„ query æ€§èƒ½ä¼˜åŒ– (éœ€è¦ programmer ä»‹å…¥)</li><li>Attachments</li></ul></li><li><a href="https://developer.apple.com/videos/play/wwdc2018/403/" target="_blank" rel="noopener">Whatâ€™s New in Testing</a>, WWDC 2018, Session 403<ul><li>Code coverage ä¼˜åŒ–</li><li>Xcode æ–°çš„ Testing é€‰é¡¹</li><li>æ”¯æŒå¹¶è¡Œæ‰§è¡Œ test</li></ul></li><li><a href="https://developer.apple.com/videos/play/wwdc2018/417/" target="_blank" rel="noopener">Testing Tips &amp; Tricks</a>, WWDC 2018, Session 417<ul><li>ç¼–å†™ test case çš„ best practics</li></ul></li><li><a href="https://developer.apple.com/videos/play/wwdc2019/413/" target="_blank" rel="noopener">Testing in Xcode</a>, WWDC 2019, Session 413<ul><li>review <code>XCTest</code> åŸºæœ¬åŠŸèƒ½</li><li>æ–°å¢ Test Plans</li><li>CI æ”¯æŒç»¼è¿°</li></ul></li></ul><hr> <a id="more"></a><h2 id="async-testing"><a class="markdownIt-Anchor" href="#async-testing"></a> Async Testing</h2><ul><li><code>XCTestExpectation</code>è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡, åˆ›å»ºå³è¡¨ç¤ºä»»åŠ¡å¼€å§‹æ‰§è¡Œ, éœ€è¦åœ¨ç‰¹å®šæ—¶æœº<code>fulfill</code>.<ul><li>æ—©æœŸåªèƒ½é€šè¿‡<code>XCTestCase</code>çš„ method åˆ›å»º, ä¸”åœ¨ä¸€ä¸ª test ä¸­, åˆ›å»ºåå¿…é¡»å®Œæˆ, å¦åˆ™æ­¤ case å³å¤±è´¥.</li><li>æ–° API å¯ä»¥ç‹¬ç«‹åˆ›å»º expectation.</li><li>é€šè¿‡<code>XCTestCase</code>çš„<code>wait</code>æ–¹æ³•æ£€æµ‹å®Œæˆæƒ…å†µ.</li></ul></li><li><code>XCTWaiter</code> æŠŠå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç»“æœçš„æ£€éªŒä»<code>XCTestCase</code>ä¸­æŠ½ç¦»å‡ºæ¥.<ul><li>å¯ä»¥æ³¨å…¥ delegate, è€ƒå¯Ÿ<code>wait</code>æ–¹æ³•çš„è¿”å›å€¼æ¥ä½œæ›´ç²¾ç»†çš„æ£€éªŒ.</li><li>é»˜è®¤æƒ…å†µä¸‹, ä¸ç®¡æ˜¯ä»€ä¹ˆ result éƒ½ä¸ä¼šè§¦å‘ test failure.</li></ul></li></ul><h2 id="attachments"><a class="markdownIt-Anchor" href="#attachments"></a> Attachments</h2><ul><li><code>XCTContext</code>çš„<code>runActivity</code>æ–¹æ³•å¯ä»¥åœ¨ report ä¸­äº§ç”Ÿä¸€ä¸ª block, ç”¨æ¥æŠŠä¸€äº› test ç¤ºä¾‹ç»„åˆåˆ°ä¸€èµ·.</li><li>Activity çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯ç»™ report å¢åŠ <code>XCTAttachment</code><ul><li><code>XCTAttachment</code>é»˜è®¤æ¸…é™¤é€»è¾‘æ˜¯æˆåŠŸæ¸…é™¤, å¤±è´¥ä¸æ¸…é™¤, æ­¤é»˜è®¤è¡Œä¸ºå¯ä»¥åœ¨schemeä¸­æ›´æ”¹.</li><li>æ¯ä¸ªattachmentè¿˜å¯ä»¥å¼ºåˆ¶è®¾ç½®<code>lifetime</code>å˜æ›´è¡Œä¸º.</li></ul></li><li>ä¸ä½¿ç”¨ Xcode GUI æå–attachment, éœ€è¦ç”¨åˆ°<em>xcresulttool</em>è¿™ä¸ª tool (Xcode11å¼€å§‹).<ul><li>å¾…æ£€æµ‹çš„æ–‡ä»¶æ ¹ç›®å½•ä½äº DerivedData æ–‡ä»¶å¤¹ä¸­, ä¸€èˆ¬ä¸º&quot;DerivedData/$PRODUCT_NAME-xxxxxxxxxx&quot;(éDerivedData/Build).</li><li>å­è·¯å¾„ä¸º&quot;Logs/Test&quot;, æ–‡ä»¶åç¼€ä¸€å®šæ˜¯&quot;xcresult&quot;.</li><li>å‚è€ƒ<a href="https://developer.apple.com/documentation/xcode_release_notes/xcode_11_release_notes?language=objc" target="_blank" rel="noopener">å®˜æ–¹ release notes</a>,  å‘½ä»¤ä¸º<code>xcrun xcresulttool get --format json --path ./Example.xcresult</code>, å¯ä»¥é€šè¿‡è¿½åŠ <code>--id REF</code>è¾“å‡ºå­ object.</li><li>ä¸€ä¸ª attachment æ˜¯ string çš„ä¾‹å­: Root -&gt; testsRef(â€“id) -&gt; summaryRef(â€“id) -&gt; attachments/payloadRef -&gt; ç›®æ ‡ string data çš„æ–‡ä»¶å(å®é™…è·¯å¾„ä¸º Data/data.$id, å¯ä»¥ç”¨ export å‘½ä»¤å¯¼å‡º)</li></ul></li><li>å®˜æ–¹æ ¼å¼éå¸¸å¤æ‚, å¯ä»¥ç”¨ç¬¬ä¸‰æ–¹ tool<a href="https://github.com/ChargePoint/xcparse" target="_blank" rel="noopener">xcparse</a>, è¿™æ˜¯å…¶<a href="https://www.chargepoint.com/engineering/xcparse/" target="_blank" rel="noopener">ä»‹ç»æ–‡ç« </a>.</li></ul><h2 id="code-coverage"><a class="markdownIt-Anchor" href="#code-coverage"></a> Code Coverage</h2><ul><li>å¯ä»¥åœ¨ Xcode é…ç½®.<ul><li>è¦ç»Ÿè®¡ coverage çš„ä»£ç æ¥è‡ªå“ªäº› target</li><li>è®¾å®šæ¯ä¸ª target ä¸­æ–°å†™çš„ test case æ˜¯å¦è‡ªåŠ¨ enable</li><li>æ¯ä¸ª class ä¸­çš„ tests æ˜¯å¦ä¹±åºæ‰§è¡Œ</li><li>æ˜¯å¦å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ class<ul><li><code>xcodebuild -parallel-testing-worker-count</code> å¯æ›´æ”¹.</li><li>é™¤äº† mac ä¸Šçš„ UITest å¤–, éƒ½æ”¯æŒ(simulator æˆ– unit test).</li></ul></li></ul></li><li>å‘½ä»¤è¡Œ tool: <code>xccov</code>.<ul><li>å¤„ç†&quot;.xccovreport&quot;æ–‡ä»¶, Xcode 11ä¹‹å‰.</li><li>å« code coverage ä¿¡æ¯çš„&quot;.xcresult&quot;æ–‡ä»¶, Xcode 11+.</li></ul></li></ul><h2 id="ç¼–å†™-unit-test-çš„-best-practices"><a class="markdownIt-Anchor" href="#ç¼–å†™-unit-test-çš„-best-practices"></a> ç¼–å†™ Unit Test çš„ Best Practices</h2><h3 id="codeapi-ç»†èŠ‚"><a class="markdownIt-Anchor" href="#codeapi-ç»†èŠ‚"></a> code/API ç»†èŠ‚</h3><ul><li>æ‰€æœ‰ test methods æ”¯æŒå®šä¹‰æˆ<code>throws</code>.</li><li><code>XCTNSPredicateExpectation</code>æ˜¯ä¾ç…§è½®è¯¢æœºåˆ¶å®ç°çš„, å¯èƒ½è¾ƒæ…¢, ä¼˜å…ˆç”¨å…¶ä»–<code>Expectation</code>.</li><li><code>XCTSkipIf</code>ç³»æ–¹æ³•å¯ä»¥è·³è¿‡å½“å‰ case, å¹¶ä¸”åç»­ä»£ç ä¸æ‰§è¡Œ, åœ¨ result ä¸­ä¼šæ ‡è®°æˆ skipped.</li><li><code>XCTUnwrap</code> ä¸“ç”¨äº unwrap optional.</li><li><code>XCTAssertThrowsError</code> ä¸“ç”¨äº catch error.</li></ul><h3 id="éš”ç¦»-dependency"><a class="markdownIt-Anchor" href="#éš”ç¦»-dependency"></a> éš”ç¦» Dependency</h3><p>å½“æŸä¸€ä¸ªæ¨¡å—æˆ‘ä»¬éœ€è¦å•ç‹¬æµ‹è¯•, ä½†æ˜¯è¯¥æ¨¡å—æœ‰å…³è”çš„å¤–éƒ¨å¯¹è±¡æ—¶, å¦‚ä½•ç¼–å†™æµ‹è¯• code.</p><ul><li>å¦‚æœå¤–éƒ¨ä¾èµ–æä¾›äº† framework å±‚é¢çš„æœºåˆ¶, å…è®¸æˆ‘ä»¬æ›¿æ¢ä¸€éƒ¨åˆ†é€»è¾‘, åˆ™å¯ä»¥ç¼–å†™ code å®‰æ’åˆ°ä½“ç³»ä¸­/<ul><li>Network ç›¸å…³: å®˜æ–¹çš„<code>URLSession</code>æ”¯æŒåˆå§‹åŒ–å•ä¸ªå¯¹è±¡, å¯ä»¥ç‹¬ç«‹è®¾ç½® custom<code>URLProtocol</code>æ¥æä¾› mock æ•°æ®.</li><li>Notificationç›¸å…³: ä¸ºäº†é˜²æ­¢è¢«å…¶ä»– code å¹²æ‰°, å®˜æ–¹çš„<code>NotificationCenter</code>æ”¯æŒåˆå§‹åŒ–å•ä¸ªå¯¹è±¡.</li></ul></li><li>å¦‚æœä½“ç³»æœ¬èº«ä¸æ”¯æŒ, é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†ä¾èµ–åˆ°çš„ä¸å¯æ§çš„å¤–éƒ¨ç±»æŠ½è±¡æˆprotocol.<ul><li>é…åˆ dependency injection, æŠŠ protocol ç±»å‹çš„å¯¹è±¡ä½œä¸ºå¾…æµ‹è¯•ç»„ä»¶åˆå§‹åŒ–æ—¶çš„è¾“å…¥.</li><li>åœ¨ç”Ÿäº§ç¯å¢ƒ code ä¸­, å°†å®é™…çš„å¤–éƒ¨ç±»éµå¾ªè¿™ä¸ª protocol; è€Œåœ¨ test ç¯å¢ƒä¸­ç¼–å†™ä¸€ä¸ªä¸´æ—¶çš„è¯¥ protocol éµå¾ªè€…æ¥ mock è¡Œä¸º.</li><li>å½“å¤–éƒ¨ä¾èµ–å’Œå¾…æµ‹è¯•ç»„ä»¶ä¹‹é—´çš„å…³ç³»æ¯”è¾ƒå¤æ‚çš„æ—¶å€™(æ¯”å¦‚æœ‰æŸç§æ›´æ·±å±‚æ¬¡çš„ä¾èµ–: å¤–éƒ¨ä¾èµ–å¯¹åº”çš„æŸä¸ª delegate method éœ€è¦å¼•ç”¨åˆ°ä¸å¤–éƒ¨ä¾èµ–åŒæ · type çš„å¯¹è±¡, ä»è€Œå¯¼è‡´ mock æ–¹ä¸ä»…ä»…éœ€è¦ mock å¤–éƒ¨ä¾èµ–æŠ½å‡ºçš„ protocol, è¿˜è¦æŠŠè¿™ä¸ª delegate è¿›ä¸€æ­¥æŠ½è±¡), éœ€è¦åŒæ—¶æŠ½è±¡å¤–éƒ¨ä¾èµ–ä¸­å¤šä¸ªå±‚é¢çš„ç±»å‹, å¿…è¦æ—¶å€™è¿˜éœ€è¦ä¾èµ– type å¼ºè½¬.</li><li>å½“æ¶‰åŠåˆ°è€—æ—¶è¾ƒä¹…çš„å¼‚æ­¥æœºåˆ¶æ—¶, æˆ‘ä»¬å¯ä»¥æŠŠå¼‚æ­¥æœºåˆ¶æŠ½è±¡å‡ºæ¥. åœ¨ç”Ÿäº§ç¯å¢ƒ code ä¸­, ä½¿ç”¨å®é™…çš„å¼‚æ­¥æµç¨‹; åœ¨ test ç¯å¢ƒä¸­ä½¿ç”¨é¡ºåºæµç¨‹.</li></ul></li></ul><h3 id="åœ¨-xcode-æ‰§è¡Œ-test-çš„æ“ä½œæŠ€å·§"><a class="markdownIt-Anchor" href="#åœ¨-xcode-æ‰§è¡Œ-test-çš„æ“ä½œæŠ€å·§"></a> åœ¨ Xcode æ‰§è¡Œ test çš„æ“ä½œæŠ€å·§</h3><ul><li>Source editor ä¸­çš„è±å½¢æŒ‰é’® control-click å¯ä»¥ jump to report.</li><li>å¯ä»¥åœ¨ test navigator ä¸­ command click é€‰æ‹©å¤šä¸ª case.</li><li>èœå• Product/Perform -&gt; Action ä¸­å¯ä»¥è¿›è¡Œç‰¹æ®Šçš„ test æ“ä½œ (ä¾‹å¦‚é‡å¤åˆšæ‰çš„ test).</li></ul><h2 id="test-plans"><a class="markdownIt-Anchor" href="#test-plans"></a> Test Plans</h2><p>å¯¹æŸä¸ª target æ‰§è¡Œ test æ—¶, å¯ä»¥è°ƒæ•´ä¸åŒçš„è¿è¡Œå‚æ•°/é€‰é¡¹è¿›è¡Œå¤šæ¬¡ test.</p><ul><li>Xcode åŸºæœ¬æ“ä½œæ”¯æŒ<ul><li>scheme editor ä¸­æŠŠ test å‡çº§æˆ test plan.</li><li>å¯ä»¥åœ¨ test navigator ä¸­ control-click, é€‰æ‹©æ‰§è¡Œ plan ä¸­æŸä¸ªç‰¹å®šçš„ test é…ç½®.</li></ul></li><li>æ”¯æŒè°ƒæ•´çš„å‚æ•°ä¸»è¦æœ‰:<ul><li>launch arguments &amp; environment vairables</li><li>language</li><li>Xcode runtime Sanitizers, diagnostics &amp; checker (å…è®¸é‡æ–°ç¼–è¯‘)</li><li>test é€‰é¡¹</li></ul></li><li>å¤šä¸ª scheme å¯ä»¥é‡å¤å¼•ç”¨åŒä¸€ä¸ª test plan.</li><li>ä¸€ä¸ª scheme å¯ä»¥åŒ…å«å¤šä¸ª test plan, å…¶ä¸­ä¸€ä¸ªä¸º default.<ul><li>é»˜è®¤æ‰§è¡Œ test æ—¶, ä½¿ç”¨ default test plan, ä¹Ÿå¯ä»¥åœ¨ test navigator ä¸­åˆ‡æ¢.</li><li>åœ¨ä½¿ç”¨å‘½ä»¤è¡Œæ—¶, å¯ä»¥é€šè¿‡ <code>xcodebuild -showTestPlans</code> æŸ¥çœ‹æ‰€æœ‰è¯¥ scheme çš„ test plan,  <code>xcodebuild test -testPlan</code> é€‰æ‹© plan.</li></ul></li></ul><h2 id="ci-ç›¸å…³"><a class="markdownIt-Anchor" href="#ci-ç›¸å…³"></a> CI ç›¸å…³</h2><p>ä¸€ä¸ª project è¿›å…¥ CI server åå…¸å‹çš„æµç¨‹æœ‰:</p><ol><li>ç¼–è¯‘&amp;æµ‹è¯•å·¥ç¨‹. æ ¸å¿ƒå‘½ä»¤<code>xcodebuild</code><ul><li><code>xcodebuild test</code> : æ•´ä½“æ‰§è¡ŒæŸä¸ª target çš„ test åŠ¨ä½œ</li><li><code>xcodebuild build-for-testing</code>: åª build ä¸ test, ç”Ÿæˆ&quot;.xctestrun&quot;æ–‡ä»¶. æ–‡ä»¶æ ¼å¼æ˜¯ property list, å…·ä½“è¯´æ˜è§<code>man xcodebuild.xctestrun</code>å‘½ä»¤.</li><li><code>xcodebuild test-without-building -xctestrun xxx.xctestrun</code>: å•ç‹¬test.</li><li>æœ€å2æ­¥å¯ä»¥åˆ†ç¦».</li><li><code>-resultBundlePath xxx.xcresult</code>: å¯ä»¥æŒ‡å®š test çš„ç»“æœç”¨äºåç»­æ­¥éª¤.</li></ul></li><li>è§£æ test ç»“æœ, ä»è€Œè¾“å‡º log/è‡ªåŠ¨å»ºç«‹ bug.<ul><li><code>xcrun xcresulttool</code> éœ€è¦è¾“å…¥ xcresult æ–‡ä»¶, è§£æ test result, è·å– attachment ç­‰.</li></ul></li><li>æ£€æŸ¥ code coverage<ul><li><code>xcrun xccov --report</code>: éœ€è¦è¾“å…¥ xcresult æ–‡ä»¶, Xcode 11+.</li><li><code>xcrun xccov</code>: éœ€è¦è¾“å…¥ xccovreport æ–‡ä»¶.</li></ul></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;ul class=&quot;markdownIt-TOC&quot;&gt;
&lt;li&gt;&lt;a href=&quot;#async-testing&quot;&gt;Async Testing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#attachments&quot;&gt;Attachments&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#code-coverage&quot;&gt;Code Coverage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E7%BC%96%E5%86%99-unit-test-%E7%9A%84-best-practices&quot;&gt;ç¼–å†™ Unit Test çš„ Best Practices&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#codeapi-%E7%BB%86%E8%8A%82&quot;&gt;code/API ç»†èŠ‚&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E9%9A%94%E7%A6%BB-dependency&quot;&gt;éš”ç¦» Dependency&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%9C%A8-xcode-%E6%89%A7%E8%A1%8C-test-%E7%9A%84%E6%93%8D%E4%BD%9C%E6%8A%80%E5%B7%A7&quot;&gt;åœ¨ Xcode æ‰§è¡Œ test çš„æ“ä½œæŠ€å·§&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#test-plans&quot;&gt;Test Plans&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#ci-%E7%9B%B8%E5%85%B3&quot;&gt;CI ç›¸å…³&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;References:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2017/409/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Whatâ€™s New in Testing&lt;/a&gt;, WWDC 2017, Session 409
&lt;ul&gt;
&lt;li&gt;å¼‚æ­¥ testing API çš„å˜åŒ–&lt;/li&gt;
&lt;li&gt;UI Test æ”¯æŒå¤š App test&lt;/li&gt;
&lt;li&gt;UI Test çš„ query æ€§èƒ½ä¼˜åŒ– (éœ€è¦ programmer ä»‹å…¥)&lt;/li&gt;
&lt;li&gt;Attachments&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2018/403/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Whatâ€™s New in Testing&lt;/a&gt;, WWDC 2018, Session 403
&lt;ul&gt;
&lt;li&gt;Code coverage ä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;Xcode æ–°çš„ Testing é€‰é¡¹&lt;/li&gt;
&lt;li&gt;æ”¯æŒå¹¶è¡Œæ‰§è¡Œ test&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2018/417/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Testing Tips &amp;amp; Tricks&lt;/a&gt;, WWDC 2018, Session 417
&lt;ul&gt;
&lt;li&gt;ç¼–å†™ test case çš„ best practics&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2019/413/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Testing in Xcode&lt;/a&gt;, WWDC 2019, Session 413
&lt;ul&gt;
&lt;li&gt;review &lt;code&gt;XCTest&lt;/code&gt; åŸºæœ¬åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;æ–°å¢ Test Plans&lt;/li&gt;
&lt;li&gt;CI æ”¯æŒç»¼è¿°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;</summary>
    
    
    
    <category term="Notes" scheme="https://crystdragon.github.io/categories/notes/"/>
    
    <category term="Apple Platforms" scheme="https://crystdragon.github.io/categories/apple-platforms/"/>
    
    
    <category term="Testing" scheme="https://crystdragon.github.io/tags/testing/"/>
    
    <category term="Xcode" scheme="https://crystdragon.github.io/tags/xcode/"/>
    
  </entry>
  
  <entry>
    <title>Pointfree.co Notes Ep.#23-25</title>
    <link href="https://crystdragon.github.io/2020/pointfree-co-notes-ep-23-25/"/>
    <id>https://crystdragon.github.io/2020/pointfree-co-notes-ep-23-25/</id>
    <published>2020-07-30T11:17:12.000Z</published>
    <updated>2020-07-30T11:54:51.930Z</updated>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#%E6%9C%80%E5%B8%B8%E8%A7%81%E7%9A%84-zip">æœ€å¸¸è§çš„ zip</a><ul><li><a href="#swift-%E6%8F%90%E4%BE%9B%E7%9A%84-zip">Swift æä¾›çš„ zip</a></li></ul></li><li><a href="#%E9%80%9A%E7%94%A8%E7%9A%84%E4%BA%8C%E5%85%83-zip">é€šç”¨çš„äºŒå…ƒ zip</a></li><li><a href="#%E5%A4%9A%E5%85%83-zip">å¤šå…ƒ zip</a></li><li><a href="#zip%E5%92%8Cmap%E7%9A%84%E8%81%94%E7%B3%BB"><code>zip</code>å’Œ<code>map</code>çš„è”ç³»</a></li></ul></p><p>è¿™é‡Œè®°å½•äº† <a href="http://pointfree.co" target="_blank" rel="noopener">pointfree.co</a> ä¸Š, ä»¥ä¸‹ä¸‰æœŸè§†é¢‘çš„ notes:</p><ul><li><a href="https://www.pointfree.co/episodes/ep23-the-many-faces-of-zip-part-1" target="_blank" rel="noopener">Ep #23. The Many Faces of Zip: Part 1</a></li><li><a href="https://www.pointfree.co/episodes/ep24-the-many-faces-of-zip-part-2" target="_blank" rel="noopener">Ep #24. The Many Faces of Zip: Part 2</a></li><li><a href="https://www.pointfree.co/episodes/ep25-the-many-faces-of-zip-part-3" target="_blank" rel="noopener">Ep #25. The Many Faces of Zip: Part 3</a></li></ul><hr><p>zipçš„æœ¬è´¨: ä¸€ä¸ªæ˜ å°„</p><h2 id="æœ€å¸¸è§çš„-zip"><a class="markdownIt-Anchor" href="#æœ€å¸¸è§çš„-zip"></a> æœ€å¸¸è§çš„ zip</h2><p>è€ƒè™‘æ˜¾ç„¶å­˜åœ¨è¿™æ ·çš„æ˜ å°„<code>A, B -&gt; (A, B)</code>. é‚£ä¹ˆå¯¹ä»»æ„ä¸€ä¸ªåŒ…å«<code>T</code>çš„ç»“æ„<code>Struct&lt;T&gt;</code>, æˆ‘ä»¬ä¸€å®šå¯ä»¥ç»™å‡ºæ˜ å°„<code>g: Struct&lt;A&gt; , Struct&lt;B&gt; -&gt; Struct&lt;(A, B)&gt;</code>. è¿™æ ·çš„æ˜ å°„<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span></span></span>å°±æ˜¯<code>zip</code>.</p><p>è¿™é‡Œçš„<code>Struct</code>å¯ä»¥æ˜¯ Swift ä¸­çš„è®¸å¤šæœ‰æ„ä¹‰çš„ç»“æ„, æ¯”å¦‚:</p><ul><li>Optional</li><li>Array</li><li>function</li><li>callback function</li><li>ä»»æ„æœ‰&quot;åŒ…å«&quot;å…³ç³»çš„ plain structure</li></ul><p>ä¾‹å¦‚, é’ˆå¯¹<code>Optional</code>, æˆ‘ä»¬å¯ä»¥å®ç°</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">zip</span>&lt;A, B&gt;<span class="params">(<span class="number">_</span> lhs: Optional&lt;A&gt;, <span class="number">_</span> rhs: Optional&lt;B&gt;)</span></span> -&gt; <span class="type">Optional</span>&lt;(<span class="type">A</span>, <span class="type">B</span>)&gt; &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> a = lhs, <span class="keyword">let</span> b = rhs <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">  <span class="keyword">return</span> .some((a, b))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>åˆä¾‹å¦‚, é’ˆå¯¹ function: <code>() -&gt; T</code>, æˆ‘ä»¬å¯ä»¥å®ç°</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Function</span>&lt;<span class="type">T</span>&gt; = () -&gt; <span class="type">T</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">zip</span>&lt;A, B&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="number">_</span> lhs: @escaping Function&lt;A&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="number">_</span> rhs: @escaping Function&lt;B&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> -&gt; <span class="type">Function</span>&lt;(<span class="type">A</span>, <span class="type">B</span>)&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    (lhs(), rhs())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="swift-æä¾›çš„-zip"><a class="markdownIt-Anchor" href="#swift-æä¾›çš„-zip"></a> Swift æä¾›çš„ zip</h3><p>åœ¨æ ‡å‡†åº“ä¸­<code>zip(Sequence&lt;A&gt;, Sequence&lt;B&gt;) -&gt; Sequence&lt;(A, B)&gt;</code>å°±æ˜¯ä¸€ä¸ªé€šç”¨çš„ä¾‹å­. (å®ä¸ºä¼ªä»£ç , å®é™…ä¸Š return type æ˜¯ä¸€ä¸ª concrete type)</p><p>ç¬¬ä¸€æ–¹è®¸å¤š framework ä¹Ÿæä¾›äº† zip. ä¾‹å¦‚: Combine ç»™è®¸å¤šéµå¾ª<code>Publisher</code>çš„ concrete type, å¢åŠ äº†æˆå‘˜æ–¹æ³•, ç»“æ„ä¸º<code>Publisher&lt;A&gt;.zip(Publisher&lt;B&gt;) -&gt; Publisher&lt;(A, B)&gt;</code>. (å®ä¸ºä¼ªä»£ç , æ–¹æ³•æ‰€åœ¨çš„ç±»å‹å’Œ return type éƒ½æ˜¯ concrete type, æ³›å‹å‚æ•°ä¹Ÿç¨æœ‰ä¸åŒ)</p><h2 id="é€šç”¨çš„äºŒå…ƒ-zip"><a class="markdownIt-Anchor" href="#é€šç”¨çš„äºŒå…ƒ-zip"></a> é€šç”¨çš„äºŒå…ƒ zip</h2><p>ç»™å®šä¸€ä¸ªæ˜ å°„<code>f: (A, B) -&gt; C</code>,  å¯¹ä»»æ„ä¸€ä¸ªåŒ…å«<code>T</code>çš„ç»“æ„<code>Struct&lt;T&gt;</code>, æˆ‘ä»¬ä¸€å®šå¯ä»¥ç»™å‡ºæ˜ å°„<code>g: (Struct&lt;A&gt; , Struct&lt;B&gt;) -&gt; Struct&lt;C&gt;</code>.</p><p>ä¾‹å¦‚, é’ˆå¯¹ callback function: <code>((T) -&gt; Void) -&gt; Void</code>çš„ä¾‹å­:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»™å®š f</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span>&lt;A, B, C&gt;<span class="params">(<span class="number">_</span> lhs: A, <span class="number">_</span> rhs: B)</span></span> -&gt; <span class="type">C</span> &#123; <span class="built_in">fatalError</span>() &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° g</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span>&lt;A, B, C&gt;<span class="params">(<span class="number">_</span> lhs: A, <span class="number">_</span> rhs: B)</span></span> -&gt; <span class="type">C</span> &#123; <span class="built_in">fatalError</span>() &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">zip</span>&lt;A, B, C&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="number">_</span> lhs: @escaping CallbackFunction&lt;A&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="number">_</span> rhs: @escaping CallbackFunction&lt;B&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> -&gt; <span class="type">CallbackFunction</span>&lt;<span class="type">C</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; callback <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">var</span> lValue: <span class="type">A?</span></span><br><span class="line">    <span class="keyword">var</span> rValue: <span class="type">B?</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> lValue = lValue, <span class="keyword">let</span> rValue = rValue <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">      callback(f(lValue, rValue))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    lhs &#123; returnValue <span class="keyword">in</span></span><br><span class="line">      lValue = returnValue</span><br><span class="line">      check()</span><br><span class="line">    &#125;</span><br><span class="line">    rhs &#123; returnValue <span class="keyword">in</span></span><br><span class="line">      rValue = returnValue</span><br><span class="line">      check()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æœ‰æ—¶å€™ç§°<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span></span></span>æ˜¯ zip, ä¸Šæ–‡å¸¸è§ zip æ˜¯è¿™ç§å®šä¹‰ä¸‹çš„ä¸€ä¸ªç‰¹ä¾‹, å³æŒ‡å®šäº†<code>f(A, B) = (A, B)</code>.</li><li>æœ‰æ—¶å€™ç§°<code>f-&gt;g</code> æ˜¯ zip, è¿™ä¸ª zip æ›´é«˜é˜¶, å¹¶ä¸”å¯ä»¥ç”±<code>Struct</code>çš„ç»“æ„å”¯ä¸€ç¡®å®š.</li></ul><p>ä¾‹å¦‚, é«˜é˜¶å½¢å¼çš„<code>Array</code>çš„ zip å¯ä»¥è¿™ä¹ˆå®ç°:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">zip</span>&lt;A, B, C&gt;<span class="params">(with f: @escaping <span class="params">(A, B)</span></span></span> -&gt; <span class="type">C</span>) -&gt; ([<span class="type">A</span>], [<span class="type">B</span>]) -&gt; [<span class="type">C</span>] &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; arrayA, arrayB <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">var</span> results: [<span class="type">C</span>] = []</span><br><span class="line">    <span class="keyword">let</span> maxCount = <span class="built_in">min</span>(arrayA.<span class="built_in">count</span>, arrayB.<span class="built_in">count</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">0</span>..&lt;maxCount &#123;</span><br><span class="line">      results.append(f(arrayA[index], arrayB[index]))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤šå…ƒ-zip"><a class="markdownIt-Anchor" href="#å¤šå…ƒ-zip"></a> å¤šå…ƒ zip</h2><p>åœ¨äºŒå…ƒ zip çš„åŸºç¡€ä¸Š, æŠŠ f çš„è¾“å…¥ä¸ªæ•°å¢åŠ å³å¯. æœ€å¸¸è§çš„å¤šå…ƒ zip ä¹Ÿæ˜¯åŸºäº tupleçš„, å³<code>f: (T1, T2, T3...) -&gt; (T1, T2, T3...)</code>.<br>å½“ç„¶å‚ç…§äºŒå…ƒçš„ä¾‹å­, ä¹Ÿæœ‰é«˜é˜¶çš„å¤šå…ƒ zip.</p><h2 id="zipå’Œmapçš„è”ç³»"><a class="markdownIt-Anchor" href="#zipå’Œmapçš„è”ç³»"></a> <code>zip</code>å’Œ<code>map</code>çš„è”ç³»</h2><p><code>map</code>å¯ä»¥çœ‹æˆæ˜¯é€šç”¨çš„å¤šå…ƒ zip çš„ä¸€ä¸ªç‰¹ä¾‹. å›ºå®š f ä¸­çš„è¾“å…¥ä¸ªæ•°ä¸º1ä¸ªå³å¯å¾—åˆ° map çš„å®šä¹‰.<br>ç»™å®šä¸€ä¸ªæ˜ å°„<code>f: A -&gt; B</code>,  å¯¹ä»»æ„ä¸€ä¸ªåŒ…å«<code>T</code>çš„ç»“æ„<code>Struct&lt;T&gt;</code>, æˆ‘ä»¬ä¸€å®šå¯ä»¥ç»™å‡ºæ˜ å°„<code>g: Struct&lt;A&gt; -&gt; Struct&lt;B&gt;</code>.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;ul class=&quot;markdownIt-TOC&quot;&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%9C%80%E5%B8%B8%E8%A7%81%E7%9A%84-zip&quot;&gt;æœ€å¸¸è§çš„ zip&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#swift-%E6%8F%90%E4%BE%9B%E7%9A%84-zip&quot;&gt;Swift æä¾›çš„ zip&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E9%80%9A%E7%94%A8%E7%9A%84%E4%BA%8C%E5%85%83-zip&quot;&gt;é€šç”¨çš„äºŒå…ƒ zip&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%A4%9A%E5%85%83-zip&quot;&gt;å¤šå…ƒ zip&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#zip%E5%92%8Cmap%E7%9A%84%E8%81%94%E7%B3%BB&quot;&gt;&lt;code&gt;zip&lt;/code&gt;å’Œ&lt;code&gt;map&lt;/code&gt;çš„è”ç³»&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;
&lt;p&gt;è¿™é‡Œè®°å½•äº† &lt;a href=&quot;http://pointfree.co&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pointfree.co&lt;/a&gt; ä¸Š, ä»¥ä¸‹ä¸‰æœŸè§†é¢‘çš„ notes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.pointfree.co/episodes/ep23-the-many-faces-of-zip-part-1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Ep #23. The Many Faces of Zip: Part 1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.pointfree.co/episodes/ep24-the-many-faces-of-zip-part-2&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Ep #24. The Many Faces of Zip: Part 2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.pointfree.co/episodes/ep25-the-many-faces-of-zip-part-3&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Ep #25. The Many Faces of Zip: Part 3&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;zipçš„æœ¬è´¨: ä¸€ä¸ªæ˜ å°„&lt;/p&gt;
&lt;h2 id=&quot;æœ€å¸¸è§çš„-zip&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#æœ€å¸¸è§çš„-zip&quot;&gt;&lt;/a&gt; æœ€å¸¸è§çš„ zip&lt;/h2&gt;
&lt;p&gt;è€ƒè™‘æ˜¾ç„¶å­˜åœ¨è¿™æ ·çš„æ˜ å°„&lt;code&gt;A, B -&amp;gt; (A, B)&lt;/code&gt;. é‚£ä¹ˆå¯¹ä»»æ„ä¸€ä¸ªåŒ…å«&lt;code&gt;T&lt;/code&gt;çš„ç»“æ„&lt;code&gt;Struct&amp;lt;T&amp;gt;&lt;/code&gt;, æˆ‘ä»¬ä¸€å®šå¯ä»¥ç»™å‡ºæ˜ å°„&lt;code&gt;g: Struct&amp;lt;A&amp;gt; , Struct&amp;lt;B&amp;gt; -&amp;gt; Struct&amp;lt;(A, B)&amp;gt;&lt;/code&gt;. è¿™æ ·çš„æ˜ å°„&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;g&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.625em;vertical-align:-0.19444em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.03588em;&quot;&gt;g&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;å°±æ˜¯&lt;code&gt;zip&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;è¿™é‡Œçš„&lt;code&gt;Struct&lt;/code&gt;å¯ä»¥æ˜¯ Swift ä¸­çš„è®¸å¤šæœ‰æ„ä¹‰çš„ç»“æ„, æ¯”å¦‚:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Optional&lt;/li&gt;
&lt;li&gt;Array&lt;/li&gt;
&lt;li&gt;function&lt;/li&gt;
&lt;li&gt;callback function&lt;/li&gt;
&lt;li&gt;ä»»æ„æœ‰&amp;quot;åŒ…å«&amp;quot;å…³ç³»çš„ plain structure&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾‹å¦‚, é’ˆå¯¹&lt;code&gt;Optional&lt;/code&gt;, æˆ‘ä»¬å¯ä»¥å®ç°&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;zip&lt;/span&gt;&amp;lt;A, B&amp;gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt; lhs: Optional&amp;lt;A&amp;gt;, &lt;span class=&quot;number&quot;&gt;_&lt;/span&gt; rhs: Optional&amp;lt;B&amp;gt;)&lt;/span&gt;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;type&quot;&gt;Optional&lt;/span&gt;&amp;lt;(&lt;span class=&quot;type&quot;&gt;A&lt;/span&gt;, &lt;span class=&quot;type&quot;&gt;B&lt;/span&gt;)&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;guard&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; a = lhs, &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; b = rhs &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123; &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; .some((a, b))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Notes" scheme="https://crystdragon.github.io/categories/notes/"/>
    
    <category term="Swift" scheme="https://crystdragon.github.io/categories/swift/"/>
    
    
    <category term="pointfree.co" scheme="https://crystdragon.github.io/tags/pointfree-co/"/>
    
    <category term="Functional Programming" scheme="https://crystdragon.github.io/tags/functional-programming/"/>
    
  </entry>
  
  <entry>
    <title>Swift Practices &amp; Perls (2)</title>
    <link href="https://crystdragon.github.io/2020/swift-practices-perls-2/"/>
    <id>https://crystdragon.github.io/2020/swift-practices-perls-2/</id>
    <published>2020-07-29T16:00:00.000Z</published>
    <updated>2020-07-30T12:35:17.094Z</updated>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#%E6%A0%87%E5%87%86%E5%BA%93%E6%8B%BE%E9%81%97">æ ‡å‡†åº“æ‹¾é—</a><ul><li><a href="#string%E5%92%8C%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2"><code>String</code>å’Œå…¶ä»–ç±»å‹ä¹‹é—´çš„è½¬æ¢</a></li><li><a href="#comparisons">Comparisons</a></li><li><a href="#lazy-or-not">Lazy or not</a></li><li><a href="#compiler-synthesized-conformance">Compiler-synthesized conformance</a><ul><li><a href="#%E4%BE%9D%E8%B5%96-compiler-synthesized-%E4%BB%A3%E7%A0%81%E7%9A%84%E9%80%BB%E8%BE%91%E6%B3%A8%E5%85%A5%E6%8A%80%E5%B7%A7">ä¾èµ– compiler-synthesized ä»£ç çš„é€»è¾‘æ³¨å…¥æŠ€å·§</a></li></ul></li></ul></li><li><a href="#tricks-patterns">Tricks &amp; Patterns</a><ul><li><a href="#implementing-ghost-operator">Implementing â€œghost operatorâ€</a><ul><li><a href="#%E9%97%AE%E9%A2%98%E8%83%8C%E6%99%AF">é—®é¢˜èƒŒæ™¯</a></li><li><a href="#%E9%97%AE%E9%A2%98%E7%9B%AE%E6%A0%87">é—®é¢˜ç›®æ ‡</a></li><li><a href="#%E5%AE%9E%E7%8E%B0">å®ç°</a></li></ul></li></ul></li></ul></p><hr><p>ä¸‹æ–‡éƒ¨åˆ†å†…å®¹æˆäº2018å¹´</p><hr><p>æœ¬æ–‡ç»§ç»­ä¸Šä¸€ç¯‡<a href="/2020/swift-practices-perls-1/">Swift Practices &amp; Perls (1)</a>, è®°å½•æ ‡å‡†åº“å­¦ä¹ è¿‡ç¨‹ä¸­çš„æŠ€å·§.</p><h2 id="æ ‡å‡†åº“æ‹¾é—"><a class="markdownIt-Anchor" href="#æ ‡å‡†åº“æ‹¾é—"></a> æ ‡å‡†åº“æ‹¾é—</h2><p>Swift æ ‡å‡†åº“æä¾›çš„ API å¼ºå¤§è€Œä¼˜é›…. è¿™é‡Œå½’çº³æ€»ç»“äº†ä¸€äº›ç½‘ä¸Šä¸å¸¸è§çš„ç‚¹.</p><h3 id="stringå’Œå…¶ä»–ç±»å‹ä¹‹é—´çš„è½¬æ¢"><a class="markdownIt-Anchor" href="#stringå’Œå…¶ä»–ç±»å‹ä¹‹é—´çš„è½¬æ¢"></a> <code>String</code>å’Œå…¶ä»–ç±»å‹ä¹‹é—´çš„è½¬æ¢</h3><p>ä¸€æ–¹é¢, æ ‡å‡†åº“ä¸­å­˜åœ¨å¤šä¸ª protocol, æ¥å…³è”è‡ªå®šä¹‰ç±»å‹å’Œ<code>String</code>. é€šå¸¸, åœ¨éœ€è¦æŒ‰æ–‡æœ¬æ ¼å¼æ‰“å°æŸä¸ªå¯¹è±¡, æˆ–æ¶‰åŠåˆ°ç”¨æ–‡æœ¬è¿›è¡Œåºåˆ—åŒ–/ååºåˆ—åŒ–æ—¶, å¯èƒ½ä¼šä½¿ç”¨åˆ°è¿™äº› protocol.</p><ul><li><code>ExpressibleByStringLiteral</code> (æ—§å<code>StringLiteralConvertible</code>). éµå¾ªè¯¥ protocol çš„ç±»å‹, æ”¯æŒä½¿ç”¨ string literal åˆå§‹åŒ–.</li><li><code>CustomStringConvertible</code>å’Œ<code>CustomDebugStringConvertible</code>. æ”¯æŒæœ€åŸºæœ¬çš„è¾“å‡ºåˆ°ä¸€ä¸ª<code>String</code>.</li><li><code>LosslessStringConvertible</code>. è¯¥ protocol ç»§æ‰¿è‡ª <code>CustomStringConvertible</code>. ä¸åè€…ä¸åŒçš„æ˜¯, è¯¥ protocol çš„éµå¾ªè€…å¿…é¡»æä¾›å’Œ<code>String</code>ä¹‹é—´åŒå‘çš„ç²¾ç¡®è½¬åŒ–. å› æ­¤æŸç§æ„ä¹‰ä¸Šè¯´, éµå¾ªæœ¬ protocol çš„ç±»å‹è½¬åŒ–æˆçš„<code>String</code>å¯ç”¨èŒƒå›´æ›´å¹¿, ä¸é™äº debug/print. å› ä¸ºä¸ç”¨æ‹…å¿ƒ2ä¸ªä¸åŒçš„å¯¹è±¡å¯¹åº”åˆ°åŒä¸€ä¸ª<code>String</code>.</li><li><code>TextOutputStreamable</code>. æ”¯æŒæŒ‰æµå¼å¢é‡æ·»åŠ åˆ°å·²æœ‰çš„ stream çš„æœ«å°¾. å› ä¸ºæ”¯æŒå¢é‡æ·»åŠ , æ‰€ä»¥éµå¾ªè€…å®é™…å®ç°æ—¶, å¯èƒ½å’Œå…¶ä»–è¾“å‡º<code>String</code>çš„ protocol ç›¸æ¯”, å†…å­˜å ç”¨ä¸Šå¯ä»¥æœ‰ä¸€äº›ä¼˜åŒ–.</li></ul><p>å¦ä¸€æ–¹é¢, <code>String</code>æœ¬èº«ä¹Ÿå­˜åœ¨å¥½å‡ ç§ initializer. æ ‡å‡†åº“å»ºè®®æˆ‘ä»¬ä½¿ç”¨<code>String</code>çš„å„ç§åˆå§‹åŒ–æ–¹æ³•, è€Œä¸è¦ç›´æ¥è°ƒç”¨ä¸Šé¢å„ä¸ª protocol å®šä¹‰çš„æ–¹æ³•.</p><ul><li><code>init&lt;T&gt;(_ value: T, radix: Int = default, uppercase: Bool = default)</code>. æŠŠ<code>Int</code>æŒ‰æŸä¸ªè¿›åˆ¶è½¬æ¢æˆ<code>String</code>.</li><li><code>init&lt;T&gt;(_ value: T) where T : LosslessStringConvertible</code>.</li><li><code>init&lt;Subject&gt;(describing: Subject)</code>. ä¼˜å…ˆä½¿ç”¨<code>TextOutputStreamable</code>çš„å®ç°, æœ€åä½¿ç”¨<code>CustomDebugStringConvertible</code>çš„å®ç°, åå‘ç²¾å‡†æ€§.</li><li><code>init&lt;Subject&gt;(reflecting: Subject)</code>. ä¼˜å…ˆä½¿ç”¨<code>CustomDebugStringConvertible</code>, æœ€åä½¿ç”¨<code>TextOutputStreamable</code>, åå‘debug.</li></ul><h3 id="comparisons"><a class="markdownIt-Anchor" href="#comparisons"></a> Comparisons</h3><p>åœ¨STLä¸­, å¹¶éæ‰€æœ‰å¯æ¯”çš„å¯¹è±¡éƒ½ç›´æ¥éµå¾ª<code>Comparable</code>, ä½†ä¸€å®šè¦æ±‚æœ€ç»ˆçš„åº•å±‚ element å¯¹è±¡æ˜¯éµå¾ªçš„.<br>å¯¹äºä¸ç›´æ¥éµå¾ª<code>Comparable</code>çš„ç±»å‹æ¥è¯´, ä»–ä»¬æ¯”è¾ƒå„è‡ªå¯¹è±¡çš„æ–¹å¼æ— å¤–ä¹é€šè¿‡ operator æˆ– method.</p><a id="more"></a><ul><li><code>StringProtocol</code>éµå¾ªè€…ä¸­, <code>String</code>ç›´æ¥éµå¾ª<code>Comparable</code>; ä½†<code>SubString</code>æ²¡æœ‰, å¯é€šè¿‡ <code>&lt;</code>è¿ç®—ç¬¦æ¯”è¾ƒ.</li><li>éµå¾ª<code>Sequence</code>çš„ç±»å‹, å¦‚æœæœ¬èº«ä¸éµå¾ª<code>Comparable</code>, ä½†<code>Element</code>å®é™…éµå¾ª<code>Comparable</code>, é‚£ä¹ˆå¯ä»¥é€šè¿‡<code>lexicographicallyPrecedes</code>è¿›è¡Œå­—å…¸æ¯”è¾ƒ.</li><li>åœ¨<a href="https://github.com/apple/swift-evolution/blob/master/proposals/0283-tuples-are-equatable-comparable-hashable.md" target="_blank" rel="noopener">SE-0283</a>è¢«åˆå…¥ Swift å‰(ä¸æ—©äºSwift 5.3), ç”±å¤šä¸ªåˆ†é‡ç»„æˆçš„ tuple, æœ¬èº«æ˜¯ä¸éµå¾ª<code>Comparable</code>çš„. ä½†æ˜¯æ ‡å‡†åº“ä¸ºå«æœ‰2-6ä¸ªåˆ†é‡çš„ tuple, æ‰‹åŠ¨é‡è½½äº†<code>&lt;</code>æ“ä½œç¬¦, å…è®¸æˆ‘ä»¬ç›´æ¥ä½¿ç”¨<code>&lt;</code>è¿›è¡Œå­—å…¸æ¯”è¾ƒ.</li></ul><h3 id="lazy-or-not"><a class="markdownIt-Anchor" href="#lazy-or-not"></a> Lazy or not</h3><p>å½“æˆ‘ä»¬è¦ç»™ä¸€ä¸ª<code>Sequence</code>/<code>Collection</code>å¢åŠ ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™, è¦è€ƒè™‘æ˜¯å¦è¦æŠŠè¿™ä¸ªæ–¹æ³•è®¾è®¡æˆ lazy çš„. è¿™é‡Œçš„ lazy æŒ‡çš„æ˜¯, å½“æ–¹æ³•æ‰§è¡Œæ—¶, ä¸å®é™…å¼€è¾Ÿå†…å­˜åˆ›å»ºä¸€ä¸ªæ–°çš„é›†åˆ, æˆ–å®é™…éå†æ•´ä¸ªåºåˆ—, è€Œæ˜¯æŠŠç›¸å…³å¾…æ‰§è¡Œçš„æ“ä½œ/è§„åˆ™å…ˆä¿ç•™, ç­‰åˆ°åé¢ä¸å¾—ä¸æ‰§è¡Œçš„æ—¶å€™å†æ‰§è¡Œ.</p><p>å½“è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„<code>Sequence</code>/<code>Collection</code>æ—¶, è¿™é‡Œè¦è€ƒè™‘çš„ lazy çš„å«ä¹‰è¿˜æ˜¯ä¸¤é‡çš„. ä¸€æ–¹é¢è¦è€ƒè™‘å½“å‰æ–¹æ³•æ˜¯å¦ lazy, å¦ä¸€æ–¹é¢è¦è€ƒè™‘å¯¹è¿”å›çš„é›†åˆè¿›ä¸€æ­¥æ‰§è¡Œé lazy æ–¹æ³•æ—¶, æ˜¯å¦ lazy.</p><p>æ ‡å‡†åº“ç»™è¿™ä¸ªé—®é¢˜ä½œå‡ºäº†å¾ˆå¥½çš„ç¤ºèŒƒ.<br>æœ‰ä¸€äº›æ–¹æ³•æœ¬èº«ä¸€å®šæ˜¯ lazy çš„, è¿”å›çš„æ–°å¯¹è±¡çš„åç»­æ“ä½œæ˜¯å¦ lazy è¦çœ‹å…¶ä»–æ¡ä»¶. ä¾‹å¦‚:</p><ul><li><code>BidirectionalCollection.reversed()</code>. æ–¹æ³•æœ¬èº«åœ¨<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>å†…å³å®Œæˆ.</li><li><code>Sequence.enumerated()</code>. æ–¹æ³•æœ¬èº«åœ¨<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>å†…å³å®Œæˆ.</li><li><code>Sequence.lazy</code>. æ–¹æ³•æœ¬èº«åœ¨<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>å†…å³å®Œæˆ. å¹¶ä¸”è¿”å›ä¸€ä¸ªéµå¾ªäº†<code>LazySequenceProtocol</code>çš„å¯¹è±¡. ä»è€Œä¿è¯åç»­ä»»æ„æ“ä½œå‡ä¸º lazy.<br>å¦ä¸€äº›æ–¹æ³•, æœ¬èº«æ˜¯å¦ lazy è¦çœ‹<code>Self</code>, åœ¨ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ imperative çš„, ä½†å½“<code>Self: LazySequenceProtocol</code>æ—¶, æ˜¯ lazy çš„. ä¾‹å¦‚:</li><li><code>Sequence.map()</code></li><li><code>Sequence.filter()</code></li></ul><p>è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®çš„ protocol <code>LazySequenceProtocol</code>. è¿™ä¸ª protocol åœ¨ä½“ç³»ä¸­èµ·åˆ°è¯­ä¹‰æ ‡è®°ä½œç”¨, ä¸€ä¸ªéµå¾ªäº†<code>Sequence</code>çš„ç±»å‹æ˜¯å¦è¿›ä¸€æ­¥éµå¾ª<code>LazySequenceProtocol</code>, ä¼šå¯¼è‡´åœ¨è¯¥ç±»å‹ä¸Šè°ƒç”¨æ–¹æ³•æ—¶, äº§ç”Ÿä¸åŒçš„ç»“æœ.</p><p>ç°åœ¨å¯ä»¥å›ç­”ä¸€å¼€å§‹çš„é—®é¢˜. æˆ‘ä»¬è‡ªå·±å†™çš„æ–¹æ³•, å¦‚æœæ“ä½œæ˜¯æœ‰æ¶ˆè€—æ€§çš„, æˆ–è€…è€—æ—¶å¾ˆé•¿, å¯ä»¥è€ƒè™‘æŠŠä»–å®šä¹‰æˆ lazy çš„. å®ç°æ—¶ä¹Ÿè¦éµå¾ªä¸‹é¢è¿™ä¸ªçº¦å®š:</p><ul><li>åœ¨é»˜è®¤æƒ…å†µä¸‹, è¿”å›ä¸€ä¸ªä»¥<code>Self</code>ä½œä¸ºæ¨¡æ¿å‚æ•°çš„æ³›å‹ç»“æ„. è¿™ä¸ªç»“æ„åªæ˜¯ä¸€ä¸ª wrapper, ç»™<code>Self</code>ä½œäº†ä¸€å±‚æµ…çš„å°è£…, è¿™ä¸ªæ–¹æ³•æœ¬èº«å°±æ˜¯ lazy å³å¯.</li><li>åœ¨<code>Self: LazySequenceProtocol</code>æ—¶, è¿”å›ä¸€ä¸ªéµå¾ªäº†<code>LazySequenceProtocol</code>çš„ wrapper, ä¿è¯åç»­æ“ä½œå¯ä»¥ç»§ç»­ç”¨ lazy æ“ä½œä¸²èµ·æ¥.</li><li>åœ¨ Swift æ”¯æŒ conditional conformance å, ä¸Šè¿°ä¸¤ç‚¹å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç”¨åŒä¸€ä¸ª wrapper ç±»å‹ç»Ÿä¸€èµ·æ¥.</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯, æ­£å¦‚æ ‡å‡†åº“å¼€å‘è€…åœ¨ Swift Forums ä¸ŠæŒ‡å‡ºè¿‡: å¯¹ä¸€ä¸ªæ–¹æ³•, å¹¶ä¸åº”è¯¥ä¸åŠ æ€è€ƒåœ°å°±å†³å®šæŠŠä»–è®¾ç½®æˆ lazy çš„. å› ä¸º lazy åªæ˜¯æŠŠå½“å‰çš„éå†è¡Œä¸ºå»¶è¿Ÿåˆ°åé¢. å¦‚æœåé¢åå¤æ‰§è¡Œæ—¶, åè€Œå¯èƒ½è§¦å‘å¤šæ¬¡éå†, è¿˜ä¸å¦‚æŠŠè¿™ä¸ªéå†å½“å‰å°±æ¶ˆè€—æ‰.<br>ä¾‹å¦‚: å¦‚æœå¯¹äº<code>filter()</code>æ–¹æ³•, æˆ‘ä»¬æ— æ¡ä»¶çš„è¿”å›ä¸€ä¸ª lazy çš„ wrapper. é‚£ä¹ˆä¼šäº§ç”Ÿä»¤äººæƒŠè®¶çš„åæœ:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad case</span></span><br><span class="line"><span class="keyword">let</span> range = <span class="number">1</span>..&lt;<span class="number">10000</span></span><br><span class="line"><span class="keyword">let</span> array = range.myFilter(&#123; $<span class="number">0</span> % <span class="number">2</span> == <span class="number">0</span> &#125;)  <span class="comment">// å‡å¦‚è¿™ä¸ª myFilter åœ¨ O(1) é‡Œè¿”å›ä¸€ä¸ª wrapper</span></span><br><span class="line"><span class="built_in">print</span>(array.<span class="built_in">count</span>)  <span class="comment">// è§¦å‘ä¸€æ¬¡ 1..&lt;10000 çš„éå†</span></span><br><span class="line"><span class="built_in">print</span>(array.<span class="built_in">count</span>)  <span class="comment">// åˆè§¦å‘ä¸€æ¬¡ 1..&lt;10000 çš„éå†</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¾ç„¶æ˜¯æˆ‘ä»¬ä¸æƒ³çœ‹åˆ°çš„. å¯¹è¿™æ ·çš„æ–¹æ³•, æˆ‘ä»¬åº”è¯¥é»˜è®¤æŠŠä»–æŒ‰ imperative çš„æ–¹å¼å®ç°.<br>è€Œåªåœ¨<code>Self:LazySequenceProtocol</code>çš„æƒ…å½¢ä¸‹, æ‰è¿›è¡Œlazyçš„è¡Œä¸º. æ³¨æ„åˆ°è¿™ä¸ªæƒ…å†µä¸‹, å› ä¸ºè°ƒç”¨é“¾ä¸Šæ¸¸æŸå¤„æ˜¾å¼å‡ºç°äº†ä¸€æ¬¡<code>.lazy</code>, æ‰€ä»¥è¿™ä¸ªè´£ä»»å·²ç»è½¬å«åˆ°è°ƒç”¨è€…, è°ƒç”¨è€…åº”è¯¥ååˆ†æ¸…æ¥š code çš„è¡Œä¸º, å¹¶ä¸ä¼šäº§ç”Ÿ surprise.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// good case</span></span><br><span class="line"><span class="keyword">let</span> range = <span class="number">1</span>..&lt;<span class="number">10000</span></span><br><span class="line"><span class="keyword">let</span> array = range.<span class="built_in">lazy</span>.<span class="built_in">filter</span>(&#123; $<span class="number">0</span> % <span class="number">2</span> == <span class="number">0</span> &#125;) </span><br><span class="line"><span class="built_in">print</span>(array.<span class="built_in">count</span>)  <span class="comment">// è§¦å‘ä¸€æ¬¡ 1..&lt;10000 çš„éå†</span></span><br><span class="line"><span class="built_in">print</span>(array.<span class="built_in">count</span>)  <span class="comment">// åˆè§¦å‘ä¸€æ¬¡ 1..&lt;10000 çš„éå†</span></span><br></pre></td></tr></table></figure><h3 id="compiler-synthesized-conformance"><a class="markdownIt-Anchor" href="#compiler-synthesized-conformance"></a> Compiler-synthesized conformance</h3><p>ç»™æˆ‘ä»¬çš„è‡ªå®šä¹‰ç±», åœ¨æŸäº›æƒ…å†µä¸‹ç›´æ¥æ·»åŠ  protocol conformance, ä¸æä¾›å…·ä½“å®ç°, compiler ä¼šç”Ÿæˆé»˜è®¤çš„å®ç°. æ¶‰åŠåˆ°çš„ protocol æœ‰:</p><ul><li><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0166-swift-archival-serialization.md#detailed-design" target="_blank" rel="noopener">Codable</a></li><li><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0185-synthesize-equatable-hashable.md" target="_blank" rel="noopener">Equatable</a></li><li><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0206-hashable-enhancements.md#source-compatibility" target="_blank" rel="noopener">Hashable</a></li><li><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0266-synthesized-comparable-for-enumerations.md" target="_blank" rel="noopener">Comparable</a></li><li><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0194-derived-collection-of-enum-cases.md" target="_blank" rel="noopener">CaseIterable</a></li></ul><p>å„ä¸ª protocol æ”¯æŒè‡ªåŠ¨éµå¾ªçš„è‡ªå®šä¹‰ç±»å‹æœ‰ä¸ä¸€æ ·çš„è¦æ±‚:</p><ul><li><code>Comparable</code>å’Œ<code>CaseIterable</code>åªä½œç”¨äº enum.</li><li><code>Equatable</code>å’Œ<code>Hashable</code>åªä½œç”¨äº enum å’Œ struct.</li><li><code>Codable</code>åªä½œç”¨äº struct å’Œ class.</li></ul><p>è¿™äº›è‡ªå®šä¹‰éµå¾ªéƒ½æœ‰ä¸€äº›å…±åŒçš„ç‰¹ç‚¹/è¦æ±‚:</p><ul><li>è¦æ±‚ç±»å‹çš„æˆå‘˜, æŒ‰æ ‘å½¢ç»“æ„é€’å½’æ»¡è¶³éµå¾ªæ¡ä»¶. ä¾‹å¦‚:<ul><li>éµå¾ª<code>Codable</code>ç±»å‹çš„å„ä¸ªå±æ€§çš„ç±»å‹æœ¬èº«è¦éµå¾ª<code>Codable</code>.</li><li>éµå¾ª<code>Comparable</code>ç±»å‹çš„ enum, å¦‚æœæŸä¸ª case æºå¸¦äº† associated value, é‚£ä¹ˆè¯¥ value çš„ç±»å‹ä¹Ÿè¦éµå¾ª<code>Comparable</code>.</li></ul></li><li>åœ¨ä»¥å‰: å¿…é¡»æ˜¯å®šä¹‰ç±»å‹æ—¶ç«‹å³ conform æŸä¸ª protocol æ‰å¯ä»¥è§¦å‘ç¼–è¯‘å™¨è‡ªåŠ¨åˆæˆä»£ç , åœ¨ extension ä¸­ conform æ˜¯æ— æ•ˆçš„. ç°åœ¨, å…è®¸åœ¨å’Œè‡ªå®šä¹‰ç±»å‹çš„å®šä¹‰åŒä¸€ä¸ª source file ä¸‹çš„ extension ä¸­è¿›è¡Œ conform. è¿™ä¹Ÿæ˜¯ä¸ºäº†å’Œ conditional conformance è¿›è¡Œé…åˆ.</li><li>è¿™é‡Œåˆ—å‡ºçš„å„ä¸ª protocol çš„å‘½åè§„åˆ™æ˜¯ç»Ÿä¸€çš„: â€œxxx+ableâ€, â€œa&quot;å‰æ²¡æœ‰&quot;eâ€. ä½†é¡»æ³¨æ„, è¿™ä¸ªè§„åˆ™åªæ˜¯é’ˆå¯¹ä¸Šé¢åˆ—å‡ºçš„å‡ ä¸ªprotocol, STL é‡Œå½“ç„¶ä¹Ÿå­˜åœ¨æŒ‰&quot;+e+able&quot;å‘½åçš„ protocol (æ¯”å¦‚<code>Strideable</code>, ç›®å‰è¿˜æ²¡æœ‰æ”¹åŠ¨å‘½å).</li></ul><h4 id="ä¾èµ–-compiler-synthesized-ä»£ç çš„é€»è¾‘æ³¨å…¥æŠ€å·§"><a class="markdownIt-Anchor" href="#ä¾èµ–-compiler-synthesized-ä»£ç çš„é€»è¾‘æ³¨å…¥æŠ€å·§"></a> ä¾èµ– compiler-synthesized ä»£ç çš„é€»è¾‘æ³¨å…¥æŠ€å·§</h4><p>éœ€è¦æ˜ç¡®, è¿™å‡ ä¸ª protocol å¼€å‘è€…ä¸€è¡Œä»£ç ä¸å†™å°± work çš„èƒŒååŸç†, å¹¶ä¸æ˜¯å‘½ä¸­äº†ä¸€ä¸ª default å®ç°çš„çš„ protocol extension implementation, è€Œæ˜¯ç”±ç¼–è¯‘å™¨å®æ‰“å®åœ°åˆæˆäº†å®ç°ä»£ç . ç¼–è¯‘å™¨åˆæˆçš„å®ç°å’Œæˆ‘ä»¬æ‰‹åŠ¨è¾“å…¥çš„ä»£ç æœ‰ç›¸åŒåœ°ä½, ä¹Ÿä¼šå‚ä¸é‡è½½å†³è®®ç­‰ç­‰ç¼–è¯‘é˜¶æ®µ. å› æ­¤, æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹, ç»™è¿™ä¸ªçœ‹ä¼¼è¢«ç¼–è¯‘å™¨å®šæ­», è€Œæ— æ³•æ‰©å±•çš„åŠŸèƒ½, æ³¨å…¥ä¸€äº›è‡ªå®šä¹‰é€»è¾‘.</p><p>ä¾‹å¦‚: <code>Codable</code>é»˜è®¤éœ€è¦éµå¾ªè€…å®ç°<code>func hash(into hasher: inout Hasher)</code>, æˆ‘ä»¬å®ç°æ—¶éœ€è¦ä¸åœè°ƒç”¨<code>Hasher.combine()</code>. å¦‚æœè¿™ä¸ªå®ç°ç”±ç¼–è¯‘å™¨ä»£æ›¿æˆ‘ä»¬å®Œæˆ, ç¼–è¯‘å™¨å®é™…ä¸Šä¹Ÿæ˜¯åšäº†ç›¸åŒçš„å·¥ä½œ. è€Œç¼–è¯‘å™¨æ¯æ¬¡è°ƒç”¨<code>Hasher.combine()</code>å®é™…ä¸Šå’Œæˆ‘ä»¬æ‰‹åŠ¨ç¼–å†™æ—¶çš„è°ƒç”¨å®Œå…¨æ— å¼‚, æ¯ä¸€æ¬¡è°ƒç”¨éƒ½ä¼šå‚ä¸é‡è½½å†³è®®. å› æ­¤, è™½ç„¶<code>Hasher</code>æ˜¯æ ‡å‡†åº“æä¾›çš„ç±», ä½†æˆ‘ä»¬å¦‚æœç»™<code>Hasher</code>å¢åŠ å‡ ä¸ªé‡è½½æ–¹æ³•, å¹¶åœ¨æˆ‘ä»¬è‡ªå·±çš„ module ä¸­è®¾æ³•ä½¿è¿™å‡ ä¸ªé‡è½½æ–¹æ³•è¢«å‘½ä¸­, é‚£å°±ç›¸å½“äºç»•è¿‡äº†æ ‡å‡†åº“çš„å®ç°.</p><p>ä¸‹é¢çš„ä»£ç , å±•ç¤ºäº†è¿™æ ·ä¸€ä¸ªåŠŸèƒ½: æˆ‘ä»¬æƒ³çœ‹çœ‹, æˆ‘ä»¬çš„ module ä¸­æ‰€æœ‰<code>Optional&lt;Int&gt;</code>è¢« hash çš„æ¬¡æ•°.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Model</span>: <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a: <span class="type">Int?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Hasher</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ç»™æ ‡å‡†åº“ç±»å‹å¢åŠ çš„ extension, è¿™ä¸ªæ–¹æ³•æ¯” Hasher å·²æœ‰çš„2ä¸ªæ–¹æ³•æ›´åŠ é™å®š, å› æ­¤å‘½ä¸­æ—¶ä¼˜å…ˆçº§æ›´é«˜</span></span><br><span class="line">  <span class="comment">// å®é™…ä¸Š, ç¼–è¯‘å™¨ç»™ Model ç”Ÿæˆçš„ Hashable å®ç°ä»£ç é‡Œ, å°±ä¼šå‘½ä¸­è¿™ä¸ª combine, è€Œé Hasher è‡ªå¸¦çš„ combine</span></span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">combine</span><span class="params">(<span class="number">_</span> value: Int?)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"we are hashing an optional int here!!!"</span>)</span><br><span class="line">    combine(<span class="type">AnyHashable</span>(value))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨2ä¸ª Model ç±»å‹çš„ key, åˆ›å»º Dictionary</span></span><br><span class="line"><span class="keyword">let</span> dict = [</span><br><span class="line">  <span class="type">Model</span>(a: <span class="number">3</span>): <span class="number">3</span>,</span><br><span class="line">  <span class="type">Model</span>(a: <span class="number">4</span>): <span class="number">4</span></span><br><span class="line">]</span><br><span class="line"><span class="comment">// console output:</span></span><br><span class="line"><span class="comment">// we are hashing an optional int here!!!</span></span><br><span class="line"><span class="comment">// we are hashing an optional int here!!!</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶è¿™é‡Œçš„ä¾‹å­æ¯”è¾ƒç®€å•, å¯¹äºæ¯”è¾ƒå¤æ‚çš„ç¼–è¯‘å™¨æ”¯æŒç”Ÿæˆå®ç°ä»£ç çš„ protocol, ä¾‹å¦‚<code>Encodable/Decodable</code>, å¯ä»¥æœ‰æ›´èŠ±å¼çš„åšæ³•. ä¾‹å¦‚<a href="http://davelyon.net/2017/08/16/jsondecoder-in-the-real-world" target="_blank" rel="noopener">è¿™è¾¹çš„ä¾‹å­</a>, å°±æ˜¯é€šè¿‡å¢åŠ ä¼˜å…ˆçº§é«˜çš„é‡è½½æ–¹æ³•, æ¥å¢å¼ºç°æœ‰<code>Codable</code>çš„è‡ªå®šä¹‰èƒ½åŠ›.</p><h2 id="tricks-patterns"><a class="markdownIt-Anchor" href="#tricks-patterns"></a> Tricks &amp; Patterns</h2><h3 id="implementing-ghost-operator"><a class="markdownIt-Anchor" href="#implementing-ghost-operator"></a> Implementing â€œghost operatorâ€</h3><h4 id="é—®é¢˜èƒŒæ™¯"><a class="markdownIt-Anchor" href="#é—®é¢˜èƒŒæ™¯"></a> é—®é¢˜èƒŒæ™¯</h4><p>åœ¨ Swift Standard Library ä¸­æŸäº› Collection å®ç°äº†ä¸€ç§ subscript, æ¥å—çš„å®å‚æ˜¯<code>...</code>, ç”Ÿæˆä¸€ä¸ªæ¶µç›–æ•´ä¸ª collection èŒƒå›´çš„<code>SubSequence</code>.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="comment">// sub çš„ç±»å‹æ˜¯ ArraySlice</span></span><br><span class="line"><span class="keyword">let</span> sub = array[...]</span><br></pre></td></tr></table></figure><p>å½“ç„¶<code>...</code>åœ¨ç°æœ‰çš„ Swift æ ‡è¯†ç¬¦è§„åˆ™ä¸‹, åªèƒ½æ˜¯ä¸€ä¸ª operator, ä¸å¯èƒ½æ˜¯ä¸€ä¸ªå¸¸é‡/å˜é‡. å› æ­¤æ˜¾ç„¶è¿™ä¸ª subscript çš„å…¥å‚ç±»å‹æ˜¯ä¸€ä¸ª function type.</p><h4 id="é—®é¢˜ç›®æ ‡"><a class="markdownIt-Anchor" href="#é—®é¢˜ç›®æ ‡"></a> é—®é¢˜ç›®æ ‡</h4><p>æˆ‘ä»¬è€ƒè™‘æ›´ä¸€èˆ¬çš„æƒ…å†µ, å‡è®¾æˆ‘ä»¬æƒ³è¦å®ç°è¿™æ ·ä¸€ä¸ª subscript.</p> <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Special</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ç±»å‹æš‚æ—¶ä¸ç¡®å®šçš„ä¸€ä¸ªsubscript</span></span><br><span class="line">  <span class="keyword">subscript</span>(<span class="comment">/*SpecialOpearator*/</span>) -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"SpecialOpearator called"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æƒ³è¦èƒ½è¢«å¦‚æ­¤ä½¿ç”¨</span></span><br><span class="line"><span class="type">Special</span>()[...]</span><br></pre></td></tr></table></figure><p>ä¸ºäº†èƒ½æ–¹ä¾¿çš„ä½¿ç”¨, æˆ‘ä»¬çš„å®ç°éœ€è¦ä¿è¯ä»¥ä¸‹å‡ ç‚¹:</p><ul><li><code>[...]</code>è¿™ä¸ª subscript è°ƒç”¨å¯ä»¥å®Œç¾è§£æ, ä¸ä¼šå‡ºç°æ‰¾ä¸åˆ° subscript æ–¹æ³•, æˆ–è€…å‡ºç°äºŒä¹‰æ€§.</li><li>åœ¨å®ç°è¿‡ç¨‹ä¸­, æš´éœ²å‡ºæ¥çš„æ— å…³æ¥å£è¶Šå°‘è¶Šå¥½.</li><li>è¿™ä¸ª operator åªèƒ½æ˜¯ç”¨åœ¨æˆ‘ä»¬è¿™ä¸ª subscript ä¸­, ä»»ä½•å…¶ä»–æ–¹å¼éƒ½ä¸èƒ½è¢«è°ƒç”¨, å¦‚æœç”¨æˆ·ç”¨<code>...</code>æ—¶éƒ½æ„è¯†ä¸åˆ°è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ operator, ä¼¼ä¹åªæ˜¯ä¸€ä¸ª magical special identifier, é‚£å°±æ›´å¥½ä¸è¿‡äº†.</li></ul><h4 id="å®ç°"><a class="markdownIt-Anchor" href="#å®ç°"></a> å®ç°</h4><p>(1) ä½¿ç”¨ case-less enum å»ºç«‹ä¸€ä¸ªå±€éƒ¨ä½œç”¨åŸŸ, å¹¶æ·»åŠ ä¸€ä¸ªæ— å®ç°çš„ operator æ–¹æ³•</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">_ThreeDot</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">postfix</span> <span class="function"><span class="keyword">func</span> ... <span class="params">(rhs: _ThreeDot)</span></span> &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(2) ä½¿ç”¨ä¸Šè¿° operator æ–¹æ³•çš„ç­¾åä½œä¸ºå…¥å‚ç±»å‹, å®šä¹‰æˆ‘ä»¬æƒ³è¦çš„ subscript</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">ThreeDot</span> = (_ThreeDot) -&gt; <span class="type">Void</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Special</span> </span>&#123;</span><br><span class="line">  <span class="keyword">subscript</span>(<span class="number">_</span> op: <span class="type">ThreeDot</span>) -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"SpecialOpearator called"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å°±å¯ä»¥æŒ‰æƒ³è¦çš„æ–¹å¼è°ƒç”¨<code>Special()[...]</code>.</p><p>å®ç°è¿‡ç¨‹ä¸­çš„è¦ç‚¹ä¸»è¦æœ‰:</p><ul><li>æˆ‘ä»¬æŒ‰æ ‡å‡†çš„ Swift custom operator çš„å®šä¹‰æ–¹æ³•, å°†æ–¹æ³•å®šä¹‰åœ¨ä¸€ä¸ªå®¿ä¸» enum é‡Œ, å¹¶ä¸”ä½¿è¿™ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ªå®¿ä¸»ç±»å‹çš„å‚æ•°, å¯ä»¥æœ‰æ•ˆé¿å…<code>...</code> operator å’Œç›¸åŒä½œç”¨åŸŸå†…å…¶ä»–åŒå operator çš„å†²çª.</li><li>æˆ‘ä»¬å®šä¹‰çš„ enum, æ˜¯ non-inhabitant type, åªèµ·åˆ°å‘½åç©ºé—´çš„ä½œç”¨. å¹¶ä¸”ç”±äºåœ¨ä»£ç ä¸­çš„ä»»ä½•åœ°æ–¹éƒ½ä¸å¯èƒ½å»ºç«‹ä¸€ä¸ªè¿™ä¸ª enum ç±»å‹çš„å®ä¾‹. æ‰€ä»¥<code>...</code>æ°¸è¿œä¸å¯èƒ½è¢«çœŸæ­£è°ƒç”¨åˆ°: è°ƒç”¨éœ€è¦çš„å®å‚æ°¸è¿œä¸å¯èƒ½è¢«å®ä¾‹åŒ–å‡ºæ¥å˜›. è¿™ä¸ª operator åªèƒ½&quot;ç›¸å½“&quot;äºä¸€ä¸ª identifier è¢«å¼•ç”¨, è€Œä¸ä¼šè¢«è°ƒç”¨.</li></ul><p>å¯ä»¥çœ‹åˆ°, è¿™ä¸ªæŠ€å·§ä¸é™äº Swift å·²ç»å®šä¹‰çš„<code>...</code>, å¯ä»¥ç”¨åœ¨ä»»ä½•å…¶ä»–åå­—çš„è‡ªå®šä¹‰ operator; å¼•ç”¨åœ°ç‚¹ä¹Ÿä¸ä¸€å®šéå¾—æ˜¯ subscript, ä»»ä½• function/method ä¸­éƒ½æ˜¯å¯ä»¥çš„.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;ul class=&quot;markdownIt-TOC&quot;&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%A0%87%E5%87%86%E5%BA%93%E6%8B%BE%E9%81%97&quot;&gt;æ ‡å‡†åº“æ‹¾é—&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#string%E5%92%8C%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2&quot;&gt;&lt;code&gt;String&lt;/code&gt;å’Œå…¶ä»–ç±»å‹ä¹‹é—´çš„è½¬æ¢&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#comparisons&quot;&gt;Comparisons&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#lazy-or-not&quot;&gt;Lazy or not&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#compiler-synthesized-conformance&quot;&gt;Compiler-synthesized conformance&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E4%BE%9D%E8%B5%96-compiler-synthesized-%E4%BB%A3%E7%A0%81%E7%9A%84%E9%80%BB%E8%BE%91%E6%B3%A8%E5%85%A5%E6%8A%80%E5%B7%A7&quot;&gt;ä¾èµ– compiler-synthesized ä»£ç çš„é€»è¾‘æ³¨å…¥æŠ€å·§&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#tricks-patterns&quot;&gt;Tricks &amp;amp; Patterns&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#implementing-ghost-operator&quot;&gt;Implementing â€œghost operatorâ€&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E9%97%AE%E9%A2%98%E8%83%8C%E6%99%AF&quot;&gt;é—®é¢˜èƒŒæ™¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E9%97%AE%E9%A2%98%E7%9B%AE%E6%A0%87&quot;&gt;é—®é¢˜ç›®æ ‡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%AE%9E%E7%8E%B0&quot;&gt;å®ç°&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä¸‹æ–‡éƒ¨åˆ†å†…å®¹æˆäº2018å¹´&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æœ¬æ–‡ç»§ç»­ä¸Šä¸€ç¯‡&lt;a href=&quot;/2020/swift-practices-perls-1/&quot;&gt;Swift Practices &amp;amp; Perls (1)&lt;/a&gt;, è®°å½•æ ‡å‡†åº“å­¦ä¹ è¿‡ç¨‹ä¸­çš„æŠ€å·§.&lt;/p&gt;
&lt;h2 id=&quot;æ ‡å‡†åº“æ‹¾é—&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#æ ‡å‡†åº“æ‹¾é—&quot;&gt;&lt;/a&gt; æ ‡å‡†åº“æ‹¾é—&lt;/h2&gt;
&lt;p&gt;Swift æ ‡å‡†åº“æä¾›çš„ API å¼ºå¤§è€Œä¼˜é›…. è¿™é‡Œå½’çº³æ€»ç»“äº†ä¸€äº›ç½‘ä¸Šä¸å¸¸è§çš„ç‚¹.&lt;/p&gt;
&lt;h3 id=&quot;stringå’Œå…¶ä»–ç±»å‹ä¹‹é—´çš„è½¬æ¢&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#stringå’Œå…¶ä»–ç±»å‹ä¹‹é—´çš„è½¬æ¢&quot;&gt;&lt;/a&gt; &lt;code&gt;String&lt;/code&gt;å’Œå…¶ä»–ç±»å‹ä¹‹é—´çš„è½¬æ¢&lt;/h3&gt;
&lt;p&gt;ä¸€æ–¹é¢, æ ‡å‡†åº“ä¸­å­˜åœ¨å¤šä¸ª protocol, æ¥å…³è”è‡ªå®šä¹‰ç±»å‹å’Œ&lt;code&gt;String&lt;/code&gt;. é€šå¸¸, åœ¨éœ€è¦æŒ‰æ–‡æœ¬æ ¼å¼æ‰“å°æŸä¸ªå¯¹è±¡, æˆ–æ¶‰åŠåˆ°ç”¨æ–‡æœ¬è¿›è¡Œåºåˆ—åŒ–/ååºåˆ—åŒ–æ—¶, å¯èƒ½ä¼šä½¿ç”¨åˆ°è¿™äº› protocol.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ExpressibleByStringLiteral&lt;/code&gt; (æ—§å&lt;code&gt;StringLiteralConvertible&lt;/code&gt;). éµå¾ªè¯¥ protocol çš„ç±»å‹, æ”¯æŒä½¿ç”¨ string literal åˆå§‹åŒ–.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CustomStringConvertible&lt;/code&gt;å’Œ&lt;code&gt;CustomDebugStringConvertible&lt;/code&gt;. æ”¯æŒæœ€åŸºæœ¬çš„è¾“å‡ºåˆ°ä¸€ä¸ª&lt;code&gt;String&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;LosslessStringConvertible&lt;/code&gt;. è¯¥ protocol ç»§æ‰¿è‡ª &lt;code&gt;CustomStringConvertible&lt;/code&gt;. ä¸åè€…ä¸åŒçš„æ˜¯, è¯¥ protocol çš„éµå¾ªè€…å¿…é¡»æä¾›å’Œ&lt;code&gt;String&lt;/code&gt;ä¹‹é—´åŒå‘çš„ç²¾ç¡®è½¬åŒ–. å› æ­¤æŸç§æ„ä¹‰ä¸Šè¯´, éµå¾ªæœ¬ protocol çš„ç±»å‹è½¬åŒ–æˆçš„&lt;code&gt;String&lt;/code&gt;å¯ç”¨èŒƒå›´æ›´å¹¿, ä¸é™äº debug/print. å› ä¸ºä¸ç”¨æ‹…å¿ƒ2ä¸ªä¸åŒçš„å¯¹è±¡å¯¹åº”åˆ°åŒä¸€ä¸ª&lt;code&gt;String&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TextOutputStreamable&lt;/code&gt;. æ”¯æŒæŒ‰æµå¼å¢é‡æ·»åŠ åˆ°å·²æœ‰çš„ stream çš„æœ«å°¾. å› ä¸ºæ”¯æŒå¢é‡æ·»åŠ , æ‰€ä»¥éµå¾ªè€…å®é™…å®ç°æ—¶, å¯èƒ½å’Œå…¶ä»–è¾“å‡º&lt;code&gt;String&lt;/code&gt;çš„ protocol ç›¸æ¯”, å†…å­˜å ç”¨ä¸Šå¯ä»¥æœ‰ä¸€äº›ä¼˜åŒ–.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢, &lt;code&gt;String&lt;/code&gt;æœ¬èº«ä¹Ÿå­˜åœ¨å¥½å‡ ç§ initializer. æ ‡å‡†åº“å»ºè®®æˆ‘ä»¬ä½¿ç”¨&lt;code&gt;String&lt;/code&gt;çš„å„ç§åˆå§‹åŒ–æ–¹æ³•, è€Œä¸è¦ç›´æ¥è°ƒç”¨ä¸Šé¢å„ä¸ª protocol å®šä¹‰çš„æ–¹æ³•.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;init&amp;lt;T&amp;gt;(_ value: T, radix: Int = default, uppercase: Bool = default)&lt;/code&gt;. æŠŠ&lt;code&gt;Int&lt;/code&gt;æŒ‰æŸä¸ªè¿›åˆ¶è½¬æ¢æˆ&lt;code&gt;String&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;init&amp;lt;T&amp;gt;(_ value: T) where T : LosslessStringConvertible&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;init&amp;lt;Subject&amp;gt;(describing: Subject)&lt;/code&gt;. ä¼˜å…ˆä½¿ç”¨&lt;code&gt;TextOutputStreamable&lt;/code&gt;çš„å®ç°, æœ€åä½¿ç”¨&lt;code&gt;CustomDebugStringConvertible&lt;/code&gt;çš„å®ç°, åå‘ç²¾å‡†æ€§.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;init&amp;lt;Subject&amp;gt;(reflecting: Subject)&lt;/code&gt;. ä¼˜å…ˆä½¿ç”¨&lt;code&gt;CustomDebugStringConvertible&lt;/code&gt;, æœ€åä½¿ç”¨&lt;code&gt;TextOutputStreamable&lt;/code&gt;, åå‘debug.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;comparisons&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#comparisons&quot;&gt;&lt;/a&gt; Comparisons&lt;/h3&gt;
&lt;p&gt;åœ¨STLä¸­, å¹¶éæ‰€æœ‰å¯æ¯”çš„å¯¹è±¡éƒ½ç›´æ¥éµå¾ª&lt;code&gt;Comparable&lt;/code&gt;, ä½†ä¸€å®šè¦æ±‚æœ€ç»ˆçš„åº•å±‚ element å¯¹è±¡æ˜¯éµå¾ªçš„.&lt;br&gt;
å¯¹äºä¸ç›´æ¥éµå¾ª&lt;code&gt;Comparable&lt;/code&gt;çš„ç±»å‹æ¥è¯´, ä»–ä»¬æ¯”è¾ƒå„è‡ªå¯¹è±¡çš„æ–¹å¼æ— å¤–ä¹é€šè¿‡ operator æˆ– method.&lt;/p&gt;</summary>
    
    
    
    <category term="Swift" scheme="https://crystdragon.github.io/categories/swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Image Orientation</title>
    <link href="https://crystdragon.github.io/2020/Image-Orientation/"/>
    <id>https://crystdragon.github.io/2020/Image-Orientation/</id>
    <published>2020-07-27T16:00:00.000Z</published>
    <updated>2020-07-30T17:05:03.535Z</updated>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#%E8%83%8C%E6%99%AF">èƒŒæ™¯</a><ul><li><a href="#%E4%BC%A0%E7%BB%9F%E7%9B%B8%E6%9C%BA">ä¼ ç»Ÿç›¸æœº</a></li><li><a href="#dslr">DSLR</a></li></ul></li><li><a href="#%E5%AF%B9%E5%9B%BE%E5%83%8F%E7%AE%97%E6%B3%95%E7%9A%84%E5%BD%B1%E5%93%8D">å¯¹å›¾åƒç®—æ³•çš„å½±å“</a></li><li><a href="#orientation-tag-%E7%9A%84%E8%A1%A8%E7%A4%BA">Orientation tag çš„è¡¨ç¤º</a><ul><li><a href="#raw-exif-%E4%BF%A1%E6%81%AF">Raw exif ä¿¡æ¯</a><ul><li><a href="#apple-api">Apple API</a></li></ul></li><li><a href="#uiimage%E7%9B%B8%E5%85%B3-api"><code>UIImage</code>ç›¸å…³ API</a></li></ul></li><li><a href="#%E4%BD%BF%E7%94%A8-uikit-%E8%8E%B7%E5%8F%96uiimage%E6%97%B6-%E7%B3%BB%E7%BB%9F%E5%AF%B9imageorientation%E7%9A%84%E5%A1%AB%E5%85%85%E6%96%B9%E5%BC%8F">ä½¿ç”¨ UIKit è·å–<code>UIImage</code>æ—¶, ç³»ç»Ÿå¯¹<code>imageOrientation</code>çš„å¡«å……æ–¹å¼</a><ul><li><a href="#%E5%9F%BA%E6%9C%AC%E7%9B%B8%E5%AF%B9%E5%85%B3%E7%B3%BB">åŸºæœ¬ç›¸å¯¹å…³ç³»</a></li><li><a href="#%E5%90%8E%E7%BD%AE%E6%91%84%E5%83%8F%E5%A4%B4">åç½®æ‘„åƒå¤´</a></li><li><a href="#%E5%89%8D%E7%BD%AE%E6%91%84%E5%83%8F%E5%A4%B4">å‰ç½®æ‘„åƒå¤´</a></li></ul></li><li><a href="#case-face-detection-%E4%B8%AD%E7%9A%84%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2">Case: Face Detection ä¸­çš„åæ ‡å˜æ¢</a></li></ul></p><hr><p>åŸæ–‡æˆäº2018å¹´12æœˆ</p><hr><h2 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h2><p>ä¸ºä»€ä¹ˆå­˜åœ¨ Image Orientation</p><h3 id="ä¼ ç»Ÿç›¸æœº"><a class="markdownIt-Anchor" href="#ä¼ ç»Ÿç›¸æœº"></a> ä¼ ç»Ÿç›¸æœº</h3><ul><li>ä¼ ç»Ÿç›¸æœºæ¨ªå‘æ‹æ‘„, èƒ¶å·å’Œç…§ç‰‡ä¹ŸæŒ‰æ¨ªå‘æ–¹ä½å›ºå®šå°ºå¯¸.</li><li>æ‹ç«–ç›´æ–¹å‘çš„æ™¯çš„æ—¶å€™, æ‘„å½±å¸ˆæŠŠç›¸æœºæ—‹è½¬90åº¦, æ‹åˆ°çš„åŸå§‹ç…§ç‰‡æ˜¯æ¨ªå‘çš„.</li><li>è¦æ­£ç¡®è¿˜åŸç°åœºçš„æƒ…å†µ, éœ€è¦æ‰‹åŠ¨æŠŠç…§ç‰‡æ—‹è½¬90åº¦.</li></ul><h3 id="dslr"><a class="markdownIt-Anchor" href="#dslr"></a> DSLR</h3><ul><li>ç”¨æˆ·çš„æŒç›¸æœºæ–¹å¼å’Œéœ€æ±‚æ²¡æœ‰æœ¬è´¨å˜åŒ–.</li><li>ä»ç„¶éœ€è¦å¤–éƒ¨é¢å¤–ä¿¡æ¯æ¥å¸®åŠ©ç¡®å®šæ€ä¹ˆæ—‹è½¬æ‹å¾—çš„å›¾åƒ.<ul><li>ç”¨æˆ·ä½¿ç”¨ç›¸æœºä¸Šçš„ UI, æ‰‹åŠ¨è¾“å…¥æ—‹è½¬ä¿¡æ¯.</li><li>æ ¹æ®ç¡¬ä»¶çš„é‡åŠ›åŠ é€Ÿè®¡è‡ªåŠ¨ç¡®å®šæ–¹å‘.</li></ul></li><li>åŸºäºæ€§èƒ½å’Œæ•ˆç‡åŸå› , å¹¶ä¸ä¼šæŠŠ raw data è¿›è¡Œæ—‹è½¬ç”Ÿæˆä¸€å¼ æ–°å›¾ç‰‡, è€Œæ˜¯åŠ ä¸Šä¸€ä¸ª tag, è¿™ä¸ª tag å°±è¡¨ç¤º image orientation.</li><li>å„ç«¯æ˜¾ç¤ºè¿™æ ·çš„å›¾ç‰‡æ—¶, éœ€è¦è¯»å–è¿™ä¸ª tag, å¹¶åœ¨æ¸²æŸ“æ—¶ç»™ raw data åŠ ä¸Šä¸€ä¸ª transform.</li></ul><h2 id="å¯¹å›¾åƒç®—æ³•çš„å½±å“"><a class="markdownIt-Anchor" href="#å¯¹å›¾åƒç®—æ³•çš„å½±å“"></a> å¯¹å›¾åƒç®—æ³•çš„å½±å“</h2><p>å½“å¯¹æŸä¸ªå›¾åƒæ‰§è¡ŒæŸäº›ç®—æ³•æ—¶, é™¤äº†å¿…è¦çš„å›¾åƒ data ä¿¡æ¯, è¿˜å¯èƒ½éœ€è¦å·²çŸ¥çš„ orientation ä¿¡æ¯. ä¾‹å¦‚å¾ˆå¤šäººè„¸æ£€æµ‹ç®—æ³•, åœ¨æœ‰å…ˆéªŒçš„ orientation çŸ¥è¯†æ—¶, é€šå¸¸èƒ½æœ‰æ›´å¥½çš„æ•ˆæœ. ä¾‹å¦‚, Apple çš„ CoreImage æ”¯æŒäººè„¸æ£€æµ‹, <a href="https://developer.apple.com/documentation/coreimage/cidetectorimageorientation" target="_blank" rel="noopener">å…¶ API æ¥å— orientation å‚æ•°</a>.</p><a id="more"></a><p>ä½†éœ€è¦æ³¨æ„, è¿™ä¸ª orientation æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª Int å€¼. ä½†æŸä¸ª orientation å€¼å¯¹åº”çš„æ ‡è¯†ç¬¦åç§°, åœ¨ä¸åŒçš„ API ä¸‹, å¯èƒ½å¯¹åº”ä¸åŒçš„å«ä¹‰. é€šå¸¸æœ‰ä¸¤ç§å¯èƒ½æ€§:</p><ul><li>æŠŠ raw data å˜æ¢æˆè‡ªç„¶æ–¹ä½çš„å›¾åƒæ—¶, åº”è¯¥è¿›è¡Œçš„æ—‹è½¬</li><li>è‡ªç„¶çš„å›¾åƒåœ¨ä¿å­˜æˆ raw data æ—¶, æ‰§è¡Œçš„æ—‹è½¬; æˆ–è€…è¯´æˆ raw data ç›¸å¯¹äºè‡ªç„¶æ–¹ä½æ‰€è¿›è¡Œçš„æ—‹è½¬</li></ul><p>åœ¨æˆ‘ä¸ªäººæ¥è§¦åˆ°çš„å¤§éƒ¨åˆ† API ä¸­, è¿™é‡Œçš„ orientation, ä¸€èˆ¬è¡¨ç¤ºå‰è€….</p><h2 id="orientation-tag-çš„è¡¨ç¤º"><a class="markdownIt-Anchor" href="#orientation-tag-çš„è¡¨ç¤º"></a> Orientation tag çš„è¡¨ç¤º</h2><h3 id="raw-exif-ä¿¡æ¯"><a class="markdownIt-Anchor" href="#raw-exif-ä¿¡æ¯"></a> Raw exif ä¿¡æ¯</h3><p>ä»»æ„æ¥è‡ªç¬¬ä¸‰æ–¹ç›¸æœºæˆ–æ‰‹æœºæ‹æ‘„çš„å›¾åƒæ–‡ä»¶, <a href="http://jpegclub.org/exif_orientation.html" target="_blank" rel="noopener">orientation å­˜å‚¨åœ¨ exif ä¿¡æ¯ä¸­</a>. å…±æœ‰8ä¸ªå¯èƒ½çš„å–å€¼.</p><table><thead><tr><th style="text-align:left">Value</th><th style="text-align:left">0th Row</th><th style="text-align:left">0th Column</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left">top</td><td style="text-align:left">left</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left">top</td><td style="text-align:left">right</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left">bottom</td><td style="text-align:left">right</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left">bottom</td><td style="text-align:left">left</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left">left</td><td style="text-align:left">top</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left">right</td><td style="text-align:left">top</td></tr><tr><td style="text-align:left">7</td><td style="text-align:left">right</td><td style="text-align:left">bottom</td></tr><tr><td style="text-align:left">8</td><td style="text-align:left">left</td><td style="text-align:left">bottom</td></tr></tbody></table><p>ä¸‹å›¾è¡¨è¿°çš„æ˜¯: å‡è®¾æ‹æ‘„å¯¹è±¡è‡ªç„¶æˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span></span></span></span> å›¾åƒæ—¶, æ¯ä¸€ç§ orientation ä¸‹, å­˜å‚¨åœ¨ raw data ä¸­çš„å›¾åƒå§¿æ€.</p><p><img src="/2020/Image-Orientation/exif_orientation.png" alt="exif orientation"></p><p>å¯¹è¡¨ä¸­çš„æ¯ä¸€è¡Œæœ‰ä¸¤ç§ç­‰ä»·çš„è§£é‡Š:</p><ul><li>raw dataä¸­, 0th row, 0th column, å¯¹åº”åˆç†çš„çœŸå®åœºæ™¯ä¸­çš„å“ªæ¡è¾¹.</li><li>æŠŠ raw data é€šè¿‡ transform è¿˜åŸå,  0th row, 0th column è¢«å˜æ¢åˆ°å“ªä¸ªä½ç½®.</li></ul><p>ä¾‹å¦‚: å½“ orientation æ˜¯5æ—¶, å¯ä»¥å‘ç°, raw data ä¸­ç¬¬0è¡Œçš„ data, å¯¹åº” <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span></span></span></span> å·¦è¾¹çš„ä¸€ç«–, å³åº”è¯¥å˜æ¢åˆ° left; raw data ä¸­ç¬¬0åˆ—çš„ data, å¯¹åº” <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span></span></span></span> é¡¶ä¸Šçš„ä¸€è¡Œ, å³åº”è¯¥å˜æ¢åˆ° top.</p><h4 id="apple-api"><a class="markdownIt-Anchor" href="#apple-api"></a> Apple API</h4><ul><li>åœ¨ Apple å¹³å°ä¸Š, ä½¿ç”¨ ImageIO è¿™ä¸ª framework, é€šè¿‡<code>URL</code>/file data ç›´æ¥è¯»å–, å¯ä»¥åœ¨<code>kCGImagePropertyOrientation</code>è¿™ä¸ª property key çš„ä½ç½®ç›´æ¥è¯»å–åˆ° tag.</li><li>è¿™ä¸ªå€¼å¯ä»¥ç›´æ¥è¾“å…¥è®¸å¤šç®—æ³•, ä¾‹å¦‚ä¸Šè¿° face detection filter.</li></ul><h3 id="uiimageç›¸å…³-api"><a class="markdownIt-Anchor" href="#uiimageç›¸å…³-api"></a> <code>UIImage</code>ç›¸å…³ API</h3><ul><li><code>UIImage</code>æ˜¯<code>NSImage</code>çš„ç®€åŒ–ç‰ˆ, æœ¬èº«ä¸åŒ…å«ä»»ä½• meta data, å½“ç„¶æ²¡æœ‰ exif ä¿¡æ¯.<ul><li><code>UIImage</code>é™¤äº†åŒ…å« raw data å¤–, é€šè¿‡ä¸€ä¸ªé¢å¤–çš„<code>imageOrientation</code>å±æ€§æ¥ä¿å­˜ç­‰ä»·çš„ orientation ä¿¡æ¯.</li><li>ä»<code>UIImagePickerController</code>ç”Ÿæˆ<code>UIImage</code>æ—¶, framework å·²ç»å¡«å……å¥½<code>imageOrientation</code>.</li><li>é€šè¿‡ AVFoundation çš„<code>AVCaptureOutput</code>è¿”å› data æ—¶, è¿”å›çš„ pixel buffer æ²¡æœ‰ä»»ä½• orientation çš„ä¿¡æ¯. éœ€è¦æ‰‹åŠ¨ç»„è£…:<ul><li>å¯ä»¥é€šè¿‡å½“å‰ç³»ç»Ÿçš„ç¡¬ä»¶æƒ…å†µ.</li><li>æˆ–è€…è¯»å–ç”± output éš buffer è¿”å›çš„ <code>metadata</code>.</li><li>æˆ–è€…é€šè¿‡<code>captureConnection</code>çš„<code>videoOrientation</code>æ¥ map åˆ°ä¸€ä¸ª<code>imageOrientation</code>.</li><li><code>isVideoMirrored</code>æ˜¯å¦ä¼šå½±å“è·å–åˆ°çš„å€¼, <em>éœ€è¦é¢å¤–éªŒè¯ä¸‹</em>.</li></ul></li></ul></li><li><code>UIImage.Orientation</code>çš„å®šä¹‰: ä¸€ä¸ªenum, æ¯ä¸ª case çš„åç§°å…¶å®éå¸¸å¥½ç†è§£, ä»–è¡¨ç¤ºçš„å°±æ˜¯ raw data <em>åº”è¯¥</em>å¦‚ä½•æ—‹è½¬/transform æ¥è¿˜åŸåˆ°çœŸå®çš„è‡ªç„¶åœºæ™¯. é‡åˆ°æ ‡è¯†ç¬¦å¸¦<code>Mirrored</code>çš„, æ„æ€æ˜¯æŠŠ raw data å…ˆæŒ‰å½“å‰æœªæ—‹è½¬æ—¶çš„ y è½´å·¦å³é•œåƒ, å†æ—‹è½¬ (æˆ–è€…å…ˆæ—‹è½¬, å†æŒ‰è½¬å®Œåçš„ local y è½´è¿›è¡Œ mirror. ä¸¤è€…æ˜¯ä¸€ä¸ªæ„æ€)<ul><li>ä¾‹å¦‚, <code>UIImage.Orientation.right</code>è¡¨ç¤ºçš„å°±æ˜¯: æŠŠ raw data æœå³è½¬90åº¦(é¡ºæ—¶é’ˆ90åº¦), å°±å¯ä»¥è¿˜åŸåˆ°è‡ªç„¶çŠ¶æ€.</li><li>åˆå¦‚, <code>UIImage.Orientation.rightMirrored</code>è¡¨ç¤ºçš„å°±æ˜¯, å…ˆæŠŠ raw data å·¦å³ç¿»è½¬, å†æœå³è½¬90åº¦, å°±å¯ä»¥è¿˜åŸåˆ°è‡ªç„¶çŠ¶æ€.</li></ul></li><li><code>UIImage.Orientation</code>çš„ä½¿ç”¨<ul><li><code>UIImage</code>çš„<code>cgImage</code>å’Œ<code>UIImagePNGRepresentation</code>ç”Ÿæˆçš„ data, éƒ½å®Œå…¨ä¸åŒ…å« orientation, å› æ­¤é‡åˆ°<code>UIImage</code>ç›´æ¥è¿›è¡Œæ“ä½œ/å­˜å‚¨æ—¶, å°±ç­‰äºåªæ˜¯ç”¨/ä¿å­˜äº† raw data, è€ŒéçŸ«æ­£è¿‡æœå‘çš„å›¾ç‰‡.</li><li><code>UIImage</code>çš„å„ä¸ª<code>draw</code>æ–¹æ³•, å·²ç»è‡ªåŠ¨è€ƒè™‘å…¶<code>imageOrientation</code>.</li><li>æ‰‹åŠ¨æ“çºµ<code>cgImage</code>çš„ data ç»˜åˆ¶æ—¶<ul><li>æ¶‰åŠåˆ°<code>CGContext</code>ç»˜åˆ¶çš„åœºåˆ, éœ€è¦ä½¿ç”¨<code>imageOrientation</code>å¯¹ context è¿›è¡Œ transform å†è¿›è¡Œç»˜åˆ¶, æˆ–å…ˆç”Ÿæˆä¸€å¼ å·²çŸ«æ­£è¿‡çš„ä¸´æ—¶ image.</li><li>å¦‚æœéœ€è¦ä¼ å…¥ç»™éœ€è¦ exif orientation tag çš„ç®—æ³•, åˆ™åº”å½“æŠŠ<code>imageOrientation</code>è½¬æˆ exif çš„ tag.</li><li><code>imageOrientation</code>å’Œ<code>kCGImagePropertyOrientation</code>çš„è½¬åŒ–å¯¹åº”å…³ç³», å¯ä»¥æ ¹æ® exif specification æ‰‹åŠ¨è½¬æ¢ rawValue, ä¹Ÿå¯ä»¥ç”¨ Apple å®šä¹‰çš„ enum ç›´æ¥è¿›è¡ŒåŒå case çš„æ˜ å°„ (ä¾‹å¦‚<code>Image.Orientation.right</code>å¯¹åº”<code>CGImagePropertyOrientation.right</code>), ä¸¤è€…å…¶å®æ˜¯ä¸€å›äº‹.</li></ul></li></ul></li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯, iOS æœ‰äº›æ—¶å€™, ä¾‹å¦‚æŠŠå¸¦ exif orientation tag çš„<code>CGImageDestination</code>å­˜å‚¨åˆ°æŸä¸ª file path æ—¶, ä¼¼ä¹ä¼šæŠŠå¯¹åº”çš„ orientation ä¿¡æ¯æ¶ˆè€—æ‰, æœ€ç»ˆå­˜å‚¨çš„æ˜¯å·²ç»æ—‹è½¬è¿‡çš„å›¾ç‰‡. ä¹‹æ‰€ä»¥è¿™ä¹ˆåš, æˆ‘æƒ³åº”è¯¥æ˜¯ç³»ç»Ÿä¸ºå°†æ¥æ“ä½œè¿›è¡Œçš„ä¸€ç§ç®€åŒ–. å†è¯»å–è¯¥æ–‡ä»¶æ—¶, ä¼šå‘ç°æ²¡æœ‰å¯¹åº”çš„ orientation ä¿¡æ¯äº†. è€Œå¦ä¸€äº›æ—¶å€™ä¼šæŠŠ exif å­˜å‚¨ä¸‹æ¥, ä¾‹å¦‚ä½¿ç”¨<code>UIImageJPEGRepresentation</code>çš„æ—¶å€™.<br>æ€»ä¹‹å¯¹äºæˆ‘ä»¬æ¥è¯´, åªéœ€è¦ä¾èµ– API å°±å¥½, ä¸è¦è‡ªå·±å» cache orientation çš„ä¿¡æ¯.</p><h2 id="ä½¿ç”¨-uikit-è·å–uiimageæ—¶-ç³»ç»Ÿå¯¹imageorientationçš„å¡«å……æ–¹å¼"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-uikit-è·å–uiimageæ—¶-ç³»ç»Ÿå¯¹imageorientationçš„å¡«å……æ–¹å¼"></a> ä½¿ç”¨ UIKit è·å–<code>UIImage</code>æ—¶, ç³»ç»Ÿå¯¹<code>imageOrientation</code>çš„å¡«å……æ–¹å¼</h2><p>è™½ç„¶å¯¹æˆ‘ä»¬æ¥è¯´, <code>UIImagePickerController</code>è¿”å›çš„<code>UIImage</code>å¦‚ä½•å¡«å……<code>imageOrientation</code>, å¾ˆå¤šæ—¶å€™æ˜¯ä¸€ä¸ªé€æ˜çš„æ“ä½œ: æˆ‘ä»¬åªéœ€è¦å–å‡º<code>imageOrientation</code>, å¯¹è¯¥å€¼åˆ†æƒ…å†µè¿›è¡Œæ“ä½œå°±å¥½. ä½†å¦‚æœèƒ½è¿›ä¸€æ­¥äº†è§£ iOS å¡«å……<code>imageOrientation</code>çš„è§„åˆ™, å°±å¯ä»¥åœ¨å¾ˆå¤šåœ°æ–¹é¿å…å¸¸è¯†æ€§é”™è¯¯. ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­å°±æ˜¯, ç”¨æ‰‹æœºç«–ç€æ‹äººçš„æ—¶å€™, è¿”å›çš„<code>imageOrientaion</code>ä¸æ˜¯<code>.up</code>.</p><h3 id="åŸºæœ¬ç›¸å¯¹å…³ç³»"><a class="markdownIt-Anchor" href="#åŸºæœ¬ç›¸å¯¹å…³ç³»"></a> åŸºæœ¬ç›¸å¯¹å…³ç³»</h3><p>å½“æˆ‘ä»¬æŠŠç›¸æœºæœå‘å‰æ–¹, <em>é€†æ—¶é’ˆ</em>è½¬90åº¦æ—¶, å…¶å®ä»ç›¸æœºçš„ local è§†ç‚¹æ¥çœ‹, ä¸–ç•Œæ˜¯æœ<em>é¡ºæ—¶é’ˆ</em>æ–¹å‘è½¬äº†90åº¦. å¦‚æœæˆ‘ä»¬è¦æŠŠæ­¤æ—¶æ‹åˆ°çš„å›¾ç‰‡è¿˜åŸåˆ°ç°å®ä¸–ç•Œçš„æ–¹ä½, æˆ‘ä»¬åº”è¯¥<em>é€†æ—¶é’ˆ</em>æ—‹è½¬æ‹å¾—çš„ç…§ç‰‡.</p><h3 id="åç½®æ‘„åƒå¤´"><a class="markdownIt-Anchor" href="#åç½®æ‘„åƒå¤´"></a> åç½®æ‘„åƒå¤´</h3><ul><li>åç½®ç›¸æœºåœ¨å‡ºå‚æ—¶, å…¶å®‰è£…æ­£å‘æ–¹ä½å¯¹åº” device çš„<code>UIDeviceOrientation.landscapeLeft</code>(æ­¤æ—¶æ‰‹æœºå±å¹•é¢å‘ç”¨æˆ·, home button åœ¨å³). åœ¨è¿™ä¸ªæ–¹ä½ä¸‹ä½¿ç”¨ UIKit æ‹æ‘„çš„<code>UIImage</code>, <code>imageOrientation</code>ä¸º<code>.up</code>. ä¹‹æ‰€ä»¥è®¾å®šè¿™ä¸ª device æ–¹å‘ä¸ºæ ‡å‡†æ­£æ–¹ä½, æˆ‘æƒ³åº”è¯¥æ˜¯ä¸ºäº†æ²¿è¢­å†å².</li><li>æ‰‹æœºæ–¹ä½ä¸ºä¸º<code>.portrait</code>æ—¶, ç›¸å½“äºæŠŠæ‰‹æœºä»æ­£æ–¹ä½é¡ºæ—¶é’ˆæ—‹è½¬äº†90åº¦, æŒ‰ä¸Šè¿°åŸºæœ¬ç›¸å¯¹å…³ç³», UIKit ä¸ºç”Ÿæˆçš„ image å¡«å……çš„ orientation ä¸º<code>.right</code></li><li>å‰©ä¸‹2ä¸ªé™¤<code>.faceUp</code>å’Œ<code>.faceDown</code>çš„æ–¹ä½åŒç†</li></ul><h3 id="å‰ç½®æ‘„åƒå¤´"><a class="markdownIt-Anchor" href="#å‰ç½®æ‘„åƒå¤´"></a> å‰ç½®æ‘„åƒå¤´</h3><p>å‰ç½®æ‘„åƒå¤´æœ‰ä¸€ä¸ªmirrorçš„æ¦‚å¿µ, å› ä¸ºåœ¨å±å¹•æœå‘æ‹æ‘„è€…çš„æƒ…å†µä¸‹, å¦‚æœæŠŠå‰ç½®æ‘„åƒå¤´å®é™…æ‹æ‘„åˆ°çš„æ™¯è±¡ç›´æ¥å±•ç¤ºåˆ°å±å¹•ä¸Š, ä¼šå‘ç°å®é™…ä¸­ç‰©ä½“è¿åŠ¨çš„æ–¹å‘å’Œå±å¹•ä¸Šç‰©ä½“è¿åŠ¨çš„æ–¹å‘ä¸ä¸€è‡´, å®¹æ˜“ä½¿äººäº§ç”Ÿè¯¯è§£.<br>å› æ­¤ä¸€èˆ¬æƒ…å†µä¸‹, æˆ‘ä»¬å¼€å‘çš„è½¯ä»¶ä¼šé€‰æ‹©æŠŠæ‹åˆ°çš„å›¾ç‰‡<em>åœ¨æ—‹è½¬çŸ«æ­£å®Œçš„åŸºç¡€ä¸Š</em>ä½œä¸€æ¬¡å·¦å³ mirror. (æ³¨æ„è¿™é‡Œè¦å…ˆæ—‹è½¬, å†å·¦å³ mirror)</p><hr><p>å®é™…ä¸Š, <code>UIImagePickerController</code>åœ¨æ‹æ‘„å®æ—¶é¢„è§ˆæ—¶ä½¿ç”¨çš„æ˜¯ mirror åçš„å›¾, ä½†æœ€ç»ˆè¾“å‡º(ä¹Ÿå°±æ˜¯æŒ‰ä¸‹æ‹æ‘„æŒ‰é’®åå¼¹å‡ºçš„ç¡®è®¤é¢„è§ˆæ—¶çš„å›¾)çš„æ˜¯æœª mirror çš„å›¾, ä¸¤è€…ä¸æ˜¯ç»Ÿä¸€çš„.</p><hr><p>æˆ‘ä»¬å…ˆçœ‹æœª mirror çš„æƒ…å†µ</p><ul><li>å‰ç½®ç›¸æœºå’Œåç½®ç›¸æœºçš„å®‰è£…æ–¹ä½ç›¸å, å¯¹åº” device æ–¹ä½ä¸º<code>.landscapeRight</code>æ—¶, ä¸ºç›¸æœºåˆå§‹çš„æ­£å‘å®‰è£…æ–¹ä½, æ­¤æ—¶ç”Ÿæˆçš„ image æœª mirror æƒ…å†µä¸‹ä¸º: <code>.up</code>.</li><li>æ‰‹æœºæ–¹ä½ä¸º<code>.portrait</code>æ—¶, <em>åœ¨æ‘„åƒå¤´è§†è§’ä¸‹</em> (ä¸æ˜¯åœ¨äººçœ¼çš„é¢æœå±å¹•çš„è§†è§’ä¸‹), ç›¸å½“äºæŠŠç›¸æœº<em>é¡ºæ—¶é’ˆ</em>æ—‹è½¬90åº¦, æŒ‰ä¸Šè¿°åˆ†æ, UIKit ç”Ÿæˆçš„ image æœå‘ä¸º<code>.right</code>.</li></ul><hr><p>ä¹Ÿå°±æ˜¯è¯´, æ— è®ºæ˜¯å‰ç½®è¿˜æ˜¯åç½®æ‘„åƒå¤´, åœ¨æ²¡æœ‰ mirror çš„æƒ…å†µä¸‹, åªè¦æ‰‹æœºæ˜¯<code>.portrait</code>, UIKit ç”Ÿæˆçš„ image æœå‘ä¸€å¾‹ä¸º<code>.right</code>.</p><hr><p>å¦‚æœéœ€è¦ mirror, åªèƒ½æ˜¯æˆ‘ä»¬å¼€å‘è€…æŠŠå›¾åƒè¿›è¡Œè°ƒæ•´. æœ€å¿«é€Ÿçš„æ–¹æ³•å°±æ˜¯ç›´æ¥ä¿®æ”¹æ‹¿åˆ°çš„å›¾åƒçš„<code>imageOrientation</code>. ä½†éœ€è¦æ³¨æ„çš„æ˜¯, ä¸èƒ½ç®€å•åœ°åœ¨åŸæ¥çš„ case åå­—ååŠ ä¸Š&quot;Mirrored&quot;å­—æ ·æ¥è§£å†³. è¿™æ­£æ˜¯å‰æ–‡æ‰€è¯´çš„, å› ä¸º&quot;~Mirrored&quot;è¡¨ç¤ºçš„æ˜¯æŠŠå›¾åƒåœ¨<em>æ—‹è½¬å‰</em>å…ˆå·¦å³ mirror (æˆ–è€…ç­‰ä»·åœ°è¯´, è¦åœ¨æ—‹è½¬åçš„å›¾ä¸ŠæŒ‰æ–°çš„æ—‹è½¬è¿‡çš„å¯¹ç§°è½´ mirror), è€Œæˆ‘ä»¬é¢„æœŸçš„è¡Œä¸ºæ˜¯å…ˆæ—‹è½¬, æœ€åå†å·¦å³ mirror. å½“å·¦å³ç¿»è½¬å’ŒæŸä¸ªç‰¹å®šçš„æ—‹è½¬æ“ä½œç»“åˆæ—¶, mirror å‘ç”Ÿçš„å…ˆåä¼šå¯¼è‡´ä¸åŒçš„ç»“æœ.<br>æ­£ç¡®çš„ mirror æ“ä½œå¯¹åº”çš„ case è°ƒæ•´åº”è¯¥æ˜¯:</p><ul><li><code>up</code> -&gt; <code>upMirrored</code></li><li><code>down</code> -&gt; <code>downMirrored</code></li><li><code>left</code> -&gt; <code>rightMirrored</code> <em>(Special)</em></li><li><code>right</code> -&gt; <code>leftMirrored</code> <em>(Special)</em></li></ul><h2 id="case-face-detection-ä¸­çš„åæ ‡å˜æ¢"><a class="markdownIt-Anchor" href="#case-face-detection-ä¸­çš„åæ ‡å˜æ¢"></a> Case: Face Detection ä¸­çš„åæ ‡å˜æ¢</h2><p>é—®é¢˜: æ‹æ‘„ä¸€å¼ äººåƒ, åœ¨å±å¹•ä¸Šæ˜¾ç¤ºè¯¥å›¾åƒ, å¹¶æ¡†å‡ºè¿™ä¸ªå›¾åƒä¸­çš„äººè„¸åŒºåŸŸ. åœ¨ä¸é¢å¤–äº§ç”Ÿä¸­é—´ image çš„æƒ…å†µä¸‹å¦‚ä½•è§£å†³.</p><p>æµç¨‹ç®€å•æè¿°å¦‚ä¸‹:</p><ul><li><code>UIImagePicker</code>ç”Ÿæˆ<code>UIImage</code>, å…¶<code>cgImage</code>ä¸º unadjusted raw data.</li><li>æ‰§è¡Œ face detection æ—¶, åŒæ—¶ä¼ å…¥ raw data å’Œ image orientation. ç”Ÿæˆçš„ face bounds, å…¶ origin, æ˜¯åœ¨ unadjusted orientation ä¸‹, ç›¸å¯¹äºå·¦ä¸‹è§’çš„åæ ‡.</li><li>è¦æŠŠäººå¤´cropå‡ºæ¥, éœ€è¦:<ul><li>æŠŠ face bounds çš„è½¬æˆåœ¨ raw data image åæ ‡ç³»ä¸‹, origin ç›¸å¯¹å·¦ä¸Šè§’çš„åæ ‡</li><li>ç›´æ¥é€šè¿‡ raw data å»ºç«‹ quartz image, å¹¶ç”¨ä¸Šè¿°å˜æ¢è¿‡ origin çš„ bounds æ‰§è¡Œ image crop, crop çš„ç»“æœæ˜¯æœªè°ƒæ•´æœå‘çš„äººè„¸ data.</li></ul></li><li>åœ¨ UI ä¸Šç»˜åˆ¶å›¾åƒå’Œäººè„¸å¯¹åº”çš„ view:<ul><li>ç”¨<code>UIImageView</code>æ¸²æŸ“æ•´å¼ å›¾åƒ, æ•´ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ° orientation çš„åœ°æ–¹ç”±<code>UIKit</code> handle, æ— éš¾åº¦.</li><li>ç”¨ä¸€ä¸ªå¸¦è¾¹æ¡†çš„ subview/layer è¡¨ç¤ºäººè„¸ä½ç½®, éœ€è¦è®¡ç®—å‡º, æŠŠ raw data æŒ‰ orientation æ‰§è¡Œä¸€æ¬¡ transform å, æ­¤æ—¶çš„ face bounds è·ç¦»æ—‹è½¬åçš„å›¾ç‰‡å·¦ä¸Šè§’çš„åæ ‡.<ul><li>å¦‚æœå›¾ç‰‡é1:1æ˜ å°„åˆ°å±å¹•, åˆ™éœ€è¦æŠŠä¸Šè¿°åæ ‡æŒ‰å›¾ç‰‡çœŸå®å°ºå¯¸å’Œ view çš„å…³ç³»è¿›è¡Œç¼©æ”¾/offset, å°±å¯ä»¥å¾—åˆ°æœ€ç»ˆçš„ face view/layer çš„ frame.</li></ul></li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;ul class=&quot;markdownIt-TOC&quot;&gt;
&lt;li&gt;&lt;a href=&quot;#%E8%83%8C%E6%99%AF&quot;&gt;èƒŒæ™¯&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E4%BC%A0%E7%BB%9F%E7%9B%B8%E6%9C%BA&quot;&gt;ä¼ ç»Ÿç›¸æœº&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#dslr&quot;&gt;DSLR&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%AF%B9%E5%9B%BE%E5%83%8F%E7%AE%97%E6%B3%95%E7%9A%84%E5%BD%B1%E5%93%8D&quot;&gt;å¯¹å›¾åƒç®—æ³•çš„å½±å“&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orientation-tag-%E7%9A%84%E8%A1%A8%E7%A4%BA&quot;&gt;Orientation tag çš„è¡¨ç¤º&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#raw-exif-%E4%BF%A1%E6%81%AF&quot;&gt;Raw exif ä¿¡æ¯&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#apple-api&quot;&gt;Apple API&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#uiimage%E7%9B%B8%E5%85%B3-api&quot;&gt;&lt;code&gt;UIImage&lt;/code&gt;ç›¸å…³ API&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8-uikit-%E8%8E%B7%E5%8F%96uiimage%E6%97%B6-%E7%B3%BB%E7%BB%9F%E5%AF%B9imageorientation%E7%9A%84%E5%A1%AB%E5%85%85%E6%96%B9%E5%BC%8F&quot;&gt;ä½¿ç”¨ UIKit è·å–&lt;code&gt;UIImage&lt;/code&gt;æ—¶, ç³»ç»Ÿå¯¹&lt;code&gt;imageOrientation&lt;/code&gt;çš„å¡«å……æ–¹å¼&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%9F%BA%E6%9C%AC%E7%9B%B8%E5%AF%B9%E5%85%B3%E7%B3%BB&quot;&gt;åŸºæœ¬ç›¸å¯¹å…³ç³»&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%90%8E%E7%BD%AE%E6%91%84%E5%83%8F%E5%A4%B4&quot;&gt;åç½®æ‘„åƒå¤´&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%89%8D%E7%BD%AE%E6%91%84%E5%83%8F%E5%A4%B4&quot;&gt;å‰ç½®æ‘„åƒå¤´&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#case-face-detection-%E4%B8%AD%E7%9A%84%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2&quot;&gt;Case: Face Detection ä¸­çš„åæ ‡å˜æ¢&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;åŸæ–‡æˆäº2018å¹´12æœˆ&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#èƒŒæ™¯&quot;&gt;&lt;/a&gt; èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆå­˜åœ¨ Image Orientation&lt;/p&gt;
&lt;h3 id=&quot;ä¼ ç»Ÿç›¸æœº&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#ä¼ ç»Ÿç›¸æœº&quot;&gt;&lt;/a&gt; ä¼ ç»Ÿç›¸æœº&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä¼ ç»Ÿç›¸æœºæ¨ªå‘æ‹æ‘„, èƒ¶å·å’Œç…§ç‰‡ä¹ŸæŒ‰æ¨ªå‘æ–¹ä½å›ºå®šå°ºå¯¸.&lt;/li&gt;
&lt;li&gt;æ‹ç«–ç›´æ–¹å‘çš„æ™¯çš„æ—¶å€™, æ‘„å½±å¸ˆæŠŠç›¸æœºæ—‹è½¬90åº¦, æ‹åˆ°çš„åŸå§‹ç…§ç‰‡æ˜¯æ¨ªå‘çš„.&lt;/li&gt;
&lt;li&gt;è¦æ­£ç¡®è¿˜åŸç°åœºçš„æƒ…å†µ, éœ€è¦æ‰‹åŠ¨æŠŠç…§ç‰‡æ—‹è½¬90åº¦.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;dslr&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#dslr&quot;&gt;&lt;/a&gt; DSLR&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·çš„æŒç›¸æœºæ–¹å¼å’Œéœ€æ±‚æ²¡æœ‰æœ¬è´¨å˜åŒ–.&lt;/li&gt;
&lt;li&gt;ä»ç„¶éœ€è¦å¤–éƒ¨é¢å¤–ä¿¡æ¯æ¥å¸®åŠ©ç¡®å®šæ€ä¹ˆæ—‹è½¬æ‹å¾—çš„å›¾åƒ.
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·ä½¿ç”¨ç›¸æœºä¸Šçš„ UI, æ‰‹åŠ¨è¾“å…¥æ—‹è½¬ä¿¡æ¯.&lt;/li&gt;
&lt;li&gt;æ ¹æ®ç¡¬ä»¶çš„é‡åŠ›åŠ é€Ÿè®¡è‡ªåŠ¨ç¡®å®šæ–¹å‘.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åŸºäºæ€§èƒ½å’Œæ•ˆç‡åŸå› , å¹¶ä¸ä¼šæŠŠ raw data è¿›è¡Œæ—‹è½¬ç”Ÿæˆä¸€å¼ æ–°å›¾ç‰‡, è€Œæ˜¯åŠ ä¸Šä¸€ä¸ª tag, è¿™ä¸ª tag å°±è¡¨ç¤º image orientation.&lt;/li&gt;
&lt;li&gt;å„ç«¯æ˜¾ç¤ºè¿™æ ·çš„å›¾ç‰‡æ—¶, éœ€è¦è¯»å–è¿™ä¸ª tag, å¹¶åœ¨æ¸²æŸ“æ—¶ç»™ raw data åŠ ä¸Šä¸€ä¸ª transform.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;å¯¹å›¾åƒç®—æ³•çš„å½±å“&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#å¯¹å›¾åƒç®—æ³•çš„å½±å“&quot;&gt;&lt;/a&gt; å¯¹å›¾åƒç®—æ³•çš„å½±å“&lt;/h2&gt;
&lt;p&gt;å½“å¯¹æŸä¸ªå›¾åƒæ‰§è¡ŒæŸäº›ç®—æ³•æ—¶, é™¤äº†å¿…è¦çš„å›¾åƒ data ä¿¡æ¯, è¿˜å¯èƒ½éœ€è¦å·²çŸ¥çš„ orientation ä¿¡æ¯. ä¾‹å¦‚å¾ˆå¤šäººè„¸æ£€æµ‹ç®—æ³•, åœ¨æœ‰å…ˆéªŒçš„ orientation çŸ¥è¯†æ—¶, é€šå¸¸èƒ½æœ‰æ›´å¥½çš„æ•ˆæœ. ä¾‹å¦‚, Apple çš„ CoreImage æ”¯æŒäººè„¸æ£€æµ‹, &lt;a href=&quot;https://developer.apple.com/documentation/coreimage/cidetectorimageorientation&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å…¶ API æ¥å— orientation å‚æ•°&lt;/a&gt;.&lt;/p&gt;</summary>
    
    
    
    <category term="Notes" scheme="https://crystdragon.github.io/categories/notes/"/>
    
    <category term="Apple Platforms" scheme="https://crystdragon.github.io/categories/apple-platforms/"/>
    
    
    <category term="Image" scheme="https://crystdragon.github.io/tags/image/"/>
    
    <category term="UIKit" scheme="https://crystdragon.github.io/tags/uikit/"/>
    
    <category term="AVFoundation" scheme="https://crystdragon.github.io/tags/avfoundation/"/>
    
  </entry>
  
  <entry>
    <title>Computer Security Notes</title>
    <link href="https://crystdragon.github.io/2020/computer-security-notes/"/>
    <id>https://crystdragon.github.io/2020/computer-security-notes/</id>
    <published>2020-07-26T16:00:00.000Z</published>
    <updated>2020-07-28T09:00:02.992Z</updated>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#%E5%AF%86%E7%A0%81%E5%AD%A6%E6%A6%82%E5%BF%B5">å¯†ç å­¦æ¦‚å¿µ</a></li><li><a href="#%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%AD%E7%9A%84-certificate-authority">äº’è”ç½‘ä¸­çš„ Certificate Authority</a></li><li><a href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84-chmod-chown">æ“ä½œç³»ç»Ÿä¸­çš„ chmod &amp; chown</a><ul><li><a href="#xcode-%E4%B8%8B-build-%E6%97%B6%E8%87%AA%E5%8A%A8%E5%8C%96%E6%8A%8A%E6%96%87%E4%BB%B6%E6%8B%B7%E8%B4%9D%E5%88%B0%E5%8F%97%E9%99%90%E7%9B%AE%E5%BD%95">Xcode ä¸‹ build æ—¶è‡ªåŠ¨åŒ–æŠŠæ–‡ä»¶æ‹·è´åˆ°å—é™ç›®å½•</a></li></ul></li><li><a href="#case-mac-os-privilege-jobs">Case: Mac OS Privilege Jobs</a></li></ul></p><hr><p>åŸæ–‡æˆäº2019å¹´</p><hr><h2 id="å¯†ç å­¦æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#å¯†ç å­¦æ¦‚å¿µ"></a> å¯†ç å­¦æ¦‚å¿µ</h2><ul><li>å¯¹ç§°åŠ å¯†<ul><li>éœ€è¦ private é€šé“ä¼ é€’å¯†é’¥.</li></ul></li><li>éå¯¹ç§°åŠ å¯†<ul><li>å®ç° encryption (ä¿è¯å‘é€çš„ä¸œè¥¿æ²¡æœ‰åˆ«äººçŸ¥é“): ä¼ é€’æ–¹ç”¨æ¥æ”¶æ–¹å‘å¸ƒçš„å…¬é’¥åŠ å¯†, æ¥æ”¶æ–¹ç”¨ç§é’¥è§£å¯†.</li><li>å®ç° authentication (ä¿è¯å‘é€çš„äººä¸ä¼šæ˜¯åˆ«äºº):  ä¼ é€’æŠŠ message ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†, ä½œä¸º signature å’Œ message ä¸€èµ·å‘ç»™æ¥æ”¶æ–¹, æ¥æ”¶æ–¹æ”¶åˆ°åç”¨ä¼ é€’æ–¹æ—©å‰å…¬å¼€æä¾›çš„å…¬é’¥å¯¹ signature è¿›è¡Œè§£å¯†, éªŒè¯èƒ½è¿˜åŸåˆ° message.</li></ul></li><li>æ··åˆåŠ å¯†: ç”¨å¯¹ç§°ç§˜é’¥åŠ å¯†æ˜æ–‡, å¹¶ç”¨éå¯¹ç§°ç§˜é’¥åŠ å¯†å¯¹ç§°ç§˜é’¥.</li></ul><a id="more"></a><h2 id="äº’è”ç½‘ä¸­çš„-certificate-authority"><a class="markdownIt-Anchor" href="#äº’è”ç½‘ä¸­çš„-certificate-authority"></a> äº’è”ç½‘ä¸­çš„ Certificate Authority</h2><p>å¦‚æœä¼ é€’æ–¹åªå‘é€ public key å’Œ signature, æœ‰ä¸€ä¸ªéšæ‚£, å°±æ˜¯ä¸­é—´è€…æ”»å‡». å¦‚æœå‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹å‰æ²¡æœ‰ä»»ä½•é€šä¿¡è¿‡, ä¸­é—´è€…å¯ä»¥ä½¿ç”¨è‡ªå·±çš„ private/public key, å…¨ç¨‹æŠŠæ‹¦æˆªåˆ°çš„ä¿¡æ¯è½¬å‘ç»™æ¥æ”¶æ–¹, è®©æ¥æ”¶æ–¹è¯¯ä»¥ä¸ºè‡ªå·±æ˜¯å‘é€æ–¹. å…³é”®é—®é¢˜æ˜¯è¦æœ‰ä¸€ä¸ªæœºåˆ¶, è®©ä¸­é—´è€…æ— æ³•æŠŠ public/private key pair æ›¿æ¢æ‰.</p><ul><li>ä½¿ç”¨è¯ä¹¦, ä¼ é€’æ–¹æŠŠè‡ªå·±çš„è¯ä¹¦ä¸€èµ·å‘é€. è¯ä¹¦å®é™…ä¸Šæ˜¯ authentication çš„åº”ç”¨: è¯ä¹¦åŒ…å«ä¸€äº›ç”¨ private key åŠ å¯†çš„æ•°æ®. æ¥æ”¶æ–¹å¯ä»¥éªŒè¯ public key å’Œè¯ä¹¦æ˜¯å¯¹åº”çš„.<ul><li>ä¸­é—´è€…æ‹¦æˆªåˆ°çœŸæ­£çš„è¯ä¹¦å, å¦‚æœé€‰æ‹©å‘å‘é€æ–¹é€ä¼ è¿™ä¸ªåŒ…å«çœŸçš„ public key çš„è¯ä¹¦, ä»–å°±æ— æ³•è¾¾åˆ°ä»–çš„éæ³•ç›®çš„. å› ä¸ºä¸€æ—¦è¿™æ ·, æ•´ä¸ªé€šä¿¡è¿‡ç¨‹å°±ä¼šä½¿ç”¨è¿™ä¸ªè¯ä¹¦çš„ key pair, ä¸­é—´äººå°±æ— æ³•ä½œå‡.</li><li>ä¸­é—´è€…å¦‚æœé€‰æ‹©å‘é€è‡ªå·±è®¾æ³•ä¼ªé€ çš„è¯ä¹¦, å°±ä¸å¯èƒ½ä¸è¢«å¯Ÿè§‰. å› ä¸ºæ¥æ”¶æ–¹æœ‰åŠæ³•å‘è§‰è¿™ä¸ªè¯ä¹¦çš„ä¼ªé€ ä¹‹å¤„.</li></ul></li><li>è¦ç¡®å®šè¯ä¹¦æ˜¯æ­£å½“çš„è¿˜æ˜¯ä¼ªé€ çš„, å…³é”®åœ¨äºéœ€è¦æœ‰æƒå¨æœºæ„ç­¾å‘ (issue) è¯ä¹¦.<ul><li>ä¸–ç•Œä¸Šæœ‰å¯ä»¥æ•°å°½çš„æ ¹è®¤è¯æœºæ„, å…¶å„æœ‰è‡ªè®¤è¯çš„æ ¹è¯ä¹¦.</li><li>è¿™äº›å…¬å¸æŒ‰æ ‘å‹å…³ç³»é€çº§ä¼šç­¾å‘è¯ä¹¦ç»™åˆ«çš„æœºæ„, å­è¯ä¹¦å’Œçˆ¶è¯ä¹¦çš„æ‰€å±å…³ç³»æ˜¯å¯ä»¥åˆæ³•éªŒè¯çš„, é€ å‡è€…ä¸å¯èƒ½è‡ªå·±å•ç‹¬å»ºä¸€ä¸ªå‡çš„å­è¯ä¹¦å…³è”åˆ°çˆ¶è¯ä¹¦.<ul><li>éªŒè¯æŸä¸ªå­è¯ä¹¦æ˜¯ç”±çˆ¶è¯ä¹¦ç­¾å‘, åŒæ ·ä¹Ÿæ˜¯ authentication çš„åº”ç”¨: éªŒè¯è€…å¯ä»¥ä½¿ç”¨çˆ¶è¯ä¹¦å…¬å¼€çš„ public key åœ¨æœ¬åœ°ç¡®è®¤æ˜¯å¦å¯ä»¥æ­£ç¡® decrypt å­è¯ä¹¦.</li></ul></li><li>è½¯ä»¶å…¬å¸åœ¨è‡ªå·±çš„ Browser/Operating System ä¸­åŠ å…¥æœ€é¡¶çº§çš„æ ¹è¯ä¹¦</li><li>å½“æ”¶åˆ°å‘é€æ–¹ä¼ æ¥çš„è¯ä¹¦æ—¶, æŒ‰ç…§é“¾å¼å…³ç³»éªŒè¯è¯ä¹¦æ˜¯å¦æœ€ç»ˆä¼šå¯¼å‘æ ¹è¯ä¹¦, å¦‚æœ ok åˆ™ä¿¡ä»», å¦åˆ™äº¤ç”±ç”¨æˆ·å¤„ç†(ç§°ä¹‹ä¸ºè‡ªè®¤è¯è¯ä¹¦).</li></ul></li><li>äº’è”ç½‘è¯ä¹¦ç³»ç»Ÿå®é™…ä¸Šæ˜¯æŠŠ&quot;public keyå…¬å¼€&quot;è¿™ä¸€æ­¥, è½¬ç§»åˆ°ä»¥æƒå¨æœºæ„ç­¾å‘è¯ä¹¦, æ¥è§£å†³é—®é¢˜.</li></ul><p>æ—¥å¸¸å¼€å‘ä¸­çš„ Charles, æ­£æ˜¯ä¸­é—´äººæ”»å‡»çš„ä¸€ç§<a href="https://www.charlesproxy.com/documentation/using-charles/ssl-certificates/" target="_blank" rel="noopener">æ­£é¢åº”ç”¨</a>.</p><ul><li>Charles è‡ªå·±æœ‰è‡ªå·±çš„ root è¯ä¹¦.</li><li>åœ¨æ£€æµ‹åˆ°å¯¹æŸä¸ªåŸŸåçš„è®¿é—®æ—¶, Charles ä¼šé’ˆå¯¹è¯¥åŸŸååŸºäº root è¯ä¹¦ç°åœºåˆ›å»ºä¸€ä¸ªå­è¯ä¹¦, å¹¶æŠŠè¯¥è¯ä¹¦æä¾›ç»™å‘é€æ–¹è®¾å¤‡.<ul><li>è®¾å¤‡éœ€è¦æ‰‹åŠ¨ä¿¡ä»»è¯¥è¯ä¹¦.</li><li>ä¹Ÿå¯ä»¥æå‰æŠŠ Charles çš„ root è¯ä¹¦æ·»åŠ åˆ°ä¿¡ä»»åˆ—è¡¨.</li></ul></li><li>å‘é€æ–¹è®¾å¤‡ä½¿ç”¨ Charles çš„è¯ä¹¦å¯¹åº”çš„ public key åŠ å¯†å, Charles æœ‰èƒ½åŠ› decrypt, å¹¶ç”¨çœŸæ­£çš„æœåŠ¡ç«¯ public key é‡æ–°åŠ å¯†, å‘é€ç»™æœåŠ¡ç«¯.</li></ul><h2 id="æ“ä½œç³»ç»Ÿä¸­çš„-chmod-chown"><a class="markdownIt-Anchor" href="#æ“ä½œç³»ç»Ÿä¸­çš„-chmod-chown"></a> æ“ä½œç³»ç»Ÿä¸­çš„ chmod &amp; chown</h2><p>unixä¸‹æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰3ç±»ä¸åŒçš„è®¿é—®è€…: user, group, other.<br>å¯¹æ¯ç±»è®¿é—®è€…éƒ½æ”¯æŒä¸‰ç§ä¸åŒæ“ä½œ: read, write, execute</p><ul><li>chmod: ç”¨æ¥æ”¹å˜æ–‡ä»¶é’ˆå¯¹ä¸åŒè®¿é—®è€…çš„è®¿é—®æƒé™</li><li>chown: ç”¨æ¥æ”¹å˜æ–‡ä»¶æ‰€å±çš„user</li></ul><h3 id="xcode-ä¸‹-build-æ—¶è‡ªåŠ¨åŒ–æŠŠæ–‡ä»¶æ‹·è´åˆ°å—é™ç›®å½•"><a class="markdownIt-Anchor" href="#xcode-ä¸‹-build-æ—¶è‡ªåŠ¨åŒ–æŠŠæ–‡ä»¶æ‹·è´åˆ°å—é™ç›®å½•"></a> Xcode ä¸‹ build æ—¶è‡ªåŠ¨åŒ–æŠŠæ–‡ä»¶æ‹·è´åˆ°å—é™ç›®å½•</h3><ul><li>å¢åŠ  copy file phase. æ— æ³•è§£å†³&quot;permission denied&quot;é—®é¢˜.</li><li>ä¾èµ– Deployment è®¾ç½®ä¸­çš„ installation location. ä¸ä¸€å®šèƒ½æ»¡è¶³éœ€æ±‚, å› ä¸ºå®ƒä¼šåœ¨ç›®æ ‡ä½ç½®å»ºç«‹å®Œæ•´çš„ç›®å½•, ä¹Ÿä¼šé¢ä¸´permissioné—®é¢˜.</li><li>ç›®å‰æ‰¾åˆ°çš„å”¯ä¸€çš„åŠæ³•: ä½¿ç”¨ custom script phase, é‡Œé¢ç”¨<code>sudo cp</code>æ¥è§£å†³.<ul><li>ä½†æ˜¯ Xcode æ‰§è¡Œ script çš„ç¯å¢ƒé»˜è®¤ä¸æ”¯æŒ sudo, ä¹Ÿä¸å¯èƒ½äº¤äº’å¼åœ°è¾“å…¥å¯†ç , æ‰€ä»¥éœ€è¦ç”¨<code>sudo -A</code>æŒ‡å®šä¸€ä¸ª password è¾“å‡ºç¨‹åº.</li><li>è¿™ä¸ªæ–‡ä»¶å¯ä»¥ç›´æ¥ç”¨shellå†™, å†…å®¹æ˜¯<code>echo password</code>å³å¯, ä½†æ³¨æ„è¿™ä¸ªæ–‡ä»¶éœ€è¦å¯¹ xcode è€Œè¨€æœ‰ x æƒé™</li></ul></li></ul><h2 id="case-mac-os-privilege-jobs"><a class="markdownIt-Anchor" href="#case-mac-os-privilege-jobs"></a> Case: Mac OS Privilege Jobs</h2><p>æˆ‘ä»¬çš„ mac app ç»å¸¸éœ€è¦ä¸´æ—¶è·å¾—ç‰¹æƒæ¥è®¿é—®ä¸€äº›å—ä¿æŠ¤çš„ç³»ç»Ÿèµ„æº. å½“ç„¶éœ€è¦ç”±ç”¨æˆ·çš„ç¡®è®¤, ä½†æˆ‘ä»¬åˆä¸æƒ³æŠŠæ•´ä¸ª app æƒé™æçš„å¤ªé«˜. å› æ­¤å¯ä»¥ä½¿ç”¨2ä¸ªè¿›ç¨‹, ä¸€ä¸ª daemon , ä¸€ä¸ª main app. Main app æŠŠ daemon ä½œä¸º privilege helper tools æ³¨å†Œç»™ç³»ç»Ÿ, ç³»ç»Ÿ(ç»è¿‡ç”¨æˆ·ç¡®è®¤)å®‰è£…åˆ°ä½å, ä¸¤è€…è¿›è¡Œ IPC ä¼ é€’æ•°æ®.</p><p>ç›¸å…³ frameworks:</p><ul><li>Security - Authorization Services: æƒé™ç›¸å…³çš„å®šä¹‰.</li><li>ServiceManagement: æ³¨å†Œprivilege tools.</li><li>XPC: ç”¨äºè½»é‡çº§çš„è¿›ç¨‹é—´é€šä¿¡.</li></ul><p>(æ³¨: ä¸å»ºè®®å†ä½¿ç”¨AuthorizationExecuteWithPrivileges, æ­¤æ–¹æ³•å› ä¸ºæ²¡æœ‰å¯¹å¾…å¯åŠ¨çš„toolä½œæ›´ä¸¥æ ¼çš„æ ¡éªŒ, å·²è¢«æ ‡è®°deprecated.)</p><p>è¿™äº›åº“ç”¨åˆ°äº†çš„ mac ç³»ç»ŸæŠ€æœ¯æœ‰:</p><ul><li>launchd: ç®¡ç†ç³»ç»Ÿdaemonå’Œagentçš„å¯åŠ¨.</li><li>launchctl: å¯ä»¥è§£æç›¸å…³serviceçš„plist.</li></ul><p>å‚è€ƒ:</p><ul><li><a href="http://www.stevestreeting.com/2011/11/25/escalating-privileges-on-mac-os-x-securely-and-without-using-deprecated-methods/" target="_blank" rel="noopener">Useful References</a></li><li><a href="https://developer.apple.com/library/content/documentation/Security/Conceptual/authorization_concepts/03authtasks/authtasks.html#//apple_ref/doc/uid/TP30000995-CH206-TPXREF33" target="_blank" rel="noopener">Authorization Service Programming Guide</a></li><li><a href="https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingXPCServices.html#//apple_ref/doc/uid/10000172i-SW6-SW1" target="_blank" rel="noopener">Daemons and Services Programming Guide</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;ul class=&quot;markdownIt-TOC&quot;&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%AF%86%E7%A0%81%E5%AD%A6%E6%A6%82%E5%BF%B5&quot;&gt;å¯†ç å­¦æ¦‚å¿µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%AD%E7%9A%84-certificate-authority&quot;&gt;äº’è”ç½‘ä¸­çš„ Certificate Authority&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84-chmod-chown&quot;&gt;æ“ä½œç³»ç»Ÿä¸­çš„ chmod &amp;amp; chown&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#xcode-%E4%B8%8B-build-%E6%97%B6%E8%87%AA%E5%8A%A8%E5%8C%96%E6%8A%8A%E6%96%87%E4%BB%B6%E6%8B%B7%E8%B4%9D%E5%88%B0%E5%8F%97%E9%99%90%E7%9B%AE%E5%BD%95&quot;&gt;Xcode ä¸‹ build æ—¶è‡ªåŠ¨åŒ–æŠŠæ–‡ä»¶æ‹·è´åˆ°å—é™ç›®å½•&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#case-mac-os-privilege-jobs&quot;&gt;Case: Mac OS Privilege Jobs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;åŸæ–‡æˆäº2019å¹´&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;å¯†ç å­¦æ¦‚å¿µ&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#å¯†ç å­¦æ¦‚å¿µ&quot;&gt;&lt;/a&gt; å¯†ç å­¦æ¦‚å¿µ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹ç§°åŠ å¯†
&lt;ul&gt;
&lt;li&gt;éœ€è¦ private é€šé“ä¼ é€’å¯†é’¥.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;éå¯¹ç§°åŠ å¯†
&lt;ul&gt;
&lt;li&gt;å®ç° encryption (ä¿è¯å‘é€çš„ä¸œè¥¿æ²¡æœ‰åˆ«äººçŸ¥é“): ä¼ é€’æ–¹ç”¨æ¥æ”¶æ–¹å‘å¸ƒçš„å…¬é’¥åŠ å¯†, æ¥æ”¶æ–¹ç”¨ç§é’¥è§£å¯†.&lt;/li&gt;
&lt;li&gt;å®ç° authentication (ä¿è¯å‘é€çš„äººä¸ä¼šæ˜¯åˆ«äºº):  ä¼ é€’æŠŠ message ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†, ä½œä¸º signature å’Œ message ä¸€èµ·å‘ç»™æ¥æ”¶æ–¹, æ¥æ”¶æ–¹æ”¶åˆ°åç”¨ä¼ é€’æ–¹æ—©å‰å…¬å¼€æä¾›çš„å…¬é’¥å¯¹ signature è¿›è¡Œè§£å¯†, éªŒè¯èƒ½è¿˜åŸåˆ° message.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ··åˆåŠ å¯†: ç”¨å¯¹ç§°ç§˜é’¥åŠ å¯†æ˜æ–‡, å¹¶ç”¨éå¯¹ç§°ç§˜é’¥åŠ å¯†å¯¹ç§°ç§˜é’¥.&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="Notes" scheme="https://crystdragon.github.io/categories/notes/"/>
    
    <category term="Computer Systems" scheme="https://crystdragon.github.io/categories/computer-systems/"/>
    
    
    <category term="Cryptography" scheme="https://crystdragon.github.io/tags/cryptography/"/>
    
    <category term="Apple Platforms" scheme="https://crystdragon.github.io/tags/apple-platforms/"/>
    
  </entry>
  
  <entry>
    <title>Deallocation ä¸­çš„çº¿ç¨‹å®‰å…¨</title>
    <link href="https://crystdragon.github.io/2020/deallocation-thread-safety/"/>
    <id>https://crystdragon.github.io/2020/deallocation-thread-safety/</id>
    <published>2020-07-26T16:00:00.000Z</published>
    <updated>2020-07-28T11:26:44.145Z</updated>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#%E8%83%8C%E6%99%AF">èƒŒæ™¯</a></li><li><a href="#%E5%88%86%E6%9E%90">åˆ†æ</a><ul><li><a href="#%E6%97%A0%E7%BA%BF%E7%A8%8B%E7%AB%9E%E4%BA%89">æ— çº¿ç¨‹ç«äº‰</a></li><li><a href="#%E6%9C%89%E7%BA%BF%E7%A8%8B%E7%AB%9E%E4%BA%89">æœ‰çº¿ç¨‹ç«äº‰</a><ul><li><a href="#%E5%BC%BA%E5%BC%95%E7%94%A8">å¼ºå¼•ç”¨</a></li><li><a href="#%E5%BC%B1%E5%BC%95%E7%94%A8">å¼±å¼•ç”¨</a></li><li><a href="#unsafe%E5%BC%95%E7%94%A8">unsafeå¼•ç”¨</a></li></ul></li></ul></li><li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li></ul></p><hr><p>åŸæ–‡æˆäº2017å¹´11æœˆ</p><hr><h2 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h2><p>æœ€è¿‘åœ¨æµè§ˆ Swift Talk çš„è¿‡ç¨‹ä¸­, æ€è€ƒäº†ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜.</p><p>å¦‚æœä¸€ä¸ªå¯¹è±¡é€šè¿‡<code>NotificationCenter</code>æ³¨å†Œäº†ä¸€ä¸ªé€šçŸ¥, ç„¶ååœ¨è¿™ä¸ªå¯¹è±¡çš„<code>deinit</code>æ–¹æ³•ä¸­æ‰§è¡Œäº†<code>removeObserver</code>. å‡å¦‚åœ¨å¯¹è±¡è°ƒç”¨<code>deinit</code>çš„è¿‡ç¨‹ä¸­å¯¹åº”çš„äº‹ä»¶å‘ç”Ÿäº†, å¹¶äº§ç”Ÿäº†ä¸€ä¸ªé€šçŸ¥, æ­¤æ—¶ä¼šæœ‰ä»€ä¹ˆç°è±¡? å½“äº‹ä»¶å‘ç”Ÿ/æŠ•é€’çš„çº¿ç¨‹å’Œå¯¹è±¡<code>deinit</code>çš„çº¿ç¨‹ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹æ—¶, ä¼šå¯¼è‡´å´©æºƒå—? <a href="https://talk.objc.io/episodes/S01E28-typed-notifications-part-2" target="_blank" rel="noopener">Swift Talk #28æœ€å5åˆ†é’Ÿå†…å®¹</a></p><p>è¿™ä¸ªé—®é¢˜æˆ‘è§‰å¾—å¾ˆæœ‰æ„æ€, ä¹‹å‰éƒ½æ²¡æœ‰æ„è¯†åˆ°è¿‡.</p><p>äº‹å®ä¸Šè™½ç„¶è¿™ä¸ªé—®é¢˜æ˜¯åœ¨&quot;Swift Talk&quot;ä¸­æŠ›å‡º, ä½†æ˜¯å¹¶ä¸æ˜¯Swiftç‹¬æœ‰çš„, OC ä¸‹çš„<code>dealloc</code>æ–¹æ³•åŒæ ·æœ‰è¿™ä¸ªé—®é¢˜. å¦å¤–, è™½ç„¶é—®é¢˜æ˜¯ä»¥ Notification ä¸ºä¾‹, ä½†æ˜¾ç„¶é—®é¢˜å¹¶ä¸é™äºé€šçŸ¥, ä»»ä½•åˆ«çš„å«æœ‰é€šçŸ¥/å›è°ƒæœºåˆ¶çš„åœºæ™¯éƒ½ä¼šé¢ä¸´åŒæ ·çš„é—®é¢˜.</p><a id="more"></a><h2 id="åˆ†æ"><a class="markdownIt-Anchor" href="#åˆ†æ"></a> åˆ†æ</h2><p>é¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯, ä»å®‰å…¨è§’åº¦æ¥è®², æ˜¯æœ‰å¿…è¦åæ³¨å†Œçš„. å³ä½¿æ–°çš„ API ä¹Ÿè®¸ä¸è¦æ±‚æˆ‘ä»¬å¼€å‘è€…æ˜¾å¼è°ƒç”¨<code>removeObserver</code>, å…¶å†…éƒ¨ä¹Ÿä¸€å®šåœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œäº†ç­‰ä»·çš„åæ³¨å†Œ. ä¸‹é¢éƒ½æ˜¯ä»¥è°ƒç”¨äº†<code>removeObserver</code>è¿™ä¸ªä¸ºå‰æè¿›è¡Œè®¨è®º.</p><p>å…¶æ¬¡, è€ƒè™‘ä¸€ä¸‹, å¦‚æœè¿™è¾¹æœ‰é—®é¢˜, ä¼šæ˜¯ä»€ä¹ˆç±»å‹çš„é—®é¢˜? æˆ‘è®¤ä¸ºè‡³å°‘å¯èƒ½æœ‰ä»¥ä¸‹2ç±»é—®é¢˜</p><ul><li>çº¿ç¨‹ä¸å®‰å…¨. å¦‚æœè¿™ä¸ªå¯¹è±¡çš„ç±»æ²¡æœ‰è®¾è®¡æˆçº¿ç¨‹å®‰å…¨, é‚£ä¹ˆæœ¬èº«åœ¨2ä¸ªä¸åŒçš„çº¿ç¨‹è°ƒç”¨<em>ä»»ä½•</em>æˆå‘˜æ–¹æ³•éƒ½æ˜¯ä¸å®‰å…¨çš„, å› æ­¤<code>deinit</code>å’Œå›è°ƒæ–¹æ³•ä¸¤è€…è‡ªç„¶ä¼šäº§ç”Ÿç«äº‰.</li><li>é‡æŒ‡é’ˆ. æ³¨æ„åˆ°å’Œæ™®é€šçš„æˆå‘˜æ–¹æ³•ä¸åŒ, <code>deinit</code>æœ‰ç‰¹æ®Šæ€§. ä¸€æ—¦<code>deinit</code>å¼€å§‹è°ƒç”¨, æ„å‘³ç€è¿™ä¸ªå¯¹è±¡å·²ç»è¿›å…¥ä¸ç¨³å®šçš„çŠ¶æ€, æ­¤æ—¶è¿™ä¸ªå¯¹è±¡çš„ä»»ä½•å±æ€§/ivarå¯èƒ½éƒ½å¼€å§‹ç“¦è§£. ä¸€æ—¦å¯¹è¿™ä¸ªå¯¹è±¡çš„æˆå‘˜è¿›è¡Œå…¶ä»–æ“ä½œ, ææœ‰å¯èƒ½è®¿é—®åˆ°æ— æ•ˆçš„å†…å­˜åŒºåŸŸ, äº§ç”Ÿæ›´ä¸¥é‡çš„é—®é¢˜.</li></ul><p>è¿™ç¯‡æ–‡ç« , ä¸»è¦æ˜¯åˆ†æä¸Šè¿°2ä¸ªé—®é¢˜ä¸­çš„<em>åè€…</em>æ˜¯å¦å¯èƒ½å‡ºç°. ä¸‹é¢æŠŠé—®é¢˜åˆ†æˆå‡ ç±»æ¥è€ƒè™‘.</p><h3 id="æ— çº¿ç¨‹ç«äº‰"><a class="markdownIt-Anchor" href="#æ— çº¿ç¨‹ç«äº‰"></a> æ— çº¿ç¨‹ç«äº‰</h3><p>ä¹Ÿå°±æ˜¯è¯´<code>deinit</code>è°ƒç”¨å’Œ notification çš„æŠ•é€’å‘ç”Ÿåœ¨ä¸€ä¸ªçº¿ç¨‹çš„æƒ…å†µ.</p><p>å¯ä»¥ç›´æ¥ç»™å‡ºç»“è®º: æ²¡æœ‰é—®é¢˜. è¿™æ˜¯å› ä¸ºå¦‚æœä¸¤è€…æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹å‘ç”Ÿ, é‚£ä¹ˆä¸€å®šæœ‰å…ˆæ¥ååˆ°çš„é¡ºåº, <code>deinit</code>å’ŒæŠ•é€’ notification ä¸å¯èƒ½åŒæ—¶æ‰§è¡Œ.</p><ul><li>å¦‚æœ<code>deinit</code>å…ˆæ‰§è¡Œ, é‚£ä¹ˆ<code>removeObserver</code>ä¼šå…ˆè¢«è°ƒç”¨, æ­¤æ—¶ä¸€ä¸ªè‰¯å¥½<br>çš„<code>NotificationCenter</code>çš„å®ç°å°±ä¼šæ–­å¼€å¯¹è¿™ä¸ªå¯¹è±¡çš„ä»»ä½•å¼•ç”¨, ä¹Ÿå°±ä¿è¯äº†, å½“åç»­äº‹ä»¶äº§ç”Ÿæ—¶, ä¸å¯èƒ½å†é€šçŸ¥/å›è°ƒè¿™ä¸ªå¯¹è±¡.</li><li>å¦‚æœäº‹ä»¶å…ˆäº§ç”Ÿå¹¶æŠ•é€’åˆ°è¿™ä¸ªå¯¹è±¡, å†<code>deinit</code>. åªè¦è¿™ä¸ªå¯¹è±¡å¯¹äº‹ä»¶çš„æ¶ˆè´¹/å“åº”éƒ½æ˜¯ç«‹å³çš„(é å¼‚æ­¥çš„), è‡ªç„¶æ²¡æœ‰ä»»ä½•é—®é¢˜.</li></ul><h3 id="æœ‰çº¿ç¨‹ç«äº‰"><a class="markdownIt-Anchor" href="#æœ‰çº¿ç¨‹ç«äº‰"></a> æœ‰çº¿ç¨‹ç«äº‰</h3><p>ä¹Ÿå°±æ˜¯è¯´<code>deinit</code>è°ƒç”¨å’Œ notification çš„æŠ•é€’ä¸æ˜¯è¿è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹.</p><p>ä¸ºäº†ä¸“æ³¨åˆ†æ, æˆ‘ä»¬å‡è®¾è¿™ä¸ªå¯¹è±¡çš„ç±»å·²ç»æ˜¯è®¾è®¡æˆçº¿ç¨‹å®‰å…¨çš„, ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸åŒçš„çº¿ç¨‹åŒæ—¶è°ƒç”¨è¿™ä¸ªç±»çš„ä¸åŒæ–¹æ³•æœ¬èº«æ²¡æœ‰ä»»ä½•é—®é¢˜. å³å‡è®¾&quot;ä¸ä¼šå› ä¸ºä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹è°ƒç”¨,æœ¬èº«å°±å¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨&quot;.</p><p>å’Œä¸Šé¢&quot;æ— çº¿ç¨‹ç«äº‰&quot;åŒºåˆ«çš„ä¸€ç‚¹æ˜¯, è®¨è®º<code>deinit</code>å’Œäº‹ä»¶æŠ•é€’è°å…ˆè°åå·²ç»æ²¡æœ‰æ„ä¹‰äº†, å› ä¸ºè¿™2ä¸ªè°ƒç”¨æ—¢ç„¶å‘ç”Ÿåœ¨2ä¸ªçº¿ç¨‹, ä¸€å®šæœ‰å¯èƒ½åœ¨æ‰§è¡Œæ—¶é—´ä¸Šé‡å . æˆ‘ä»¬åº”è¯¥è®¨è®ºçš„æ˜¯<code>deinit</code>ä¸­<br>çš„<code>removeObserver</code>è°ƒç”¨æœŸå’Œäº‹ä»¶æŠ•é€’çš„å…ˆåé¡ºåº.<br>åŒæ ·ä¸ºäº†ä¸“æ³¨åˆ†æ, æˆ‘ä»¬è¿˜è¦å‡è®¾çš„æ˜¯<code>NotificationCenter</code>çš„å®ç°ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„, å³&quot;æŸä¸ªäº‹ä»¶äº§ç”Ÿ&quot;å’Œ&quot;è¿™ä¸ªäº‹ä»¶çš„ç›‘å¬è€…è°ƒç”¨<code>removeObserver</code>&quot;å‘ç”Ÿåœ¨ä¸åŒçš„çº¿ç¨‹æ—¶, äº‹ä»¶çš„æŠ•é€’ä¸ä¼šå‡ºç°é—®é¢˜. ä¸€ä¸ªåˆç†çš„<code>NotificationCenter</code>çš„å®ç°åœ¨é‡åˆ°è¿™æ ·çš„æƒ…å†µæ—¶, åº”è¯¥æ ¹æ®å†…éƒ¨åŸå­æ“ä½œå‘ç”Ÿçš„é¡ºåºå†³å®šç›‘å¬è€…èƒ½æ”¶åˆ°è¿™ä¸ªäº‹ä»¶æˆ–æ”¶ä¸åˆ°è¿™ä¸ªäº‹ä»¶.</p><p>è¿™æ—¶å€™, æˆ‘ä»¬å°±éœ€è¦æ·±å…¥è€ƒè™‘<code>NotificationCenter</code>çš„å®ç°äº†. åº”è¯¥æ„è¯†åˆ°ä¸€ä¸ªæ˜¾ç„¶çš„äº‹å®, æ—¢ç„¶å‘ç”Ÿçš„äº‹ä»¶å¯ä»¥é€šçŸ¥åˆ°è¿™ä¸ªå¯¹è±¡, é‚£ä¹ˆ<code>NotificationCenter</code>ä¸€å®šæœ‰ä¸€ä¸ªæŒ‡é’ˆ/å¼•ç”¨æŒ‡å‘è¿™ä¸ªå¯¹è±¡, å› ä¸ºå¦‚æœè¿è¿™ä¸ªå¼•ç”¨éƒ½ä¸å­˜åœ¨, é‚£ä¹ˆæ ¹æœ¬ä¸å¯èƒ½å’Œè¿™ä¸ªå¯¹è±¡äº§ç”Ÿä»»ä½•å…³è”. ä¸‹æ–‡çš„åˆ†æå°±æŒ‰è¿™ä¸ªå¼•ç”¨çš„ç±»å‹æ¥è¿›è¡Œåˆ’åˆ†.</p><h4 id="å¼ºå¼•ç”¨"><a class="markdownIt-Anchor" href="#å¼ºå¼•ç”¨"></a> å¼ºå¼•ç”¨</h4><p>å¦‚æœ<code>NotificationCenter</code>çš„å®ç°, æ˜¯åœ¨<code>addObserver</code>ä¹‹å, ä¿ç•™äº†ä¸€ä¸ªå¯¹è§‚å¯Ÿè€…çš„å¼ºå¼•ç”¨.</p><p>é‚£ä¹ˆ, è‚¯å®šä¸ä¼šäº§ç”Ÿ<em>é‡æŒ‡é’ˆ</em>çš„é—®é¢˜. å› ä¸ºåªè¦<code>NotificationCenter</code>çš„å®ç°è€…æ²¡æœ‰çŠ¯2, è‡ªä½œä¸»å¼ å»æ‰äº†å¯¹äº‹ä»¶ç›‘å¬è€…çš„å¼•ç”¨, é‚£ä¹ˆåœ¨è°ƒç”¨<code>removeObserver</code>ä¹‹å‰, è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸€å®šæ˜¯å¤§äº0çš„.<br>ç„¶è€Œ, å‡è‹¥<code>NotificationCenter</code>çš„å®ç°çœŸçš„ä½¿ç”¨äº†å¼ºå¼•ç”¨æ¥ä¿å­˜ç›‘å¬è€…, é‚£ä¹ˆæˆ‘ä»¬å†ä¹Ÿä¸èƒ½åœ¨ç›‘å¬è€…çš„<code>deinit</code>ä¸­æ‰§è¡Œ<code>removeObserver</code>, ä½†å‡¡åè¦è¿™ä¹ˆåš, å› ä¸ºå¼ºå¼•ç”¨çš„ç¼˜æ•…, è¿™ä¸ª<code>deinit</code>æ°¸è¿œæ²¡æœ‰æœºä¼šè¢«è°ƒç”¨, å†…å­˜å°±æ³„éœ²äº†. æˆ‘ä»¬ä¸å¾—ä¸è€ƒè™‘åœ¨åˆ«çš„åˆé€‚æ—¶æœºä¸»åŠ¨è°ƒç”¨<code>removeObserver</code>, è¿™æ ·å¯¹äºç±»åº“çš„ä½¿ç”¨è€…æ¥è¨€æ˜¯ä¸€ç§è´Ÿæ‹….<br>äº‹å®ä¸Šå®˜æ–¹<code>NotificationCenter</code>ä¹Ÿæ²¡æœ‰å®ç°æˆä½¿ç”¨å¼ºå¼•ç”¨æ¥ä¿å­˜ç›‘å¬è€….</p><h4 id="å¼±å¼•ç”¨"><a class="markdownIt-Anchor" href="#å¼±å¼•ç”¨"></a> å¼±å¼•ç”¨</h4><p>å¦‚æœ<code>NotificationCenter</code>çš„å®ç°, æ˜¯åœ¨<code>addObserver</code>ä¹‹å, ä¿ç•™äº†ä¸€ä¸ªå¯¹è¿™ä¸ªå¯¹è±¡çš„å¼±å¼•ç”¨.</p><p>å¼±åº”ç”¨å’Œå¼ºå¼•ç”¨ä¸åŒ, é‚£ä¹ˆå¯èƒ½å‘ç”Ÿé—®é¢˜ä¸­çš„ç°è±¡å—? å¦‚æœ<code>NotificationCenter</code>åœ¨äº‹ä»¶äº§ç”Ÿåèƒ½é€šçŸ¥åˆ°è¿™ä¸ªå¯¹è±¡, æ„å‘³ç€åœ¨é€šçŸ¥/å›è°ƒçš„ç¬é—´, è¿™ä¸ªå¯¹è±¡è¿˜æ˜¯æ´»ç€çš„. é‚£ä¹ˆå½“å›è°ƒæ–¹æ³•å¼€å§‹è°ƒç”¨ä¹‹å, ä½†å¤„ç†å®Œä¹‹å‰, æœ‰å¯èƒ½æ‰€æœ‰å¯¹è¿™ä¸ªå¯¹è±¡çš„å¼ºå¼•ç”¨æ¶ˆå¤±, ä»è€Œåœ¨å¦ä¸€ä¸ªçº¿ç¨‹è§¦å‘äº†<code>deinit</code>å—?</p><p>æŒ‰<code>removeObserver</code>è°ƒç”¨å’Œäº‹ä»¶æŠ•é€’å‘ç”Ÿçš„å…ˆååˆ†ä¸ºä¸¤ç±».</p><ul><li>å‡å¦‚äº‹ä»¶çš„æŠ•é€’å…ˆäº<code>deinit</code>ä¸­<code>removeObserver</code>æ‰§è¡Œ. é‚£ä¹ˆ, åœ¨äº‹ä»¶äº§ç”Ÿçš„ç¬é—´, å¯¹è±¡ä¸€å®šæ˜¯æ´»ç€çš„, ç„¶åå¯¹è±¡æ— è®ºæ€ä¹ˆå¤„ç†è¿™ä¸ªäº‹ä»¶, åªè¦<code>NotificationCenter</code>ä¿è¯å¯¹è±¡åœ¨å›è°ƒç»“æŸå‰å§‹ç»ˆä¿è¯å¯¹ç›‘å¬è€…æœ‰ä¸€ä¸ª strong å¼•ç”¨, é‚£ä¹ˆåœ¨å¤„ç†å®Œæˆä¹‹å‰, ç›‘å¬è€…<code>deinit</code>æ˜¯ä¸å¯èƒ½è¢«è°ƒç”¨çš„, å› æ­¤ä¸ä¼šäº§ç”Ÿæ—¶åºé‡å . è€Œè¿™æ˜¯å¾ˆå®¹æ˜“ä¿è¯çš„, ä¸€æ–¹é¢æ— è®ºæ˜¯ Swift è¿˜æ˜¯ OC, æ‰€æœ‰æ–¹æ³•è°ƒç”¨å¼€å§‹æ—¶çš„å¼•ç”¨ç±»å‹å…¥å‚é»˜è®¤ +1 reference count, å› æ­¤<code>NotificationCenter</code>æ— è®ºæ˜¯ç›´æ¥å‘ç›‘å¬è€…å‘é€æ–¹æ³•, è¿˜æ˜¯æŠŠç›‘å¬è€…ä½œä¸ºå‚æ•°ä¼ ç»™å›è°ƒæ–¹æ³•, åœ¨æŠ•é€’å®Œæˆå‰éƒ½ä¸ä¼šäº§ç”Ÿé‡æŒ‡é’ˆé—®é¢˜.</li><li>å‡å¦‚<code>deinit</code>ä¸­<code>removeObserver</code>çš„æ‰§è¡Œå…ˆäºäº‹ä»¶æŠ•é€’å‘¢. â€¦äº‹å®ä¸Š, è¿™ä¸ª case æ˜¯ä¸å¯èƒ½å‡ºç°çš„, ä½†å‡ºç°çš„åŸå› å’Œå¼ºå¼•ç”¨çš„æƒ…å†µä¸åŒ, å¹¶ä¸æ˜¯&quot;<code>deinit</code>ä¸å¯èƒ½è¢«è°ƒç”¨&quot;, è€Œæ˜¯äº‹ä»¶ä¸å¯èƒ½å®ŒæˆæŠ•é€’. ARC ä¿è¯, ä¸€æ—¦ä¸€ä¸ªå¯¹è±¡çš„å¼€å§‹é”€æ¯, æ‰€æœ‰å¯¹è¿™ä¸ªå¯¹è±¡çš„å¼±å¼•ç”¨éƒ½ä¼šåœ¨è¿™ä¸ªå¯¹è±¡çš„<code>deinit</code>è°ƒç”¨ä¹‹å‰, ç‡å…ˆè¢«è®¾ç½®æˆ<code>nil</code>. æ¢å¥è¯è¯´, ä¸€æ—¦ç›‘å¬è€…çš„<code>deinit</code>å¼€å§‹è¢«è§¦å‘, å³ä½¿<code>removeObserver</code>æ²¡æœ‰åœ¨ç¬¬ä¸€ æ—¶é—´è¢«è°ƒç”¨, <code>NotificationCenter</code>ä¹Ÿæ²¡æœ‰ä»»ä½•å¯èƒ½æ€§çŸ¥æ™“ç›‘å¬è€…çš„å­˜åœ¨äº†, ä»è€Œæ²¡æœ‰ä»»ä½•åŠæ³•è§¦å‘é€šçŸ¥åˆ°è¿™ä¸ªå¯¹è±¡, é—®é¢˜è‡ªç„¶ä¹Ÿä¸å¯èƒ½äº§ç”Ÿ.</li></ul><p>äº‹å®ä¸Š, æ–°ç‰ˆæœ¬çš„ iOS SDK (<a href="https://stackoverflow.com/questions/41119725/notificationcenter-addobserver/41120287%2341120287" target="_blank" rel="noopener">æ²¡è®°é”™çš„è¯æ˜¯ &gt;= 9.0</a>) ä¸­<code>NotificationCenter</code>å°±æ˜¯ä½¿ç”¨äº†å¯¹ç›‘å¬è€…çš„ weak reference/ç±»ä¼¼æŠ€æœ¯æ¥å®ç°çš„. è¿™æ˜¯çš†å¤§æ¬¢å–œçš„å±€é¢äº†.</p><h4 id="unsafeå¼•ç”¨"><a class="markdownIt-Anchor" href="#unsafeå¼•ç”¨"></a> unsafeå¼•ç”¨</h4><p>æœ€åæ¥è€ƒè™‘ä¸€ä¸‹å½“ä»Š ARC ç¯å¢ƒä¸‹å¾ˆå°‘å‡ºç°, ä½†ä¸æ˜¯ä¸å¯èƒ½çš„æƒ…å†µ: <code>NotificationCenter</code>çš„å®ç°, æ˜¯åœ¨<code>addObserver</code>ä¹‹å, ä¿ç•™äº†ä¸€ä¸ªå¯¹è¿™ä¸ªå¯¹è±¡çš„ unsafe å¼•ç”¨.<br>æ³¨æ„: å³ä½¿æˆ‘ä»¬åœ¨100%ä½¿ç”¨ ARC çš„æƒ…å†µä¸‹ç¼–å†™ iOS ç¨‹åº, ä»ç„¶æœ‰å¯èƒ½é‡åˆ°è¿™ä¸ªæƒ…å†µ, è¿™æ˜¯å› ä¸ºå³ä½¿æˆ‘ ä»¬ä¿è¯æˆ‘ä»¬çš„ä»£ç é‡Œä¸å‡ºç°ä»»ä½• unsafe å¼•ç”¨, æˆ‘ä»¬é“¾æ¥åˆ°çš„å®˜æ–¹ Cocoa ç±»åº“çš„å†…éƒ¨ä»ç„¶æœ‰å¯èƒ½å› ä¸ºå†å²åŸå› ä½¿ç”¨äº† unsafe å¼•ç”¨. äº‹å®ä¸Š, åœ¨æ—§ç‰ˆæœ¬çš„ SDK ä¸­, <code>NotificationCenter</code> åº”è¯¥å°±æ˜¯è¿™æ ·çš„.</p><p><code>NotificationCenter</code>ä¿å­˜å¯¹ç›‘å¬è€…çš„ unsafe å¼•ç”¨, å’Œä½¿ç”¨å¼±å¼•ç”¨ç›¸æ¯”, åŒºåˆ«åœ¨äº: å¦‚æœå¯¹è±¡è¢«é‡Šæ”¾, <code>NotificationCenter</code>ä»ç„¶æœ‰ä¸€ä¸ªé‡æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„å°¸éª¸, å› æ­¤ç¡®å®å¯èƒ½åœ¨<code>deinit</code>å¼€å§‹è°ƒç”¨ä½†åœ¨<code>removeObserver</code>è¢«è°ƒç”¨å‰, äº‹ä»¶æŠ•é€’åˆ°ç›‘å¬è€…, ä½†åœ¨å¤„ç†è¿™ä¸ªäº‹ä»¶çš„è¿‡ç¨‹ä¸­<code>this</code>æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸå·²ç»éƒ¨åˆ†/å…¨éƒ¨å¤±æ•ˆäº†.<br>äº‹å®ä¸Š, åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹è§¦å‘äº†å¯¹è±¡çš„<code>deinit</code>æ˜¯ Cocoa æ—©æœŸå¼€å‘ä¸€ä¸ªç»å…¸çš„å´©æºƒæ¥æº, è¿™ç±»è¢«ç§°ä¸º&quot;The Dealloc Problem&quot;çš„é—®é¢˜å½“æ—¶éå¸¸éš¾ä»¥100%é¿å…. (<a href="https://www.objc.io/issues/2-concurrency/thread-safe-class-design/#the-deallocation-problem" target="_blank" rel="noopener">â€œThe Dealloc Problemâ€</a><a href="https://developer.apple.com/library/archive/technotes/tn2109/_index.html#//apple_ref/doc/uid/DTS40010274-CH1-SUBSECTION11" target="_blank" rel="noopener">å¤šæ•°æƒ…å†µå‘ç”Ÿåœ¨UIKit</a>, å› ä¸ºç›¸å½“ä¸€éƒ¨åˆ†UIKitç»„ä»¶ä¸å…è®¸åœ¨éä¸»çº¿ç¨‹è¢«é‡Šæ”¾, å’Œæ­¤å¤„é—®é¢˜èƒŒåçš„ principle æ˜¯ç›¸å…³çš„.)</p><p>å½“ç„¶ä¹Ÿä¸æ˜¯æ²¡æœ‰è§£å†³åŠæ³•, ä¾‹å¦‚å¯ä»¥:</p><ul><li>æ¶ˆé™¤å¤šçº¿ç¨‹çš„å¯èƒ½æ€§, ä»¥<code>NotificationCenter</code>ä¸ºä¾‹, å®ƒæœ‰<a href="https://developer.apple.com/documentation/foundation/notificationcenter/1411723-addobserver" target="_blank" rel="noopener">ä¸€ä¸ª API</a> å…è®¸æˆ‘ä»¬æŒ‡å®šæ¶ˆæ¯æŠ•é€’å‘ç”Ÿçš„ queue. å³ä½¿æ¶ˆæ¯äº§ç”Ÿåœ¨å¦ä¸€ä¸ª queue, <code>NotificationCenter</code>ä¹Ÿä¼šåœ¨æˆ‘ä»¬æŒ‡å®šçš„ queue å›è°ƒæˆ‘ä»¬çš„æ–¹æ³•, å¦‚æœæˆ‘ä»¬å¯ä»¥ä¿è¯å¯¹è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰æ“ä½œä¹Ÿåœ¨è¿™åŒä¸€ä¸ªçº¿ç¨‹ä¸­è¿›è¡Œ, é‚£ä¹ˆè‡ªç„¶æˆ‘ä»¬å°±ä»æ ¹æœ¬ä¸Šé¿å¼€äº†å¤šçº¿ç¨‹çš„é—®é¢˜.</li><li>å¦ä¸€ä¸ªæ¶ˆé™¤å¤šçº¿ç¨‹çš„æ–¹æ³•, æ˜¯åœ¨<code>deinit</code>ä¸­è¿›è¡Œä¸€äº›é˜»å¡æ“ä½œ. ä¾‹å¦‚å‡è®¾äº‹ä»¶äº§ç”Ÿåœ¨ main thread, ä½†æ˜¯è¿™ä¸ªå¯¹è±¡çš„æœ€åä¸€ä¸ªå¼ºå¼•ç”¨æ¶ˆå¤±åœ¨ non-main thread. æ­¤æ—¶æœ‰äº›äººä¼šé€‰æ‹©åœ¨å¯¹è±¡çš„<code>deinit</code>ä¸­ä½¿<br>ç”¨<code>DispatchQueue.sync()</code> / <code>NSObject.perform(_:on:with:waitUntilDone:)</code> sync åˆ° main thread ç»“æŸæ¥è§„é¿é—®é¢˜. è¯šç„¶è¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥è§£å†³é—®é¢˜, ä½†ä¹Ÿå¸¦æ¥äº† deadlock çš„é£é™©.</li><li>æœ€åä¸€ä¸ªæ–¹å¼æ˜¯æ‰‹åŠ¨å°½æ—©æ¶ˆé™¤<code>NotificationCenter</code>å¯¹ç›‘å¬è€…çš„å¼•ç”¨, ä¾‹å¦‚å°½æ—©(åœ¨ä¿è¯ç›‘å¬è€…ä¸€å®šå­˜æ´»çš„æ—¶å€™)è°ƒç”¨<code>removeObserver</code>æ¥æ–­å¼€ä¸¤è€…çš„å¼•ç”¨. è¿™ç§æ–¹å¼æœ‰æ—¶å€™åªæ˜¯å°½å¯èƒ½å‡å°é—®é¢˜å‘ç”Ÿçš„æ¦‚ç‡ç©ºé—´, è€Œæ²¡æœ‰å®Œå…¨æ¶ˆé™¤é—®é¢˜, å› ä¸ºå¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µä¸‹ä½ éƒ½å¯ä»¥ä¿è¯ä½ è¯´çš„å¤šæ—©æ˜¯ä¸æ˜¯å¤Ÿæ—©.</li></ul><h2 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h2><p>è¯´äº†è¿™ä¹ˆå¤š, å¹¶ä¸æ˜¯è®©æˆ‘ä»¬äººäººè‡ªå±, è®©æˆ‘ä»¬æ€€ç–‘è‡ªå·±å†™çš„æœ€æ™®éæœ€å¹³å®çš„ä»£ç . ä½†ç¡®å®å€¼å¾—æˆ‘ä»¬ä½œ ä¸€äº›æ€è€ƒ, è€Œè¿™äº›æ€è€ƒä¹Ÿè®¸å¯ä»¥å¸®åŠ©åŠ æ·±å¯¹ reference counting, thread safety çš„ç†è§£.</p><p><strong>TL,DR:</strong></p><ul><li>åœ¨ä½¿ç”¨éœ€è¦ä¸»åŠ¨åæ³¨å†Œçš„å›è°ƒæœºåˆ¶æ—¶, æœ‰å¿…è¦æ€è€ƒä¸€ä¸‹è°ƒç”¨åæ³¨å†Œæ–¹æ³•çš„æ—¶æœº. å¦‚æœåœ¨<code>deinit</code>ä¸­è¿›è¡Œåæ³¨å†Œ, å¹¶ä¸æ˜¯å®Œå…¨æ— é£é™©çš„, åœ¨æ¶‰åŠåˆ°å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹, åº”è¯¥æ€è€ƒä¸€ä¸‹å®‰å…¨é—®é¢˜.</li><li>åœ¨æå¤§å¤šæ•°æƒ…å†µä¸‹, å¦‚æœæ¶‰åŠåˆ°å¤šçº¿ç¨‹çš„å›è°ƒ, æˆ‘ä»¬åªè¦ä¿è¯ç›‘å¬æ–¹å’Œè¢«ç›‘å¬æ–¹å„è‡ªçš„ç±»æ˜¯çº¿ç¨‹å®‰å…¨å³å¯. åœ¨ä¸äº§ç”Ÿå¾ªç¯å¼•ç”¨çš„å‰æä¸‹, æ˜¯åœ¨<code>deinit</code>ä¸­åæ³¨å†Œè¿˜æ˜¯åœ¨åˆ«çš„åœ°æ–¹åæ³¨å†Œå¹¶ä¸æ˜¯ä¸€ä¸ª big deal.</li><li>åœ¨é ARC ä¸‹, éœ€è¦ä½œç‰¹æ®Šæ³¨æ„, åœ¨<code>deinit</code>ä¸­åæ³¨å†Œæœ‰å¯èƒ½äº§ç”Ÿ&quot;The Dealloc Problem&quot;. æ­¤æ—¶éœ€è¦ä¸€äº›é¢å¤–çš„æ‰‹æ®µæ¥å°½å¯èƒ½è§„é¿é—®é¢˜. æ„Ÿè°¢ä¸Šå¸, <a href="https://stackoverflow.com/questions/13910613/nsnotificationcenter-removeobserver-in-dealloc-and-thread-safety" target="_blank" rel="noopener">è¿™ç±»é—®é¢˜</a>ç°åœ¨å·²ç»éå¸¸ç½•è§äº†.</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;ul class=&quot;markdownIt-TOC&quot;&gt;
&lt;li&gt;&lt;a href=&quot;#%E8%83%8C%E6%99%AF&quot;&gt;èƒŒæ™¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%88%86%E6%9E%90&quot;&gt;åˆ†æ&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%97%A0%E7%BA%BF%E7%A8%8B%E7%AB%9E%E4%BA%89&quot;&gt;æ— çº¿ç¨‹ç«äº‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%9C%89%E7%BA%BF%E7%A8%8B%E7%AB%9E%E4%BA%89&quot;&gt;æœ‰çº¿ç¨‹ç«äº‰&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%BC%BA%E5%BC%95%E7%94%A8&quot;&gt;å¼ºå¼•ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%BC%B1%E5%BC%95%E7%94%A8&quot;&gt;å¼±å¼•ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#unsafe%E5%BC%95%E7%94%A8&quot;&gt;unsafeå¼•ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%80%BB%E7%BB%93&quot;&gt;æ€»ç»“&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;åŸæ–‡æˆäº2017å¹´11æœˆ&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#èƒŒæ™¯&quot;&gt;&lt;/a&gt; èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;æœ€è¿‘åœ¨æµè§ˆ Swift Talk çš„è¿‡ç¨‹ä¸­, æ€è€ƒäº†ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜.&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªå¯¹è±¡é€šè¿‡&lt;code&gt;NotificationCenter&lt;/code&gt;æ³¨å†Œäº†ä¸€ä¸ªé€šçŸ¥, ç„¶ååœ¨è¿™ä¸ªå¯¹è±¡çš„&lt;code&gt;deinit&lt;/code&gt;æ–¹æ³•ä¸­æ‰§è¡Œäº†&lt;code&gt;removeObserver&lt;/code&gt;. å‡å¦‚åœ¨å¯¹è±¡è°ƒç”¨&lt;code&gt;deinit&lt;/code&gt;çš„è¿‡ç¨‹ä¸­å¯¹åº”çš„äº‹ä»¶å‘ç”Ÿäº†, å¹¶äº§ç”Ÿäº†ä¸€ä¸ªé€šçŸ¥, æ­¤æ—¶ä¼šæœ‰ä»€ä¹ˆç°è±¡? å½“äº‹ä»¶å‘ç”Ÿ/æŠ•é€’çš„çº¿ç¨‹å’Œå¯¹è±¡&lt;code&gt;deinit&lt;/code&gt;çš„çº¿ç¨‹ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹æ—¶, ä¼šå¯¼è‡´å´©æºƒå—? &lt;a href=&quot;https://talk.objc.io/episodes/S01E28-typed-notifications-part-2&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Swift Talk #28æœ€å5åˆ†é’Ÿå†…å®¹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜æˆ‘è§‰å¾—å¾ˆæœ‰æ„æ€, ä¹‹å‰éƒ½æ²¡æœ‰æ„è¯†åˆ°è¿‡.&lt;/p&gt;
&lt;p&gt;äº‹å®ä¸Šè™½ç„¶è¿™ä¸ªé—®é¢˜æ˜¯åœ¨&amp;quot;Swift Talk&amp;quot;ä¸­æŠ›å‡º, ä½†æ˜¯å¹¶ä¸æ˜¯Swiftç‹¬æœ‰çš„, OC ä¸‹çš„&lt;code&gt;dealloc&lt;/code&gt;æ–¹æ³•åŒæ ·æœ‰è¿™ä¸ªé—®é¢˜. å¦å¤–, è™½ç„¶é—®é¢˜æ˜¯ä»¥ Notification ä¸ºä¾‹, ä½†æ˜¾ç„¶é—®é¢˜å¹¶ä¸é™äºé€šçŸ¥, ä»»ä½•åˆ«çš„å«æœ‰é€šçŸ¥/å›è°ƒæœºåˆ¶çš„åœºæ™¯éƒ½ä¼šé¢ä¸´åŒæ ·çš„é—®é¢˜.&lt;/p&gt;</summary>
    
    
    
    <category term="Apple Platforms" scheme="https://crystdragon.github.io/categories/apple-platforms/"/>
    
    <category term="Architecture" scheme="https://crystdragon.github.io/categories/architecture/"/>
    
    
    <category term="Thread Safety" scheme="https://crystdragon.github.io/tags/thread-safety/"/>
    
    <category term="ARC" scheme="https://crystdragon.github.io/tags/arc/"/>
    
    <category term="NotificationCenter" scheme="https://crystdragon.github.io/tags/notificationcenter/"/>
    
  </entry>
  
  <entry>
    <title>Swift Practices &amp; Perls (1)</title>
    <link href="https://crystdragon.github.io/2020/swift-practices-perls-1/"/>
    <id>https://crystdragon.github.io/2020/swift-practices-perls-1/</id>
    <published>2020-07-23T15:23:51.000Z</published>
    <updated>2020-11-12T11:37:44.119Z</updated>
    
    <content type="html"><![CDATA[<p><ul class="markdownIt-TOC"><li><a href="#%E6%99%AE%E9%80%9A-practices">æ™®é€š Practices</a><ul><li><a href="#availability-checks">Availability checks</a></li><li><a href="#%E6%B4%BB%E7%94%A8-string-backed-enum">æ´»ç”¨ â€œString-backedâ€ enum</a><ul><li><a href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86">èƒŒæ™¯çŸ¥è¯†</a></li><li><a href="#%E6%A1%88%E4%BE%8B">æ¡ˆä¾‹</a></li></ul></li></ul></li><li><a href="#tricks-patterns">Tricks &amp; Patterns</a><ul><li><a href="#%E7%BB%99-protocol-%E5%A2%9E%E5%8A%A0-recursive-constraints-before-swift-41">ç»™ protocol å¢åŠ  recursive constraints (before Swift 4.1)</a></li><li><a href="#%E6%B3%9B%E5%9E%8B%E5%AF%B9%E8%B1%A1%E6%8E%92%E9%99%A4%E7%89%B9%E4%BE%8B%E8%B0%83%E7%94%A8">æ³›å‹å¯¹è±¡æ’é™¤ç‰¹ä¾‹è°ƒç”¨</a><ul><li><a href="#%E9%97%AE%E9%A2%98">é—®é¢˜</a></li><li><a href="#%E5%9C%BA%E6%99%AF">åœºæ™¯</a></li><li><a href="#%E5%AE%9E%E7%8E%B0">å®ç°</a></li></ul></li><li><a href="#%E6%B3%9B%E5%9E%8B%E7%B1%BB%E5%9E%8B%E6%8C%89%E6%9D%A1%E4%BB%B6%E9%81%B5%E5%BE%AA-protocol-before-swift-41">æ³›å‹ç±»å‹æŒ‰æ¡ä»¶éµå¾ª protocol (before Swift 4.1)</a></li></ul></li></ul></p><hr><p>åŸæ–‡æˆäº2018å¹´</p><hr><p>æœ¬æ–‡ç§¯ç´¯å­¦ä¹  Swift è¿‡ç¨‹ä¸­è·å–åˆ°çš„å¥½æŠ€å·§, ä»¥åŠ Swift Standard Library ä½¿ç”¨çš„ä¼˜ç§€èŒƒå¼ (tricks).</p><h2 id="æ™®é€š-practices"><a class="markdownIt-Anchor" href="#æ™®é€š-practices"></a> æ™®é€š Practices</h2><h3 id="availability-checks"><a class="markdownIt-Anchor" href="#availability-checks"></a> Availability checks</h3><p>ä½¿ç”¨ availability checks å°†è¶…å‡ºæŒ‡å®šçš„&quot;Base SDK&quot;ç‰ˆæœ¬çš„ä»£ç å—éš”ç¦»èµ·æ¥. åœ¨è¿è¡Œæ—¶, ç³»ç»Ÿä¼šæ ¹æ®è¿è¡Œç¯å¢ƒåŠ¨æ€ check è¯¥ä»£ç æ˜¯å¦æ‰§è¡Œ.</p><ul><li><code>@available(iOS 9.0, *)</code>, method, type å®šä¹‰æ—¶.</li><li><code>if #available(iOS 9.0, *)</code>, ä½¿ç”¨ method, type æ—¶.</li><li>æ”¯æŒ guard ä½œä¸º early exit.</li></ul><p>å¯ä»¥æ›¿ä»£ç›¸å¯¹åº”çš„æ—©æœŸçš„ä»¥ä¸‹è°ƒç”¨:<br><code>UIDevice.current.systemVersion.compare(&quot;9.0&quot;, options: .numeric) == .orderedAscending</code></p><h3 id="æ´»ç”¨-string-backed-enum"><a class="markdownIt-Anchor" href="#æ´»ç”¨-string-backed-enum"></a> æ´»ç”¨ â€œString-backedâ€ enum</h3><h4 id="èƒŒæ™¯çŸ¥è¯†"><a class="markdownIt-Anchor" href="#èƒŒæ™¯çŸ¥è¯†"></a> èƒŒæ™¯çŸ¥è¯†</h4><p>åœ¨ä¼—å¤šåŸºäº raw value çš„ enum ä¸­, raw value æ˜¯<code>String</code>çš„æœ€ä¸ºç‰¹æ®Š, å› ä¸ºè¿™æ ·çš„ enum åœ¨å®šä¹‰å„ä¸ª case æ—¶, å¯ä»¥çœå»æ˜¾å¼å†™å‡ºç”¨æ¥åˆå§‹åŒ–è¯¥ enum çš„ raw value. è¿™ç§æƒ…å†µä¸‹, ç¼–è¯‘å™¨é»˜è®¤è¿½åŠ ä»£ç , ä½¿ç”¨å„ä¸ª case identifier çš„åŒåå­—ç¬¦ä¸²ä½œä¸º raw value.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å„è¡Œ case å¯ä»¥çœç•¥ // ä¹‹åçš„éƒ¨åˆ†</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ImageIdentifier</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">  <span class="keyword">case</span> centerButton <span class="comment">// = "centerButton"</span></span><br><span class="line">  <span class="keyword">case</span> myFavorites <span class="comment">// = "myFavorites"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦ä¸€æ–¹é¢, è¿™æ ·çš„ enum é»˜è®¤éµå¾ª<code>RawRepresentable</code>, ä¸”å…³è”ç±»å‹<code>RawValue == String</code>. è¿™æ–¹ä¾¿æˆ‘ä»¬å¯¹äºä¸€ç³»åˆ—æœ‰ç›¸åŒç‰¹å¾çš„ enum ä¾é  protocol æä¾›ç»Ÿä¸€æ“ä½œ.</p><h4 id="æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#æ¡ˆä¾‹"></a> æ¡ˆä¾‹</h4><p>ä¸‹è¿°æŠ€å·§æœ€æ—©å‡ºç°äº<a href="https://web.archive.org/web/20200108191946/https://developer.apple.com/videos/play/wwdc2015/411/" target="_blank" rel="noopener">WWDC 2015, session 403</a>.<br>è¯¥ video å·²ç»è¢« apple ä»å…¬å¼€åˆ—è¡¨ä¸­ç§»é™¤, æ­¤å¤„æä¾›çš„æ˜¯ web.archive ä¸Šçš„ç¼“å­˜.<br>ä¹Ÿå¯ä»¥å°è¯•ç›´æ¥è·å– <a href="https://devstreaming-cdn.apple.com/videos/wwdc/2015/4119flfsnsgmlfy/411/411_hd_swift_in_practice.mp4?dl=1" target="_blank" rel="noopener">video</a> å’Œ <a href="https://devstreaming-cdn.apple.com/videos/wwdc/2015/4119flfsnsgmlfy/411/411_swift_in_practice.pdf?dl=1" target="_blank" rel="noopener">pdf</a>.</p><a id="more"></a><p>åœ¨ä½¿ç”¨ segue çš„ app ä¸­æ¯ä¸€ä¸ª<code>UIViewController</code>éƒ½å«æœ‰ä¸€ç»„ segue identifier, é€šè¿‡è°ƒç”¨<code>func performSegue(withIdentifier identifier: String, sender: Any?)</code>æ¥æ‰§è¡Œé¡µé¢è·³è½¬.</p><p>ä½†æ˜¯ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•æœ‰é£é™©: ä¼ å…¥çš„<code>identifier</code>æœ‰å¯èƒ½æœ‰æ‹¼å†™é”™è¯¯. å› æ­¤å®¹æ˜“æƒ³åˆ°, å®šä¹‰ä¸€ä¸ªä½¿ç”¨<code>String</code>ä½œä¸º raw value çš„ enum, å¹¶åŒæ—¶ç»™<code>UIViewController</code>å¢åŠ ä¸€ä¸ªæ¥å—è¯¥ enum çš„é‡è½½æ–¹æ³•.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">SegueIdentifier</span>: <span class="title">String</span></span>&#123;</span><br><span class="line">  <span class="keyword">case</span> jumpToHome</span><br><span class="line">  <span class="keyword">case</span> jumpToMyFavorites</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">HomeViewController</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">performSegue</span><span class="params">(identifer: SegueIdentifier)</span></span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.performSegue(withIdentifier: identifer.rawValue, sender: <span class="literal">nil</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨æ—¶</span></span><br><span class="line">performSegue(identifer: .jumpToHome)</span><br></pre></td></tr></table></figure><p>ä½†ä»…ä»…å¦‚æ­¤, æœ‰å¤šä¸ªå‰¯ä½œç”¨</p><ul><li>ä¸åŒçš„ view controller ç†æ‰€å½“ç„¶æœ‰ä¸åŒçš„ segue, å› æ­¤åº”è¯¥ç»™ä¸åŒçš„ view controller å®šä¹‰ä¸åŒçš„<code>SegueIdentifier</code> enum, ä½¿ä»–ä»¬å½¼æ­¤ç‹¬ç«‹</li><li>æ—¢ç„¶å¿…é¡»å­˜åœ¨å¤šä¸ª<code>SegueIdentifier</code> å½¼æ­¤ç‹¬ç«‹, é‚£ä¹ˆå°±ä¸å¾—ä¸é’ˆå¯¹æ¯ç§<code>SegueIdentifier</code>å•ç‹¬æä¾›ä¸€ä¸ª<code>performSegue</code>çš„é‡è½½æ–¹æ³•</li></ul><p>å¯ä»¥çœ‹åˆ°è¿™æ ·è™½ç„¶æä¾›äº†ä¸€ç§ type safe çš„è°ƒç”¨æ–¹æ³•, ä½†æ˜¯æ˜¾è‘—å¢åŠ äº†å·¥ä½œé‡. ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, å¯ä»¥æŠ½è±¡å‡ºä¸€ä¸ª protocol, è¡¨ç¤ºåŒ…å«<code>SegueIdentifier</code>çš„ view controller, è¿›è€Œé’ˆå¯¹è¯¥ protocol ç»Ÿä¸€å¢åŠ ä¸€ä¸ªæ–¹æ³•å³å¯.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œä½¿ç”¨çš„ swift è¯­æ³•, å¯ä»¥ç›´æ¥ç»™ protocol çš„éµå¾ªè€…å¢åŠ çº¦æŸ</span></span><br><span class="line"><span class="comment">// åœ¨æœ€åˆçš„ WWDC session ä¸­è¿˜ä¸æ”¯æŒè¿™ä¹ˆåš</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SegueNavigation</span> <span class="title">where</span> <span class="title">Self</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">SegueIdentifier</span>: <span class="type">RawRepresentable</span> <span class="keyword">where</span> <span class="type">SegueIdentifier</span>.<span class="type">RawValue</span> == <span class="type">String</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">performSegue</span><span class="params">(identifier: SegueIdentifier)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SegueNavigation</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">performSegue</span><span class="params">(identifier: SegueIdentifier)</span></span> &#123;</span><br><span class="line">    performSegue(withIdentifier: identifier.rawValue, sender: <span class="literal">nil</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶, åªè¦ä»»æ„<code>UIViewController</code>, é€šè¿‡æä¾›è‡ªå·± local çš„<code>SegueIdentifier</code>, å°±å¯ä»¥éµå¾ª<code>SegueNavigation</code>, è¿›è€Œå¯ä»¥è°ƒç”¨ type safe çš„<code>func performSegue(identifier: SegueIdentifier)</code>æ–¹æ³•.</p><h2 id="tricks-patterns"><a class="markdownIt-Anchor" href="#tricks-patterns"></a> Tricks &amp; Patterns</h2><p>ç”±äº Swift è¯­è¨€åœ¨ä¸æ–­å˜åŒ–ä¹‹ä¸­, å¾ˆå¤šå°†æ¥åŠ å…¥çš„è¯­æ³•ç‰¹æ€§åœ¨å½“ä¸‹ç‰ˆæœ¬æ²¡æœ‰ç›´æ¥å¯¹åº”çš„è¡¨è¾¾æ–¹å¼. ä½†å‡­å€Ÿ Swift å·²æœ‰çš„ä¸°å¯Œçš„ generics å’Œ protocol è¡¨è¾¾æŠ€å·§, å¯ä»¥å®ç°ä¸€äº›ç­‰ä»·çš„åŠŸèƒ½ (è™½ç„¶å¯èƒ½å¹¶ä¸ä¼˜é›…).</p><h3 id="ç»™-protocol-å¢åŠ -recursive-constraints-before-swift-41"><a class="markdownIt-Anchor" href="#ç»™-protocol-å¢åŠ -recursive-constraints-before-swift-41"></a> ç»™ protocol å¢åŠ  recursive constraints (before Swift 4.1)</h3><p>å®šä¹‰ Swift çš„ protocol æ—¶, å¯ä»¥è¦æ±‚éµå¾ªè€…åŒæ—¶æä¾›<code>associatedtype</code>, è¯¥<code>associatedtype</code>å¯ä»¥é™„å¸¦ä¸€äº›é¢å¤–çº¦æŸ, ä¾‹å¦‚<code>: SomeType</code>, <code>where ...</code>. å½“å‰ç‰ˆæœ¬ä¸‹, è¿™æ ·çš„çº¦æŸå†…å…è®¸é€’å½’å¼•ç”¨åˆ° protocol æœ¬èº«<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">T</span>: <span class="type">A</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å…è®¸ associated type é€’å½’å¼•ç”¨å‰, ä¸ºäº†å®ç°è¯¥åŠŸèƒ½, ä½¿ç”¨äº†ä»¥ä¸‹æŠ€å·§.</p><p>(1) å…ˆå®šä¹‰ä¸€ä¸ªå’Œ<code>A</code>æœ‰ç›¸åŒæ¥å£æˆ–å¤§éƒ¨åˆ†å…³é”®æ¥å£çš„&quot;éšå½¢ protocol&quot;.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">__PrivateA</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è¿™é‡ŒåŒ…å«äº† A æœ¬æ¥çš„æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(2) ç„¶åä½¿<code>A</code>æœ¬èº«ç»§æ‰¿è¿™ä¸ª protocol, å¹¶è¦æ±‚ associatedtype ä¹Ÿéµå¾ªè¿™ä¸ª protocol.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">A</span>: <span class="title">__PrivateA</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">T</span>: __PrivateA</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(3) æ­¤æ—¶æ‰€æœ‰å¼•ç”¨<code>A</code>å’Œ<code>A.T</code>çš„åœ°æ–¹, éƒ½å¯ä»¥è°ƒç”¨åˆ° <code>__PrivateA</code> ä¸­çš„é‚£äº›æ–¹æ³•äº†</p><p>è¿™ç§é¿å…æ˜¾å¼å‡ºç° recursion çš„æ–¹å¼, è™½ç„¶å¯ä»¥è§£å†³è¯­æ³•é—®é¢˜, ä½†å¸¦æ¥çš„åæœå°±æ˜¯å¤šäº†ä¸å¾—ä¸æš´éœ²ç»™ç”¨æˆ·çš„ä¸­é—´å±‚. åœ¨ Swift 4.1 ä¹‹å‰çš„æ ‡å‡†åº“ä¸­, <code>Collection</code> å°±é€šè¿‡è¯¥æŠ€å·§å®šä¹‰äº†<code>SubSequence</code>å’Œ<code>Indices</code>è¿™2ä¸ª associated type. è¯šç„¶è¿™ä¹Ÿç»™å½“æ—¶çš„å­¦ä¹ è€…å¸¦æ¥äº†ä¸€äº›å›°éš¾:</p><ul><li>å¤ªå¤š protocol, ä¸å®¹æ˜“ç†æ¸…ç±»åº“å…³è”æ€§.</li><li>è¿™ç§å¼•å…¥çš„ä¸­é—´å±‚ protocol è¯­æ³•ä¸Šæ¥è®²æ˜¯å¯è§çš„, ä½†æ˜¯æ ‡å‡†åº“åœ¨å¯¼å‡º interface æ—¶æœ‰ä¸€ä¸ª hack æ­¥éª¤: æŠŠæ‰€æœ‰&quot;__&quot;å¼€å¤´çš„å£°æ˜ strip æ‰äº†, æ­¤æ—¶è¿™ä¸ªæ–¹æ³•å¯ä»¥è¢«è°ƒç”¨, ä½†ä¸ä¼šå‡ºç°åœ¨ interface å’Œ documentation é‡Œ. è¿™åè€Œå¯¼è‡´è¿™ä¸ª protocol ä¸­çš„æŸäº›å…³é”®æ–¹æ³•æ— æ³•è¢«ä½¿ç”¨è€…æ³¨æ„åˆ°. ä¾‹å¦‚<code>Collection</code>ä¸­æœ‰ä¸€ä¸ªå…³é”®æ–¹æ³•<code>func index(after i: Index) -&gt; Index</code>, åœ¨å½“æ—¶æ­£å› ä¸ºå®šä¹‰åœ¨å®ç°æ­¤ trick å¯¹åº”çš„<code>_IndexableBase</code>ä¸­, å¯¼è‡´æ— æ³•åœ¨æ–‡æ¡£ä¸­æŸ¥è¯¢.</li></ul><h3 id="æ³›å‹å¯¹è±¡æ’é™¤ç‰¹ä¾‹è°ƒç”¨"><a class="markdownIt-Anchor" href="#æ³›å‹å¯¹è±¡æ’é™¤ç‰¹ä¾‹è°ƒç”¨"></a> æ³›å‹å¯¹è±¡æ’é™¤ç‰¹ä¾‹è°ƒç”¨</h3><h4 id="é—®é¢˜"><a class="markdownIt-Anchor" href="#é—®é¢˜"></a> é—®é¢˜</h4><p>ä¸€èˆ¬è€Œè¨€, ç»å¸¸éœ€è¦åœ¨æ³›å‹ç±»å‹çš„æ¨¡æ¿å‚æ•°æ»¡è¶³æŸä¸ªæ¡ä»¶æ—¶, å¢åŠ ä¸€äº›ç‰¹ä¾‹è°ƒç”¨. è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡å¸¦é™åˆ¶æ¡ä»¶çš„ extension ç»™è¿™ä¸ªç±»å‹æ‰©å±•æ–¹æ³•.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Container</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Container</span> <span class="title">where</span> <span class="title">T</span> == <span class="title">Int</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">special</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Container</span>&lt;<span class="type">Int</span>&gt;().special()<span class="comment">// OK</span></span><br><span class="line"><span class="type">Container</span>&lt;<span class="type">Double</span>&gt;().special()<span class="comment">// Compiler Error!</span></span><br><span class="line"><span class="type">Container</span>&lt;<span class="type">String</span>&gt;().special()<span class="comment">// Compiler Error!</span></span><br></pre></td></tr></table></figure><p>è¿™è¾¹æå‡ºçš„æ˜¯ä¸€ä¸ªåå‘é—®é¢˜: å¯¹äºæŸä¸ªæ³›å‹ç±»å‹, è¦æ±‚æ¨¡æ¿å‚æ•°åœ¨æŸä¸ªæ¡ä»¶ä¸‹, ä¸èƒ½è°ƒç”¨æŸä¸ªæ–¹æ³•. è¿™ä¸ªä¹çœ‹ Swift ä¸å¯èƒ½æ”¯æŒçš„éœ€æ±‚, åœ¨æŸç§ç¨‹åº¦ä¸Šå¯ä»¥å®ç°.</p><h4 id="åœºæ™¯"><a class="markdownIt-Anchor" href="#åœºæ™¯"></a> åœºæ™¯</h4><p>è¿™ä¸ªéœ€æ±‚è²Œä¼¼ä¸ç¬¦åˆé€»è¾‘, ä½† Swift Standard Library ä¸­å°±æœ‰æ›¾ç»æœ‰ä¸ªè¿™æ ·çš„ä¾‹å­. åœ¨ä¹‹å‰ç‰ˆæœ¬çš„ Swift ä¸­, <code>CountableRange</code>ç”¨æ¥è¡¨ç¤ºå¯ä»¥ç¦»æ•£å–å€¼çš„é—­åŒºé—´. ä¾‹å¦‚<code>0..&lt;10</code>å°±æ˜¯ä¸€ä¸ª<code>CountableRange</code>. å¾ˆè‡ªç„¶åœ°, <code>CountableRange</code>å¯ä»¥éµå¾ª<code>Collection</code>. æ—¢ç„¶å¯ä»¥éµå¾ª<code>Collection</code>, é‚£ä¹ˆæ¥ä¸‹æ¥å°±éœ€è¦ç¡®å®š<code>CountableRange</code>çš„<code>Index</code>.</p><p>åœ¨ Swift ä¸­, ä¸€ä¸ª<code>Collection</code>çš„<code>Index</code>, ä¸ä¸€å®šä¸º<code>Int</code>; å³ä½¿æ˜¯<code>Int</code>, ä¹Ÿä¸ä¸€å®šä»0å¼€å§‹. å¹¶ä¸”, <code>Collection</code>å’Œå…¶<code>SubSequence</code>ä¹‹é—´, åº”è¯¥å­˜åœ¨<code>Index</code>çš„å¤ç”¨å…³ç³». ä¾‹å¦‚:</p><ul><li><code>Array</code>çš„<code>SubSequence</code>: <code>ArraySlice</code>, å¤ç”¨<code>Array</code>çš„ index, å³<code>[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;].dropFirst()</code>çš„<code>startIndex</code>æ˜¯1, è€Œä¸æ˜¯0.</li><li><code>String</code>çš„<code>SubSequence</code>: <code>SubString</code>, å¤ç”¨<code>String</code>çš„ index, å³<code>&quot;hello word&quot;.prefix(6)</code>çš„<code>endIndex</code>, åœ¨åŸæ¥ string ä¸­å¯ä»¥ç´¢å¼•å‡º&quot;w&quot;.</li></ul><p><code>CountableRange</code>ä¹Ÿåº”å¦‚æ­¤, é‚£ä¹ˆ<code>(-10..&lt;10)[0]</code> åº”è¯¥æ˜¯å¤šå°‘å‘¢, å¦‚æœæŠŠ<code>CountableRange</code>çš„<code>firstIndex</code>ä¸€å¾‹å®šä½0, é‚£ä¹ˆä¸Šè¿°è¡¨è¾¾å¼ä¼šè¿”å› range ä¸­çš„ç¬¬ä¸€ä¸ªå€¼&quot;-10&quot;. ä½†è¿™æ˜¯ä¸ç¬¦åˆ<code>Collection</code>çº¦å®šçš„, å› ä¸º<code>(-10..&lt;10).dropFirst()</code>çš„ç»“æœ<code>-9..&lt;10</code>, ä»ç„¶æ˜¯ä¸€ä¸ª<code>CountableRange</code>. ä½†å®ƒçš„<code>firstIndex</code>æ˜¾ç„¶ä¸åº”è¯¥æ˜¯0, å› ä¸º<code>(-9..&lt;10)[0]</code>ä¼šè¿”å›9, è¿™å°±è¿å<code>Collection</code>å’Œ<code>SubSequence</code>ä¸­, åŒä¸€ä¸ª index åº”è¯¥å–å¾—åŒæ ·çš„ element è¿™ä¸ªçº¦å®š.</p><p>æ‰€ä»¥ Swift Standard Library å†³å®š, é’ˆå¯¹ä¸€ä¸ª<code>CountableRange</code>: <code>a..&lt;b</code>, ä½¿ç”¨<code>a</code>ä½œä¸ºå…¶ <code>firstIndex</code>, ä»è€Œ<code>(a..&lt;b)[a] == a</code>. è¿™ä¸€ä¸ªç†æ€§ä½†ä¹Ÿè®¸å‡ºäººæ„æ–™çš„è¡¨ç°, ç¡®å®å¯èƒ½å¯¼è‡´ä¸€éƒ¨åˆ†äººçš„å›°æƒ‘. äºæ˜¯ Swift æ ‡å‡†åº“é‡‡å–äº†è¿™æ ·çš„åŠæ³•: å½“<code>CountableRange</code>çš„æ³›å‹å‚æ•°å°±æ˜¯<code>Int</code>æ—¶, ç¦æ­¢è°ƒç”¨<code>subscript</code>, å½“æ³›å‹å‚æ•°ä¸æ˜¯<code>Int</code>æ—¶, æ²¡è¿™ä¸ªé—®é¢˜, å› ä¸ºæœ¬èº«ä¸‹æ ‡å°±ä¸ä¼šæ˜¯0, å› æ­¤ä¸ä¼šå‡ºç°ç†è§£é—®é¢˜.</p><h4 id="å®ç°"><a class="markdownIt-Anchor" href="#å®ç°"></a> å®ç°</h4><p>è¿™ä¸ª trick åœ¨ Swift æ ‡å‡†åº“æºç çš„å®ç°ä¸­ç§°ä¸º: â€œStatically Unavailable &amp; Dynamically Availableâ€. æ¢è¨€ä¹‹, è¿™ä¸ªæ–¹æ³•åŠ¨æ€æ˜¯å­˜åœ¨çš„, ä½†æ˜¯ä½ çš„é™æ€ä»£ç æ— æ³•è°ƒåˆ°.</p><p>è€ƒè™‘ä¸€èˆ¬çš„æƒ…å†µ</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Container</span>&lt;<span class="title">T</span>: <span class="title">Equatable</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(<span class="number">_</span> t: T)</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¦æ±‚ T == Int æ—¶, æ— æ³•è°ƒç”¨ check</span></span><br><span class="line"><span class="type">Container</span>&lt;<span class="type">Int</span>&gt;().check(<span class="number">1</span>)   <span class="comment">// æœŸæœ› Compiler Error</span></span><br><span class="line"><span class="type">Container</span>&lt;<span class="type">String</span>&gt;().check(<span class="string">""</span>)   <span class="comment">// OK</span></span><br><span class="line"><span class="type">Container</span>&lt;<span class="type">Double</span>&gt;().check(<span class="number">1</span>)  <span class="comment">// OK</span></span><br></pre></td></tr></table></figure><p>å…·ä½“å®ç°åŸç†æ˜¯: åœ¨ç‰¹å®šæƒ…å†µä¸‹, é’ˆå¯¹ä¸å…è®¸è°ƒç”¨çš„æ–¹æ³•å®šä¹‰ä¸€ä¸ªç‰¹æ®Šçš„é‡è½½, ä½¿ç”¨æˆ·è°ƒç”¨è¯¥æ–¹æ³•æ—¶, ä¼šå‡ºç°äºŒä¹‰æ€§, ä»è€Œæ— æ³•é€šè¿‡ç¼–è¯‘.</p><p>(1) é¦–å…ˆç»™<code>Container</code>çš„æ³›å‹å‚æ•°çš„æ¡ä»¶ä¸­, æ’å…¥ä¸€ä¸ªç‰¹æ®Šçš„æ ‡è®°, è¿™ä¸ªæ ‡è®°é»˜è®¤æŒ‡å‘ä¸€ä¸ªäººç•œæ— å®³çš„ç±»å‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">__UnavailableFlag</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SpecialEquatable</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> _Unavailable = __UnavailableFlag</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(2) æ¥ç€é’ˆå¯¹æƒ³ç‰¹æ®Šå¤„ç†çš„æ³›å‹ç±»å‹, æ”¹å†™è¿™ä¸ªæ ‡è®°, ä½¿ä¹‹å¼•ç”¨è‡ªèº«</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Int</span>: <span class="title">SpecialEquatable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">typealias</span> _Unavailable = <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Double</span>: <span class="title">SpecialEquatable</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span>: <span class="title">SpecialEquatable</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>(3) ç»™æˆ‘ä»¬çš„æ³›å‹ç±»å‹, å¢åŠ ä¸€ä¸ªé‡è½½, ä½¿ä»…é’ˆå¯¹æˆ‘ä»¬è¦è§„é¿çš„å‚æ•°ç±»å‹, äº§ç”ŸäºŒä¹‰æ€§</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Container</span>&lt;<span class="title">T</span>: <span class="title">SpecialEquatable</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(<span class="number">_</span> t: T)</span></span> &#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(<span class="number">_</span> t: T._Unavailable)</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶, å½“æˆ‘ä»¬è°ƒç”¨<code>Container.check</code>æ—¶, å½“ä¸”ä»…å½“<code>T == Int</code>æ—¶, å› ä¸º<code>Int._Unavailable == Int</code>, å› æ­¤åŒæ—¶å‘½ä¸­2ä¸ª<code>check</code>æ–¹æ³•, ä¸”æ¯«æ— ä¼˜å…ˆçº§åŒºåˆ«, å¯¼è‡´ç¼–è¯‘å¤±è´¥; è€Œå½“<code>T</code>æ˜¯å…¶ä»–ç±»å‹æ—¶, æ­¤æ—¶<code>T._Unavailable == __UnavailableFlag</code>, è€Œ<code>__UnavailableFlag</code>æ˜¯ä¸€ä¸ª non-inhabitant type, åˆç§° â€œcaseless-enumâ€, å› æ­¤è°ƒç”¨è€…ä¸å¯èƒ½äº§ç”Ÿä¸€ä¸ªè¿™æ ·ç±»å‹çš„å®ä¾‹, å› æ­¤æ°¸è¿œä¸å¯èƒ½äº§ç”ŸäºŒä¹‰æ€§.</p><p>éœ€è¦è¯´æ˜çš„æ˜¯, åœ¨ä¸Šé¢çš„å®ç°ä¸­æˆ‘ä»¬æŠŠ<code>Container&lt;T: Equatable&gt;</code>æ”¹å†™æˆäº†<code>Container&lt;T: SpecialEquatable&gt;</code>, è¿™ä¼šå¯¼è‡´æˆ‘ä»¬ä¸å¾—ä¸æŠŠæ‰€æœ‰ç±»å‹éƒ½é‡æ–°éµå¾ª<code>SpecialEquatable</code>æ‰èƒ½ä½¿ä¹‹ç”¨äº<code>Container</code>.<br>è€Œåœ¨æ ‡å‡†åº“è®¾è®¡<code>CountableRange</code>æ—¶, æ˜¯ä¸éœ€è¦çš„, å› ä¸º<code>CountableRange</code>æœ¬èº«å°±è¦æ±‚<code>T: Strideable</code>, è€Œ<code>Strideable</code>çš„æºç  Swift å¼€å‘äººå‘˜æ˜¯å¯æ§çš„, å› æ­¤ä»–ä»¬åªè¦å·å·ç»™<code>Strideable</code>å¡å…¥ä¸€ä¸ªæœ‰é»˜è®¤å®ç°çš„ associated type, å°±å¯ä»¥ä½¿æ‰€æœ‰åŸå…ˆå°±éµå¾ª<code>Strideable</code>çš„ç±»å‹ä¸æ”¹åŠ¨ä»»ä½•ä»£ç å°± work äº†.</p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ª trick ä¹Ÿæœ‰ä¸€äº›æ¼äººä¹‹å¤„:</p><ul><li>è¿™ä¸ªå®ç°å®é™…ä¸Šå·§å¦™åœ°å€Ÿç”¨ç¼–è¯‘é˜¶æ®µçš„&quot;äºŒä¹‰æ€§&quot;é”™è¯¯é¿å…äº†è°ƒç”¨, å¹¶éæ˜¯çœŸçš„è§„é¿è°ƒç”¨, æˆ‘ä»¬è¿™ä¹ˆå®ç°å error message ä¹Ÿå¹¶æ²¡æœ‰ä¼ è¾¾ç»™ç”¨æˆ·æˆ‘ä»¬ä¸å¸Œæœ›ä»–ä»¬å¦‚æ­¤è°ƒç”¨çš„å‡ºå‘ç‚¹.</li><li>è¿™ä¸ªå®ç°éœ€è¦æ³›å‹ç±»å‹æœ¬èº«å¯¹æ³›å‹å‚æ•°æœ‰ protocol çº¦æŸ, å¹¶ä¸”æˆ‘ä»¬æƒ³è§„é¿çš„æ–¹æ³•ä¹Ÿå¾—è‡³å°‘æœ‰1ä¸ªå‚æ•°, å¦åˆ™è¿™ä¸ª trick æ˜¯æ— æ³•è¿›è¡Œçš„.</li><li>è¿™ä¸ªå®ç°ä¼šè‡³å°‘åœ¨ ABI å±‚é¢æš´éœ²ç»™ç”¨æˆ·å¤šä½™çš„ associated type å®šä¹‰å’Œä¸€ä¸ªç”¨ä¸åˆ°çš„ç±»å‹, å³ä¸Šé¢çš„<code>associatedtype _Unavailable</code>å’Œ<code>enum __UnavailableFlag {}</code>. å½“ç„¶ä½œä¸º Swift Standard Library, åœ¨è¾“å‡ºç»™æˆ‘ä»¬ç”¨æ—¶, API interface é‡Œæ˜¯çœ‹ä¸åˆ°çš„, ä½†ä¹Ÿåªæœ‰ Swift å¼€å‘è€…èƒ½æœ‰è¿™ä¸ªä¼˜åŠ¿.</li></ul><p>ä¹Ÿè®¸æ˜¯è¿™æ ·çš„ trick å¤ªè¿‡æƒŠè‰³, åœ¨æœ€æ–°çš„ Swift ä¸­, å€Ÿé‡æ„<code>Range</code>æ—çš„æœºä¼š, Swift æ ‡å‡†åº“æŠŠè¿™ä¸ª trick ä»æ›¾ç»çš„<code>CountableRange</code> (æ³¨: ç°åœ¨<code>CountableRange</code>åªæ˜¯<code>Range</code>çš„ä¸€ä¸ªå¸¦çº¦æŸåŒä¹‰è¯­) ä¸­å»æ‰äº†<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>. å½“ç„¶, è¿™æ ·çš„ä»£ä»·å°±æ˜¯éœ€è¦æˆ‘ä»¬å¼€å‘è€…ç¡®ä¿è‡ªå·±æ¸…æ¥š<code>Range</code>çš„<code>Index</code>æ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„.</p><hr><p>è¿™ä¸ª trick æ˜¯å¾ˆæœ‰å¯å‘æ€§çš„. åŸºäº Swift è¾ƒä¸ºæˆç†Ÿçš„ç±»å‹ç³»ç»Ÿ, æˆ‘ä»¬å¯ä»¥é€šè¿‡æ³›å‹å‚æ•°ã€protocol çš„ associated type ç­‰ç‰¹æ€§, ç»™è‡ªå®šä¹‰ç±»å‹å¢åŠ ç¼–è¯‘æ—¶å¯ä»¥ç¡®å®šçš„ç±»å‹æ ‡è®°. èµ·åˆ°è¿™ç§æ ‡è®°ä½œç”¨çš„ç±»å‹, ä»…ä»…è¾…åŠ©å®ç°é™æ€å†³è®®, è€Œåœ¨ä»£ç è¿è¡Œè¿‡ç¨‹ä¸­å¹¶ä¸ä¼šå‡ºç°è¿™ç§ç±»å‹çš„å®ä¾‹å¯¹è±¡. å› æ­¤, è¿™ç§èµ·åˆ°æ ‡è®°ä½œç”¨çš„ç±»å‹è¢«ç§°ä¸º&quot;Phantom Type&quot;. Phantom Type æ˜¯å¸¸è§çš„ä»£ç æŠ€å·§, å°¤å…¶åœ¨æ³›å‹ç¼–ç¨‹ä¸­, ä¼šåœ¨å„ç§ practices ä¸­ç»å¸¸è§åˆ°.</p><hr><h3 id="æ³›å‹ç±»å‹æŒ‰æ¡ä»¶éµå¾ª-protocol-before-swift-41"><a class="markdownIt-Anchor" href="#æ³›å‹ç±»å‹æŒ‰æ¡ä»¶éµå¾ª-protocol-before-swift-41"></a> æ³›å‹ç±»å‹æŒ‰æ¡ä»¶éµå¾ª protocol (before Swift 4.1)</h3><p>å½“å‰çš„ Swift å«æœ‰ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½: Conditional Conformance<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>. å…è®¸æˆ‘ä»¬é’ˆå¯¹æ³›å‹ç±»å‹åœ¨å…¶æ³›å‹å‚æ•°æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶, ä½¿æ³›å‹ç±»å‹æœ¬èº«éµå¾ª protocol. å½“æ³›å‹å‚æ•°æœ‰ä¸€ç³»åˆ—å˜åŒ–æ—¶, æ³›å‹ç±»å‹æœ¬èº«éµå¾ªçš„ protocol è¿˜å¯ä»¥äº§ç”Ÿå±‚çº§. è¿™ä¸ªåŠŸèƒ½ä» Swift 4.1 éƒ¨åˆ†åŠ å…¥ (åªæ”¯æŒç¼–è¯‘æœŸå†³è®®), å¹¶åœ¨ Swift 4.2 å¾—åˆ°å½»åº•å®ç° (æ”¯æŒåŠ¨æ€åˆ¤æ–­).</p><p>åœ¨ Swift 4.1 ä¹‹å‰, ç”±äºè¯­è¨€ä¸æ”¯æŒæ­¤ç‰¹æ€§, æˆ‘ä»¬åªèƒ½æ‰‹åŠ¨å¦è¾Ÿè¹Šå¾„. ä¾‹å¦‚, æœŸæœ›å®ç°ä¸‹é¢ç­‰ä»·çš„æ•ˆæœ.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Container</span>&lt;<span class="title">T</span>&gt; </span>&#123; <span class="keyword">let</span> item: <span class="type">T</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// protocol hierarchy</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">General</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Special</span>: <span class="title">General</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Container</span>: <span class="title">General</span> <span class="title">where</span> <span class="title">T</span>: <span class="title">General</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Container</span>: <span class="title">Special</span> <span class="title">where</span> <span class="title">T</span>: <span class="title">Special</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„æ¨¡æ¿å‚æ•°å®ä¾‹åŒ–<code>Container</code>æ—¶, å½¢æˆçš„ä¸åŒçš„ç±»å‹æœ¬æ¥å½¼æ­¤å°±æ˜¯å¼‚æ„ (heterogeneous) çš„, æ— æ³•å†ä½¿ç”¨å•ä¸ªç±»å‹æŒ‡ç¤ºä»–ä»¬, å› æ­¤æˆ‘ä»¬åªéœ€è€ƒè™‘é™æ€æƒ…å†µä¸‹çš„é—®é¢˜. å¹¶ä¸”, æŸä¸ª<code>Container</code>å®ä¾‹æ˜¯å¦éµå¾ª protocol åœ¨å®ä¾‹åŒ–ç¬é—´å°±å·²ç»ç¡®å®šäº†, å› æ­¤å¯ä»¥å°½æ—©å¯¹ä¸åŒçš„<code>Container</code>è¿›è¡ŒåŒºåˆ†.</p><p>(1) é¦–å…ˆé’ˆå¯¹ä¸åŒçš„çº¦æŸæƒ…å†µå»ºç«‹ä¸€ç»„ä¸åŒçš„å®ä¾‹ç±»å‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Container</span>&lt;<span class="title">T</span>&gt; </span>&#123; <span class="keyword">let</span> item: <span class="type">T</span> &#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GeneralContainer</span>&lt;<span class="title">T</span>: <span class="title">General</span>&gt;: <span class="title">General</span> </span>&#123; <span class="keyword">let</span> item: <span class="type">T</span> &#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SpecialContainer</span>&lt;<span class="title">T</span>: <span class="title">Special</span>&gt;: <span class="title">Special</span> </span>&#123; <span class="keyword">let</span> item: <span class="type">T</span> &#125;</span><br></pre></td></tr></table></figure><p>(2) ç„¶åç¼–å†™ä¸€ä¸ª&quot;é™æ€&quot;çš„å·¥å‚æ–¹æ³•å³å¯, è¿™ä¸ªæ–¹æ³•å…¶å®é’ˆå¯¹ä¸åŒçš„è¾“å…¥å‚æ•°ç±»å‹, è¿›è¡Œé‡è½½å†³è®®, åœ¨ç¼–è¯‘æ—¶ç¡®å®šéµå¾ªåˆ°å“ªä¸€å±‚ protocol.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeContainer</span>&lt;T&gt;<span class="params">(<span class="number">_</span> item: T)</span></span> -&gt; <span class="type">Container</span>&lt;<span class="type">T</span>&gt; &#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="type">Container</span>(item: item) </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeContainer</span>&lt;T: General&gt;<span class="params">(<span class="number">_</span> item: T)</span></span> -&gt; <span class="type">GeneralContainer</span>&lt;<span class="type">T</span>&gt; &#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="type">GeneralContainer</span>(item: item) </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeContainer</span>&lt;T: Special&gt;<span class="params">(<span class="number">_</span> item: T)</span></span> -&gt; <span class="type">SpecialContainer</span>&lt;<span class="type">T</span>&gt; &#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="type">SpecialContainer</span>(item: item) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ¡ˆçš„ç¼ºé™·åœ¨äº: å½“åŒæ—¶å­˜åœ¨å¤šç»„å½¼æ­¤æ­£äº¤çš„ protocol ä½“ç³»æ—¶, æˆ‘ä»¬è¦å®šä¹‰çš„æ³›å‹ç±»å‹æ—ä¼šå¾ˆåºå¤§, éœ€è¦å®šä¹‰çš„ç±»å‹ä¸ªæ•°æ˜¯å„ä¸ª protocol ä½“ç³»ç¬›å¡å°”ç§¯çš„å°ºå¯¸.</p><p>åœ¨ Swift 4.1 å‰, Swift Standard Library å¯¹<code>Slice&lt;Base: Collection&gt;</code>å°±æ˜¯è¿™ä¹ˆå¤„ç†çš„, ç”±äº <code>Collection</code>ä¸°å¯Œçš„ç»§æ‰¿ä½“ç³», è¦å®šä¹‰çš„<code>Slice</code>å˜ä½“ä¹Ÿéå¸¸å¤š. å®é™…ä¸Š:</p><ul><li>åœ¨ index æ„å»ºæ–¹é¢, <code>Collection</code>æ´¾ç”Ÿå‡º<code>BidirectionalCollection</code>å’Œ<code>RandomAccessCollection</code></li><li>åœ¨ in-place mutation æ–¹é¢, <code>Collection</code>æ´¾ç”Ÿå‡º<code>MutableCollection</code></li><li>åœ¨å¯å˜é•¿æ–¹é¢, <code>Collection</code>æ´¾ç”Ÿå‡º<code>RangeReplaceableCollection</code></li></ul><p>å› æ­¤åªèƒ½å»ºç«‹æ€»è®¡<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>â‹…</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>â‹…</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo>=</mo><mn>12</mn></mrow><annotation encoding="application/x-tex">(1 + 1) \cdot (1 + 1) \cdot (1 + 2) = 12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">2</span></span></span></span>ä¸ª concrete çš„<code>Slice</code>å˜ä½“.</p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0157-recursive-protocol-constraints.md" target="_blank" rel="noopener">https://github.com/apple/swift-evolution/blob/master/proposals/0157-recursive-protocol-constraints.md</a> <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p></li><li id="fn2" class="footnote-item"><p><a href="https://swiftdoc.org/v3.1/type/countablerange/" target="_blank" rel="noopener">https://swiftdoc.org/v3.1/type/countablerange/</a> <a href="#fnref2" class="footnote-backref">â†©ï¸</a></p></li><li id="fn3" class="footnote-item"><p><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0143-conditional-conformances.md" target="_blank" rel="noopener">https://github.com/apple/swift-evolution/blob/master/proposals/0143-conditional-conformances.md</a> <a href="#fnref3" class="footnote-backref">â†©ï¸</a></p></li></ol></section>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;ul class=&quot;markdownIt-TOC&quot;&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%99%AE%E9%80%9A-practices&quot;&gt;æ™®é€š Practices&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#availability-checks&quot;&gt;Availability checks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%B4%BB%E7%94%A8-string-backed-enum&quot;&gt;æ´»ç”¨ â€œString-backedâ€ enum&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86&quot;&gt;èƒŒæ™¯çŸ¥è¯†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%A1%88%E4%BE%8B&quot;&gt;æ¡ˆä¾‹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#tricks-patterns&quot;&gt;Tricks &amp;amp; Patterns&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E7%BB%99-protocol-%E5%A2%9E%E5%8A%A0-recursive-constraints-before-swift-41&quot;&gt;ç»™ protocol å¢åŠ  recursive constraints (before Swift 4.1)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%B3%9B%E5%9E%8B%E5%AF%B9%E8%B1%A1%E6%8E%92%E9%99%A4%E7%89%B9%E4%BE%8B%E8%B0%83%E7%94%A8&quot;&gt;æ³›å‹å¯¹è±¡æ’é™¤ç‰¹ä¾‹è°ƒç”¨&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E9%97%AE%E9%A2%98&quot;&gt;é—®é¢˜&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%9C%BA%E6%99%AF&quot;&gt;åœºæ™¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E5%AE%9E%E7%8E%B0&quot;&gt;å®ç°&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#%E6%B3%9B%E5%9E%8B%E7%B1%BB%E5%9E%8B%E6%8C%89%E6%9D%A1%E4%BB%B6%E9%81%B5%E5%BE%AA-protocol-before-swift-41&quot;&gt;æ³›å‹ç±»å‹æŒ‰æ¡ä»¶éµå¾ª protocol (before Swift 4.1)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;åŸæ–‡æˆäº2018å¹´&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æœ¬æ–‡ç§¯ç´¯å­¦ä¹  Swift è¿‡ç¨‹ä¸­è·å–åˆ°çš„å¥½æŠ€å·§, ä»¥åŠ Swift Standard Library ä½¿ç”¨çš„ä¼˜ç§€èŒƒå¼ (tricks).&lt;/p&gt;
&lt;h2 id=&quot;æ™®é€š-practices&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#æ™®é€š-practices&quot;&gt;&lt;/a&gt; æ™®é€š Practices&lt;/h2&gt;
&lt;h3 id=&quot;availability-checks&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#availability-checks&quot;&gt;&lt;/a&gt; Availability checks&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ availability checks å°†è¶…å‡ºæŒ‡å®šçš„&amp;quot;Base SDK&amp;quot;ç‰ˆæœ¬çš„ä»£ç å—éš”ç¦»èµ·æ¥. åœ¨è¿è¡Œæ—¶, ç³»ç»Ÿä¼šæ ¹æ®è¿è¡Œç¯å¢ƒåŠ¨æ€ check è¯¥ä»£ç æ˜¯å¦æ‰§è¡Œ.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@available(iOS 9.0, *)&lt;/code&gt;, method, type å®šä¹‰æ—¶.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;if #available(iOS 9.0, *)&lt;/code&gt;, ä½¿ç”¨ method, type æ—¶.&lt;/li&gt;
&lt;li&gt;æ”¯æŒ guard ä½œä¸º early exit.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥æ›¿ä»£ç›¸å¯¹åº”çš„æ—©æœŸçš„ä»¥ä¸‹è°ƒç”¨:&lt;br&gt;
&lt;code&gt;UIDevice.current.systemVersion.compare(&amp;quot;9.0&amp;quot;, options: .numeric) == .orderedAscending&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;æ´»ç”¨-string-backed-enum&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#æ´»ç”¨-string-backed-enum&quot;&gt;&lt;/a&gt; æ´»ç”¨ â€œString-backedâ€ enum&lt;/h3&gt;
&lt;h4 id=&quot;èƒŒæ™¯çŸ¥è¯†&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#èƒŒæ™¯çŸ¥è¯†&quot;&gt;&lt;/a&gt; èƒŒæ™¯çŸ¥è¯†&lt;/h4&gt;
&lt;p&gt;åœ¨ä¼—å¤šåŸºäº raw value çš„ enum ä¸­, raw value æ˜¯&lt;code&gt;String&lt;/code&gt;çš„æœ€ä¸ºç‰¹æ®Š, å› ä¸ºè¿™æ ·çš„ enum åœ¨å®šä¹‰å„ä¸ª case æ—¶, å¯ä»¥çœå»æ˜¾å¼å†™å‡ºç”¨æ¥åˆå§‹åŒ–è¯¥ enum çš„ raw value. è¿™ç§æƒ…å†µä¸‹, ç¼–è¯‘å™¨é»˜è®¤è¿½åŠ ä»£ç , ä½¿ç”¨å„ä¸ª case identifier çš„åŒåå­—ç¬¦ä¸²ä½œä¸º raw value.&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å„è¡Œ case å¯ä»¥çœç•¥ // ä¹‹åçš„éƒ¨åˆ†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ImageIdentifier&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;String&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; centerButton &lt;span class=&quot;comment&quot;&gt;// = &quot;centerButton&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; myFavorites &lt;span class=&quot;comment&quot;&gt;// = &quot;myFavorites&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢, è¿™æ ·çš„ enum é»˜è®¤éµå¾ª&lt;code&gt;RawRepresentable&lt;/code&gt;, ä¸”å…³è”ç±»å‹&lt;code&gt;RawValue == String&lt;/code&gt;. è¿™æ–¹ä¾¿æˆ‘ä»¬å¯¹äºä¸€ç³»åˆ—æœ‰ç›¸åŒç‰¹å¾çš„ enum ä¾é  protocol æä¾›ç»Ÿä¸€æ“ä½œ.&lt;/p&gt;
&lt;h4 id=&quot;æ¡ˆä¾‹&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#æ¡ˆä¾‹&quot;&gt;&lt;/a&gt; æ¡ˆä¾‹&lt;/h4&gt;
&lt;p&gt;ä¸‹è¿°æŠ€å·§æœ€æ—©å‡ºç°äº&lt;a href=&quot;https://web.archive.org/web/20200108191946/https://developer.apple.com/videos/play/wwdc2015/411/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;WWDC 2015, session 403&lt;/a&gt;.&lt;br&gt;
è¯¥ video å·²ç»è¢« apple ä»å…¬å¼€åˆ—è¡¨ä¸­ç§»é™¤, æ­¤å¤„æä¾›çš„æ˜¯ web.archive ä¸Šçš„ç¼“å­˜.&lt;br&gt;
ä¹Ÿå¯ä»¥å°è¯•ç›´æ¥è·å– &lt;a href=&quot;https://devstreaming-cdn.apple.com/videos/wwdc/2015/4119flfsnsgmlfy/411/411_hd_swift_in_practice.mp4?dl=1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;video&lt;/a&gt; å’Œ &lt;a href=&quot;https://devstreaming-cdn.apple.com/videos/wwdc/2015/4119flfsnsgmlfy/411/411_swift_in_practice.pdf?dl=1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;pdf&lt;/a&gt;.&lt;/p&gt;</summary>
    
    
    
    <category term="Swift" scheme="https://crystdragon.github.io/categories/swift/"/>
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://crystdragon.github.io/2020/hello-world/"/>
    <id>https://crystdragon.github.io/2020/hello-world/</id>
    <published>2020-06-30T16:00:00.000Z</published>
    <updated>2020-11-11T02:24:41.103Z</updated>
    
    <content type="html"><![CDATA[<p>Hi, å¾ˆé«˜å…´è®¤è¯†ä½ , æˆ‘æ˜¯ Lincoln. æ˜é¢ä¸Šæ˜¯ä¸€å iOS å¼€å‘è€…, Swifter. ç§ä¸‹å–œæ¬¢ç®—æ³•, å›¾å½¢æ¸²æŸ“, æ•°å­¦.<br>è¿™æ˜¯æˆ‘çš„ <a href="/Resume.pdf">Resume</a>.he</p><p>2020å¹´å…¨çƒçš„ç–«æƒ…æ”¹å˜äº†ä¸–ç•Œ, ä¹Ÿæ”¹å˜äº†æˆ‘. æˆ‘å–œæ¬¢è®°å½•å’Œåˆ†äº«æŠ€æœ¯, ä½†ä»¥å‰é™¤äº†åœ¨å…¬å¸å†…éƒ¨åˆ†äº«æˆ–ä¸äººå½“é¢äº¤æµ, æˆ‘ä»æœªå°è¯•æŠŠæ–‡å­—æ”¾åˆ°äº’è”ç½‘ä¸Š. æˆ‘è§‰å¾—ç°åœ¨çš„ç¯å¢ƒå¯¹åšå‡ºè¿™æ ·çš„æ”¹å˜æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ—¶æœº.</p><p>è¿™é‡Œçš„æ–‡å­—ä¸»è¦æœ‰ä¸¤éƒ¨åˆ†å†…å®¹. ä¸€éƒ¨åˆ†æ˜¯æ­£å„¿å…«ç»çš„åšå®¢, å¦ä¸€éƒ¨åˆ†æ˜¯<a href="/categories/Notes/">åè¶³éšæ„çš„ç¬”è®°</a>. å‰è€…é€‚åˆæ‹¿å‡ºæ¥è·Ÿå¤§å®¶æ¢è®¨, ä½†åè€…åªèƒ½å½“æˆè‡ªå·±å­¦ä¹ æ—¶çš„ä¸€äº›æ€»ç»“æˆ–æçº². æœ‰äº›æ–‡ç« éƒ½æ˜¯è¿‡å»å¾ˆä¹…ä¹‹å‰å†™æˆçš„, æˆ‘ä¹Ÿè¶è¿™ä¸ªæŠŠå®ƒä»¬æ¬è¿›åšå®¢çš„æœºä¼š, é‡æ–°æ¢³ç†æˆ–å½’çº³äº†ä¸€ä¸‹. æˆ‘ç¡®ä¿è¿™é‡Œçš„æ¯ä¸€ç¯‡éƒ½æ˜¯æˆ‘è‡ªå·±å¯¹æŸä¸ªæŠ€æœ¯ç‚¹çš„æ„Ÿæ‚Ÿ, ç»ä¸ä¼šç…§æ¬ copy ç½‘ä¸Šç°æœ‰çš„ä¸œè¥¿. å¦‚æœé˜…è¯»æŸä¸€ç¯‡æ–‡å­—çš„ä½ èƒ½ä»é‡Œé¢çš„æŸä¸ªåœ°æ–¹æœ‰æ‰€æ”¶è·, è‡ªç„¶æˆ‘çš„åŠªåŠ›ä¹Ÿæ²¡æœ‰ç™½è´¹. å½“ç„¶æˆ‘æ›´æ„¿æ„ä½ ç»™æˆ‘çš„æ–‡ç« æä¸€äº›å»ºè®®, ç‹¬ä¹ä¹ä¸å¦‚ä¼—ä¹ä¹ xD.</p><p>æˆ‘å¯¹ç½‘é¡µå‰ç«¯å¼€å‘æœ‰å…´è¶£, ä½†è¿œè¿œç§°ä¸ä¸Šåˆæ ¼. å› æ­¤è¿™ä¸ªç«™ç‚¹é€‰æ‹©äº†æœ€ä¸ºåŸºç¡€çš„è®¾æ–½. æˆ‘ä½¿ç”¨äº† <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> ä½œä¸ºç½‘ç«™æ¡†æ¶, å¹¶<a href="https://hexo.io/docs/github-pages#Private-repository" target="_blank" rel="noopener">æ‰˜ç®¡</a>åœ¨ <a href="https://pages.github.com" target="_blank" rel="noopener">GitHub Pages</a> ä¸Š. æˆ‘ä½¿ç”¨çš„ä¸»é¢˜æ˜¯ Hexo æœ€ä¸ºåŸºç¡€çš„ landscape é£æ ¼. å¹³æ—¶çš„æ–‡ç« éƒ½æ˜¯ä»¥ markdown å†™æˆ, ä¸ºäº†è¶…è¶Šé»˜è®¤çš„ hexo markdown renderer æ”¯æŒçš„åŠŸèƒ½, æˆ‘ä½¿ç”¨äº† <a href="https://github.com/CHENXCHEN/hexo-renderer-markdown-it-plus" target="_blank" rel="noopener">hexo-renderer-markdown-it-plus</a> æ’ä»¶æ¥æ”¯æŒæ•°å­¦å…¬å¼ã€ç›®å½•ã€è„šæ³¨ç­‰åŠŸèƒ½; ä½¿ç”¨äº†<a href="https://github.com/xcodebuild/hexo-asset-image" target="_blank" rel="noopener">hexo-asset-image</a> æ’ä»¶æ¥æ”¯æŒæ’å…¥ local image. æˆ‘é€‰æ‹©äº† <a href="https://disqus.com" target="_blank" rel="noopener">Disqus</a> æ¥æ‰˜ç®¡æ¯ç¯‡æ–‡ç« çš„è¯„è®º, ä½¿ç”¨ <a href="https://github.com/hexojs/hexo-generator-feed" target="_blank" rel="noopener">hexo-generator-feed</a> è‡ªåŠ¨ç”Ÿæˆ feed è®¢é˜…. æœ€å, æˆ‘ä½¿ç”¨ <a href="https://github.com/hexojs/hexo-generator-sitemap" target="_blank" rel="noopener">hexo-generator-sitemap</a> æ’ä»¶æ¥è‡ªåŠ¨ç”Ÿæˆ sitemap ä¾›æœç´¢å¼•æ“ç´¢å¼•é¡µé¢.</p><hr><p><a href="https://oleb.net/blog/2017/06/chris-lattner-wwdc-swift-panel/#in-which-fields-would-you-like-to-see-swift-in-the-future" target="_blank" rel="noopener">æœŸå¾… Swift ç»Ÿæ²»ä¸–ç•ŒğŸ˜‚</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Hi, å¾ˆé«˜å…´è®¤è¯†ä½ , æˆ‘æ˜¯ Lincoln. æ˜é¢ä¸Šæ˜¯ä¸€å iOS å¼€å‘è€…, Swifter. ç§ä¸‹å–œæ¬¢ç®—æ³•, å›¾å½¢æ¸²æŸ“, æ•°å­¦.&lt;br&gt;
è¿™æ˜¯æˆ‘çš„ &lt;a href=&quot;/Resume.pdf&quot;&gt;Resume&lt;/a&gt;.he&lt;/p&gt;
&lt;p&gt;2020å¹´å…¨çƒçš„ç–«æƒ…æ”¹å˜äº†ä¸–ç•Œ, ä¹Ÿ</summary>
      
    
    
    
    <category term="Diary" scheme="https://crystdragon.github.io/categories/diary/"/>
    
    
  </entry>
  
</feed>
